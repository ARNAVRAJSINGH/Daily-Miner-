var auth={id:0,lastId:0,lastSsoUid:0,loggedIn:!1,session:{},local:{},moderator:!1,sessionExpiration:0,sessionExpirationTimeoutId:0,banned:!1,lastLogoutReason:"",ssoTypes:{},init:function(){auth.ssoTypes={0:facebook,1:twitter,2:rumbletalk,256:guest},"function"==typeof document.hasStorageAccess&&document.hasStorageAccess().then((function(e){if(!e)return console.error("Info: the RumbleTalk chat will work in an optimized way when the cookies are enabled");console.log("browser has access to cookies and storage")}),(function(e){console.error("Info: the RumbleTalk chat will work in an optimized way when the cookies are enabled"),console.log(e)})),auth.banned=!!_i.storage.getItem("banned",!0)},loadStorage:function(){try{var e=_i.storage.getItem(rtc.hash);e&&(auth.session=e),(e=_i.storage.getItem(rtc.hash,!0))&&(auth.local=e),"object"!=typeof auth.session&&(auth.session={}),"object"!=typeof auth.local&&(auth.local={}),_i.isCookie("s")&&(_i.storage.setItem("s",_i.getCookie("s"),!0),_i.delCookie("s")),_i.isCookie("r")&&(_i.storage.setItem("r",_i.getCookie("r"),!0),_i.delCookie("r"))}catch(e){}},handleStorage:function(e){var t=e.getResponseHeader("s"),s=e.getResponseHeader("r");if(t){if(auth.local.s&&auth.local.s!=t&&auth.local.r&&auth.local.r!=s)return console.log("different sessions"),!1;_i.storage.setItem("s",t,!0)}return s&&_i.storage.setItem("r",s,!0),!0},getLoginType:function(e){return auth.ssoTypes[e]||guest},updateUserId:function(e){auth.lastId=auth.id,auth.id=e.id,auth.setModerator(e.mod)},shouldDisplayExtendSession:function(e,t){return 10080<t&&e<1440||1440<t&&e<60||60<t&&e<5||e<1},handleSessionInterval:function(e){auth.sessionExpiration-=e;var t=auth.calculateSessionInterval(auth.sessionExpiration),s="";t.count>1&&(s="s"),skin.session.title=t.count+" "+t.units+s,_i.firstCss("time",skin.session).innerHTML=skin.session.title;var i=function(e){return 75<e?100:50<e?75:25<e?50:25}(auth.sessionExpiration/(60*cfg.monetize.loginDuration)*100),a=_i.firstCss("progress",skin.session);a&&(a.style.width=_i.addUnit(i,"%")),clearTimeout(auth.sessionExpirationTimeoutId),auth.sessionExpirationTimeoutId=setTimeout((function(){if(auth.sessionExpiration>0)auth.handleSessionInterval(t.timeout),auth.shouldDisplayExtendSession(auth.sessionExpiration,60*cfg.monetize.loginDuration)&&(_i.addClass(skin.session,"ending"),skin.toggleExtendPopup(!0));else{skin.toggleExtendPopup(!1);var e=rtc.user(auth.id);e&&(e=e.ssoUid),skin.session.style.display="none",auth.logout("session_expired"),skin.oneButton({text:"Your session has expired. To continue using the chat, extend your session",onclick:"skin.close(true);skin.requestExtendSession("+(e||auth.lastSsoUid)+");",buttonText:"Extend your session",displayXButton:!0},!0)}}),1e3*t.timeout)},calculateSessionInterval:function(e){var t,s=1,i=cfg.strings.second;return e>31536e3?(s=31536e3,i=cfg.strings.year):e>2592e3?(s=2592e3,i=cfg.strings.month):e>604800?(s=604800,i=cfg.strings.week):e>86400?(s=86400,i=cfg.strings.day):e>3600?(s=3600,i=cfg.strings.hour):e>60&&(s=60,i=cfg.strings.minute),t=e%s,{count:e=parseInt(e/s)+(t>0),units:i,timeout:t||1}},updateExpiration:function(e){auth.sessionExpiration=e,_i.removeClass(skin.session,"ending"),auth.sessionExpiration>0&&0==cfg.monetize.loginType?(skin.session.style.display="block",auth.handleSessionInterval(0),skin.close()):(clearTimeout(auth.sessionExpirationTimeoutId),skin.session.style.display="none")},login:function(e,t){skin.logginIn(e);var s=e.setup(t,auth.sendLogin);skin.registerDetails={},s&&e.logout((function(){skin.showError({type:e,status:s,fields:t})}))},sendLogin:function(e,t,s,i){t?(i&&_i.storage.setItem(i.name,i.value,!0),s.type=e.ssoType,rtc.send({data:{cmd:rtc.commands.LOGIN,data:s},loginType:e,fields:s})):skin.close()},logout:function(e,t){rtc.connected&&(auth.moderator&&rtc.clearIpAddresses(),skin.closeCalling(),cfg.chatType==_i.chatTypes.ONE_ON_ONE&&skin.setContentMessage(),skin.chatExtra.style.display="none",skin.textInput.removeAttribute("style"),privateChat.close(),privateChat.clearMessages(),mentions.close(),auth.updateExpiration(0),_i.storage.removeItem("r",!0),skin.wait(cfg.strings.disconnecting),cfg.monetize.login&&skin.draw(),auth.lastLogoutReason=e,rtc.send({data:{cmd:rtc.commands.LOGOUT},endCb:function(e){skin.close(),"function"==typeof t&&t(e)}}))},loggedOut:function(e,t){auth.loggedIn?((rtc.user(auth.id)||rtc.user(auth.lastId)).loginType.logout((function(){e.soft||rtc.removeUser(auth.id)||rtc.removeUser(auth.lastId),auth.setLoggedIn(!1),cfg.chatType==_i.chatTypes.ONE_ON_ONE&&skin.clearUsers(!0),skin.clearBlockedUsersDom(),rtc.listeners++,skin.readyForLogin(),skin.setListeners()})),auth.setModerator(!1),uploader.updateValidities(),sdk.notifyLogout(t)):rtc.disconnect(!0,null,t);skin.updateUsersListDisplay(),skin.draw()},register:function(e,t){rtc.send({data:{cmd:t?rtc.commands.REGISTER_USER:rtc.commands.MONETIZE_REGISTER,data:e},cmdCb:function(e){e.cmd!==rtc.commands.PAYPAL_RESPONSE?-1!==[rtc.commands.REGISTER_USER,rtc.commands.MONETIZE_REGISTER].indexOf(e.cmd)&&setTimeout((function(){t?1==e.data.result?auth.login(rumbletalk,{hash:e.data.hash}):skin.showMessage("ERROR: could not register your user"):skin.paymentSummaryDialog(e.data,!0)}),1):skin.showMessage("There was an issue connecting to PayPal<br>Please try again later")}})},extendSession:function(e){e?(e=Number(e),isNaN(e)?skin.showMessage("Invalid SSO user id"):rtc.send({data:{cmd:rtc.commands.EXTEND_SESSION,data:{uId:e}},cmdCb:function(e){skin.paymentSummaryDialog(e.data)}})):skin.showMessage("No SSO user found for extendSession")},setLoggedIn:function(e){auth.loggedIn=e,rtc.usersBlocked={};var t=_i.storage.getItem("rumbletalk-users-blocked["+rtc.hash+"]"+auth.id);t&&(rtc.usersBlocked=JSON.parse(t,!0)),skin.loggedInClasses()},setModerator:function(e){auth.moderator=e,skin.moderatorClasses(e)},getLastLogoutReason:function(){var e=auth.lastLogoutReason;return auth.lastLogoutReason="",e},confirmRegister:function(){rtc.send({data:{cmd:rtc.commands.LOGIN,data:{hash:skin.loginHash,register:!0,type:rumbletalk.ssoType}}})}},dlg={BASE_CLASS_NAME:"dialog",dialog:null,background:null,callback:null,locked:!1,reference:"",opened:!1,init:function(){if(_i.mobile||(dlg.background=_i.create("DIV",{className:"dark-box"},_i.b),dlg.background.onclick=function(e){e.target===dlg.background&&dlg.close()}),dlg.dialog=_i.create("DIV",{className:dlg.BASE_CLASS_NAME,draggable:!0},dlg.background||_i.b),!_i.mobile){var e,t={screenX:null,screenY:null,pageX:null,pageY:null};dlg.dialog.addEventListener("mousedown",(function(t){e=_i.hasClass(t.target,dlg.BASE_CLASS_NAME)}),!1),dlg.dialog.addEventListener("dragstart",(function(s){e?(s.dataTransfer.setData("text","1"),s.effectAllowed="move",t.screenX=s.screenX,t.screenY=s.screenY,t.pageX=s.pageX,t.pageY=s.pageY):s.preventDefault()}),!1),document.addEventListener("drop",(function(s){var i,a;(s.preventDefault(),e)&&(s.pageX?(i=t.pageX-s.pageX,a=t.pageY-s.pageY):(i=t.screenX-s.screenX,a=t.screenY-s.screenY),dlg.dialog.style.left=_i.addUnit(parseInt(dlg.dialog.style.left)-i),dlg.dialog.style.top=_i.addUnit(parseInt(dlg.dialog.style.top)-a))}),!1)}},show:function(e,t,s,i,a){!0!==dlg.locked&&(dlg.close(),dlg.background&&(dlg.background.style.display="block"),dlg.callback=i,dlg.locked=a,dlg.reference=t,dlg.dialog.innerHTML=e,dlg.dialog.className=dlg.BASE_CLASS_NAME,s&&_i.addClass(dlg.dialog,s),dlg.dialog.style.display="block",dlg.center(),dlg.opened=!0)},center:function(){if(!_i.mobile){var e=_i.client();dlg.dialog.offsetHeight<e.height?dlg.dialog.style.top=(e.height-dlg.dialog.offsetHeight)/2-_i.num(_i.style(dlg.dialog).margin,0)+"px":dlg.dialog.style.top=0,dlg.dialog.offsetWidth<e.width?dlg.dialog.style.left=(e.width-dlg.dialog.offsetWidth)/2-_i.num(_i.style(dlg.dialog).margin,0)+"px":dlg.dialog.style.left=0}},close:function(e){!0===dlg.locked&&!0!==e||(dlg.locked=!1,"function"==typeof dlg.callback&&dlg.callback(),dlg.callback=null,dlg.reference="",dlg.dialog.style.display="none",dlg.background&&(dlg.background.style.display="none"),dlg.dialog.innerHTML="",dlg.opened=!1)},fields:function(){var e,t=_i.tag("input",dlg.dialog),s={};for(e in t)t.hasOwnProperty(e)&&(s[t[e].name]=t[e]);for(e in t=_i.tag("textarea",dlg.dialog))t.hasOwnProperty(e)&&(s[t[e].name]=t[e]);return s}},facebook={id:"facebook",isSSO:!0,ssoType:0,appId:"",name:"Facebook",storage:"",cache:{},init:function(){facebook.appId=cfg.facebookAppId,window.fbAsyncInit=function(){FB.init({appId:facebook.appId,version:"v12.0"})},_i.create("DIV",{id:"fb-root"},_i.b),_i.load("https://connect.facebook.net/en_US/sdk.js","facebook-jssdk"),facebook.name=cfg.strings.facebook,facebook.storage="fbsr_"+facebook.appId},setup:function(e,t){if("undefined"!=typeof FB)try{FB.login((function(s){facebook.handleResponse(s,e,t)}),{scope:"email,user_gender"})}catch(s){FB.getLoginStatus((function(s){facebook.handleResponse(s,e,t)}),!0)}else t(facebook,!1)},handleResponse:function(e,t,s){if("connected"===e.status){var i={name:facebook.storage,value:e.authResponse.signedRequest};FB.api("/me",{fields:"name,gender"},(function(e){void 0===e.name?FB.logout((function(){setTimeout((function(){facebook.setup(t,s)}),100)})):(t||(t={}),facebook.cache[e.id]=e,t.username=e.name,s(facebook,!0,t,i))}))}else s(facebook,!1)},logout:function(e){FB.logout(),_i.storage.removeItem(facebook.storage,!0),_i.storage.removeItem("fblst_"+facebook.appId,!0),_i.storage.removeItem("fbssls_"+facebook.appId,!1),"function"==typeof e&&e()},pic:function(e){return"https://graph.facebook.com/"+e.ssoUid+"/picture"},getUserInfo:function(e,t){"undefined"!=typeof FB?facebook.cache[e.ssoUid]?facebook.gotUserInfo(facebook.cache[e.ssoUid],t,e,!0):FB.getAccessToken()?FB.api("/"+e.ssoUid,{fields:"name,gender"},(function(s){facebook.gotUserInfo(s,t,e)})):t(e):t(e)},gotUserInfo:function(e,t,s,i){!e||e.error||i||(facebook.cache[e.id]=e);var a={buttons:[],texts:[]};if(s.ssoUid){var n="https://facebook.com/"+s.ssoUid;a.buttons.push({fn:"window.open('"+n+"');",text:cfg.strings.facebook_go_profile,className:"facebook-button open-in-new"})}if(e&&e.name){var o="male"===e.gender?cfg.strings.male:"female"===e.gender?cfg.strings.female:null;o&&a.texts.push({label:cfg.strings.gender,text:gui.safe(o)})}"function"==typeof t&&t(s,a)},invite:function(){"undefined"!=typeof FB?(skin.wait(cfg.strings.inviting_facebook),rtc.track("Invites","Facebook"),FB.ui({method:"share",href:skin.getLink(),quote:cfg.strings.facebook_invite_message},skin.close)):skin.close()}},guest={id:"guest",isSSO:!1,ssoType:4,name:"Guest",picture:"",previewImageHandle:null,errors:{EMPTY_USER_NAME:"guest.1",BAD_USER_NAME:"guest.2"},init:function(){var e,t=cfg.cdn+"images/skins/"+cfg.skinFamilyId+"/usericon.png",s=_i.selectors(["guest-default-image"]);guest.name=cfg.strings.guest,void 0!==s[".guest-default-image"]&&"string"==typeof s[".guest-default-image"].style.background&&null!=(e=s[".guest-default-image"].style.background.match(/url\(\s*"?([^\s")]+)"?\s*\)/i))&&"object"==typeof e&&2===e.length&&e[1].length>0&&(t=e[1]),guest.picture=t},setup:function(e,t){return e.username=e.username.trim(),0===e.username.length?guest.errors.EMPTY_USER_NAME:/^-?\d+$/.test(e.username)?guest.errors.BAD_USER_NAME:void t(this,!0,e)},logout:function(e){e()},pic:function(){return guest.picture},previewImage:function(e){guest.previewImageHandle.src=e.value,register._setError(e)},uploadFile:function(){uploader.configurations={closeDlg:!1,callback:function(e){var t=document.getElementById("guest-image");t&&(t.value=e,guest.previewImage(t))},accept:"image/*",imageWidthLimit:128,imageHeightLimit:128,forceResize:!0},skin.uploadFileDialog()},getUserInfo:function(e,t){t(e)}},gui={loadingPause:3e3,loadingTries:5,imgOld:3e5,smiliesRegex:{},httpLinksPattern:/(^|\s)((https?:)?\/\/)?(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))(?::\d{2,5})?(?:[/?#]\S*)?(\s|$)/gm,smilies:{1:":)",2:":(",3:";)",4:":D",5:":-(",6:";-)",7:":P",8:":V]",9:":W]",10:"O:)",11:">:(",12:"8B|",13:":CK:",14:"<0:",15:"B-)",16:"3:)",17:":-/",18:":FL:",19:"B-|",20:"O.O:",21:"O.S:",22:":-:*",23:":-*",24:":P^",25:":-$",26:"<-^",27:":PP:",28:":o.O",29:":-Z",30:":S-",31:":|]",32:"(y)",33:"(n)"},styles:{b:"*",i:"_",s:"~",code:"`"},templatesHash:{"list-template":'<div id="list-frame" class="mobile-dialog"> <span id="users-messages-count"></span> <div id="search-bar" class="search-bar" shown="showSearch"> <input id="search-input" class="search-input" type="text" autocomplete="off" onkeyup="skin.filterUsers(event);" b="placeholder:placeholderSearch,title:searchTitle"> <span role="button" id="search-close" class="search-close" onclick="skin.toggleSearchBar();" b="title:closeSearchTitle"></span> </div> <div id="top-buttons"> <button id="invite-button" onclick="skin.invite();" b="invite"></button> <button id="list-handle"></button> <button id="search-button" onclick="skin.toggleSearchBar();" shown="showSearch"></button> </div> <div id="list"> </div> <div id="session"> <img class="timer" src="images/skins/general/monetize/timer.png" alt="timer"> <div class="interval"> <div class="extend-popup"> <span role="button" class="close-button" onclick="skin.toggleExtendPopup(false, event);"></span> <div class="time"></div> <button onclick="skin.requestExtendSession()">Click to extend</button> </div> <div class="progress"></div> </div> </div> <div id="info"> <span id="speakers">0</span> <span b="speakers"></span> <span id="listeners">0</span> <span b="listeners"></span> </div> <div id="options"> <a id="pause" b="title:" onclick="skin.setScroll(!skin.pause);"></a> <a id="settings" b="title:options" onclick="skin.optionsDialog();"></a> <a id="logout" b="title:logout" onclick="skin.logout();"></a> </div> </div>',"chat-template":'<div id="chat-frame"> <div id="chat"> <div id="content"></div> </div> <div id="text-cover" b="data-admin-mode-input:adminMode,data-admin-mode-title:adminModeHover"> <div id="text-input" contenteditable="false"> </div> <div id="text-placeholder" class="text-placeholder" aria-hidden="true" role="presentation" tabindex="-1" b="typeMessage"></div> </div> <div id="chat-extra"> <img id="smiley" class="mobile-dialog-button" src="images/skins/general/emoji.png" b="alt:emoji,title:emoji"> <img id="donate" src="images/skins/general/donate.png" b="alt:donate,title:donate"> <img id="upload" src="images/skins/general/upload.png" b="alt:add,title:add"> <img id="send" src="images/skins/mobile/new/send_message.png" b="alt:send,title:send"> </div> </div>',"user-template":'<div class="user-container" b="id:id,onclick:click"> <span class="private-message-count"></span> <img b="image,alt:name,title:name" class="user-image"> <span b="name" class="user-name"></span> </div>',"main-message-template":'<div class="main-message-container" b="uid:uid,id:id,class:classNames"> <div class="message-user-image-container"> <img b="image,onclick:userDetails" class="message-user-image" role="button"> </div> <div class="message-bubble"> <button class="moderate-message disapprove" b="onclick:disapproveFn,title:disapproveTitle" shown="pending">&#10007;</button> <button class="moderate-message approve" b="onclick:approveFn,title:approveTitle" shown="pending">&#10003;</button> <span class="delete-message" b="alt:del,title:del,onclick:delClick"></span> <span b="date" class="message-date"></span> <div b="name,onclick:userDetails" class="message-user-name"></div> <div b="text" class="message-text first"></div> </div> </div>',"offline-template":'<div class="dialog-content"> <div b="text"></div> <form shown="displayForm"> <label><b b="labelEmail"></b></label><br> <input type="text" style="width:150px;" maxlength="100"/><br> <label><b b="labelName"></b></label><br> <input type="text" style="width:150px;" maxlength="100"/><br> <label><b b="labelMessage"></b></label><br> <textarea style="width:150px;" maxlength="1024"></textarea> <br> <button type="button" onclick="skin.sendOfflineMessage();" b="buttonText"></button> </form> </div>',login:'<div class="dialog-content"> <span role="button" class="close-button" onclick="skin.close();"></span> <b class="dialog-title" b="title"></b> <button id="login-guest" class="login-type-button" onclick="skin.loginParamsDialog(guest);" b="title:guestTitle" shown="displayGuest"> <span b="guest"></span> </button> <button id="login-facebook" class="login-facebook login-type-button" onclick="skin.loginParamsDialog(facebook);" b="title:facebookTitle" shown="displayFacebook"> <span b="facebook"></span> </button> <button id="login-twitter" class="login-twitter login-type-button" onclick="skin.loginParamsDialog(twitter);" b="title:twitterTitle" shown="displayTwitter"> <span b="twitter"></span> </button> <button id="login-rumbletalk" class="login-type-button" onclick="skin.loginParamsDialog(rumbletalk);" b="title:rumbletalkTitle" shown="displayRumbletalk"> <span b="rumbletalk"></span> </button> <div class="register-button-wrapper" shown="displayRegister"> <button id="register" onclick="skin.registerDialog();" b="title:registerTitle"> <span b="register"></span> </button> </div> </div>',"guest-login":'<div class="dialog-content login-form guest-login-dialog"> <span role="button" class="close-button" onclick="skin.close();"></span> <div class="error-label"></div> <div class="row"> <label for="guest-username" class="login-label cell" b="username"></label> <input id="guest-username" name="username" type="text" class="field cell" maxlength="60" onkeyup="skin.enter(event, guest);"> </div> <div class="row image-section" shown="displayAvatar"> <img class="image-preview" b="previewSrc"> <input id="guest-image" name="image" class="field cell" type="text" maxlength="256" onchange="skin.previewImageGuest(this);" onblur="skin.validateImageDom(event)" b="onkeyup:onEnter,placeholder:textImageUrl"> <button type="button" class="upload-button" onclick="skin.uploadFileGuest();" b="title:textAddAvatar,class:uploadClass"></button> <div class="error-label"></div> </div> <button class="login-button back" onclick="skin.loginDialog();" b="backText"></button> <button class="login-button" onclick="skin.login(guest);" b="loginText"></button> </div>',"rumbletalk-login":'<div class="dialog-content login-form rumbletalk-login-dialog"> <span role="button" class="close-button" onclick="skin.close();"></span> <div class="error-label"></div> <div class="row"> <label for="rumbletalk-username" class="login-label cell" b="username"></label> <input id="rumbletalk-username" name="username" type="text" class="field cell" maxlength="60" onkeyup="skin.enter(event, rumbletalk);"> </div> <div class="row"> <label for="rumbletalk-password" class="login-label cell" b="password"></label> <input id="rumbletalk-password" name="password" type="password" class="field cell" maxlength="46" onkeyup="skin.enter(event, rumbletalk);"> </div> <div class="row" shown="resetPassword"> <a id="forgot-password" href="https://profile.rumbletalk.com/access" target="_blank" b="forgotPassword"></a> </div> <button class="login-button back" onclick="skin.loginDialog();" b="backText"></button> <button class="login-button" onclick="skin.login(rumbletalk);" b="loginText"></button> </div>',"register-dialog":'<div class="dialog-content login-form register-login-dialog"> <div class="dialog-header" b="title"></div> <span role="button" class="close-button" onclick="skin.close();"></span> <form b="onsubmit:finishRegister" autocomplete="off"> <div class="row register-username"> <input name="username" class="field cell" type="text" maxlength="60" onblur="skin.validateUsernameDom(event);" b="value:username,onkeyup:onEnter,placeholder:textUsername"> <input type="hidden" class="valid-username" name="usernameValid" value="0" b="value:usernameValid"> <div class="error-label"></div> </div> <div class="row register-password"> <input name="password" class="field cell" type="password" maxlength="12" b="onkeyup:onEnter,placeholder:textPassword" onblur="skin.validatePasswordDom(event);"> <div class="error-label"></div> </div> <div class="row register-email"> <input name="email" class="field cell" maxlength="64" onblur="skin.validateEmailDom(event);" b="value:email,onkeyup:onEnter,placeholder:textEmail" type="text"> <div class="error-label"></div> </div> <div class="row first-name" style="display: none;"> <input name="firstName" class="field cell" type="text" maxlength="15" b="value:firstName,onkeyup:onEnter,placeholder:textFirstName"> </div> <div class="row last-name" style="display: none;"> <input name="lastName" class="field cell" type="text" maxlength="15" b="value:lastName,onkeyup:onEnter,placeholder:textLastName"> </div> <div class="row image-section"> <img class="image-preview" b="previewSrc"> <input id="register-image" name="image" class="field cell" type="text" maxlength="256" onchange="skin.previewImageRegister(this);" onblur="skin.validateImageDom(event)" b="value:image,onkeyup:onEnter,placeholder:textImageUrl"> <button type="button" class="upload-button" onclick="skin.uploadFileRegister();" b="title:textAddAvatar,class:uploadClass"></button> <div class="error-label"></div> </div> <div class="row description-section"> <textarea name="description" class="field cell" maxlength="250" b="description,onkeyup:onEnter,placeholder:textDescription"></textarea> </div> <div class="terms-row"> <a b="href:defaultTermsUrl" target="_blank"> <span b="defaultTermsTitle"></span> <img src="images/skins/general/new-tab.svg" alt="New tab"> </a> <div b="separatorText" shown="displayUserTerms"></div> <a b="href:termsUrl" target="_blank" shown="displayUserTerms"> <span b="termsTitle"></span> <img src="images/skins/general/new-tab.svg" alt="New tab"> </a> </div> <div class="action-buttons"> <button class="login-button back" type="button" onclick="skin.loginDialog();" b="textBack"></button> <button class="login-button" type="submit" b="continueButtonText"></button> <span b="cost" class="price"></span> </div> </form> <div class="dialog-footer"> <span b="alreadyMember"></span> <button onclick="skin.loginParamsDialog(rumbletalk);" b="textLogin"></button> </div> </div>',"payment-summary-dialog":'<div class="dialog-content payment-summary"> <div class="dialog-header" b="title"></div> <span role="button" class="close-button" onclick="skin.close();"></span> <div class="col-divider"> <div class="payment-option"> <img src="images/skins/general/monetize/shopping-cart.png" alt="PayPal"> </div> </div> <div class="col-divider"> <div class="summary-header" b="orderDetailsText"></div> <div class="summary-details"> <span b="textAmount"></span> <span class="summary" b="price"></span> </div> <div class="summary-header"> <span b="textProcessingFee"></span> <span class="summary" b="processingFee"></span> </div> <div class="summary-details"> <span b="textTotal"></span> <span class="summary" b="total"></span> </div> </div> <div class="action-buttons"> <button b="backString,onclick:backFunction" class="back"></button> <button b="continueString,onclick:continueFunction"></button> </div> </div>',"register-access-dialog":'<div class="dialog-content register-access"> <span role="button" class="close-button" onclick="skin.close(true);"></span> <b b="text"></b> <div class="terms-row"> <a b="href:defaultTermsUrl" target="_blank"> <span b="defaultTermsTitle"></span> <img src="images/skins/general/new-tab.svg" alt="New tab"> </a> <div b="separatorText" shown="displayUserTerms"></div> <a b="href:termsUrl" target="_blank" shown="displayUserTerms"> <span b="termsTitle"></span> <img src="images/skins/general/new-tab.svg" alt="New tab"> </a> </div> <button b="onclick:cancelFn,cancelText" class="back"></button> <button b="onclick:confirmFn,confirmText"></button> </div>',"no-button-dialog":'<div class="dialog-content"> <b b="text"></b> </div>',"confirm-dialog":'<div class="confirm-box"> <div b="text"></div> <div> <button b="onclick:cancelFnc,cancelText"></button> <button b="onclick:confirmFnc,confirmText"></button> </div> </div>',wait:'<div class="wait-dialog"> <div class="wait-loader"></div> <b b="text"></b> </div>',"one-button":'<div class="dialog-content" b="class:className"> <span role="button" class="close-button" shown="displayXButton" onclick="skin.close(true);"></span> <b b="text"></b> <button b="onclick:onclick,buttonText"></button> </div>',"image-preview":'<div class="dialog-content"> <span role="button" class="close-button" onclick="skin.close(true);"></span> <a b="href:image" target="_blank"><img b="image,onload:callback" class="avatar-full"></a> </div>',"invite-template":'<div class="dialog-content"> <span role="button" class="close-button" onclick="skin.close();"></span> <b b="inviteFrom"></b> <button class="login-facebook login-type-button" onclick="skin.inviteFacebook();" b="title:facebookTitle"> <span b="facebook"></span> </button> <button class="login-twitter login-type-button" onclick="skin.inviteTwitter();" b="title:twitterTitle"> <span b="twitter"></span> </button> </div>',"options-template":'<div class="dialog-content options-dialog"> <span role="button" class="close-button" onclick="skin.close();"></span> <h4 b="header"></h4> <div b="statuses" class="user-statuses" shown="userStatus"></div> <div b="buttons" class="items"></div> <div class="footer" shown="footer"> <a target="_blank" href="https://rumbletalk.com" b="footerText"></a> </div> </div>',"upload-dialog":'<div class="dialog-content"> <span role="button" class="close-button" onclick="skin.close();"></span> <div class="upload-dialog-box" b="class:classNames"> <h3 shown="displayPlan"> <a b="href:upgradeLink" target="_blank"> <span b="paid_plans_only"></span> <img src="images/skins/general/new-tab.svg" alt="New tab"> </a> </h3> <button onclick="skin.uploadFileDialog();"> <img src="chat/upload_file.png" b="alt:add_file"> <span b="add_file"></span> </button> <button shown="webRTCSupport" onclick="skin.takePhotoDialog();"> <img src="chat/take_photo.png" b="alt:take_photo"> <span b="take_photo"></span> </button> <button shown="webRTCSupportAudio" onclick="skin.recordAudioDialog();"> <img src="chat/audio_recording.png" b="alt:record_audio"> <span b="record_audio"></span> </button> <button shown="webRTCSupportVideo" onclick="skin.recordVideoDialog();"> <img src="chat/video_recording.png" b="alt:record_video"> <span b="record_video"></span> </button> </div> </div>',"take-photo-template":'<div class="dialog-content take-photo-dialog"> <span role="button" class="close-button" onclick="skin.close();"></span> <h2 b="takePhoto"></h2> <div class="canvas-holder"> <canvas></canvas> <video muted></video> </div> <div class="photo-buttons"> <div class="take-photo-buttons"> <button class="take-photo" onclick="skin.previewPhoto();" b="takePhoto"></button> </div> <div class="send-photo-buttons"> <button class="retake-photo" onclick="skin.previewPhoto(true);" b="cancel"></button> <button class="add-photo" onclick="skin.uploadPhoto();" b="add"></button> </div> </div> </div>',"record-audio-template":'<div class="dialog-content"> <span role="button" class="close-button" onclick="skin.close();"></span> <h2 b="recordAudio"></h2> <div class="audio-holder"> <audio></audio> </div> <div class="record-audio-buttons"> <button class="startAudioRecording" onclick="skin.recordAudioStart(this.parentNode.parentNode);" b="recordAudio"></button> <button class="stopAudioRecording" onclick="skin.recordAudioStop(this.parentNode.parentNode);" style="display:none;" b="stop"></button> <button class="uploadAudioRecording" onclick="skin.uploadAudio();" disabled="disabled" b="add"></button> </div> <span class="time-left-audio"></span> </div>',"record-video-template":'<div class="dialog-content"> <span role="button" class="close-button" onclick="skin.close();"></span> <h2 b="recordVideo"></h2> <div class="video-holder"> <video></video> </div> <div class="record-video-buttons"> <button class="startVideoRecording" onclick="skin.recordVideoStart(this.parentNode.parentNode);" b="recordVideo"></button> <button class="stopVideoRecording" onclick="skin.recordVideoStop(this.parentNode.parentNode);" style="display:none;" b="stop"></button> <button class="uploadVideoRecording" onclick="skin.uploadVideo();" disabled="disabled" b="add"></button> </div> <span class="time-left-video"></span> </div>',"export-footer":'<div style="margin-top: 100px; text-align: center; font-size: 11px;"> Powered by <a href="https://rumbletalk.com" target="_blank">RumbleTalk</a> &copy; </div>',"export-script":"if (location.protocol == 'file:') { var imgs = document.getElementsByTagName('img'), patt = /^file:/; for (var i in imgs) { if (imgs.hasOwnProperty(i)) { if (patt.test(imgs[i].src)) { imgs[i].src = 'http:' + imgs[i].src.substr(5); } } } }","export-style":".rumbletalk-archive .image { max-width: 35px; max-height: 35px; } .rumbletalk-archive .user-message { border: 1px solid #EEE; padding: 5px; margin: 3px; } .rumbletalk-archive .name { vertical-align: top; font-weight: bold; margin-right: 10px; } .rumbletalk-archive .time { float: right; } .rumbletalk-archive .text { vertical-align: top; }","export-message":'<div b="class:className"> <img class="image" b="image,alt:name"> <span class="name" b="name"></span> <span class="time" b="time"></span> <span class="text" b="text"></span> </div>',"user-info-template":'<div class="user-messaging private-chat-view"> <div class="private-chat-header"> <div> <img class="user-info-image" b="image,alt:name,title:name,onclick:imagePreview" role="button"> <div class="private-chat-username" b="name,onclick:mobileFn,title:name"></div> </div> <div class="private-chat-menu"> <button class="private-menu-toggle" onclick="skin.togglePrivateMenu();">&#9776;</button> <div class="private-menu-items"> <button class="private-chat-round-button private-chat-settings" b="title:textSettings" onclick="skin.switchPrivateView(\'user-settings\')"> <span b="textSettings"></span> </button> <button class="private-chat-round-button private-chat-answer-video" shown="displayVideo" b="onclick:videoCall,disabled:disabled,title:textCallVideo"> <span b="textCallVideo"></span> </button> <button class="private-chat-round-button private-chat-answer-audio" shown="displayAudio" b="onclick:audioCall,disabled:disabled,title:textCallAudio"> <span b="textCallAudio"></span> </button> <button class="private-chat-round-button private-chat-request-payment" shown="displayRequestPayment" b="title:textRequestPayment" onclick="skin.switchPrivateView(\'payment-request\')"> <span b="textRequestPayment"></span> </button> </div> </div> </div> <div b="messagesLog" class="message-log"></div> </div> <div class="user-settings private-chat-view"> <div class="user-setting-info login-type"> <span b="login_type"></span> <div b="loginTypeName"></div> </div> <div class="user-settings-items" b="userSettingsItems"></div> <button class="user-settings-back-button back" onclick="skin.switchPrivateView(\'user-messaging\')" b="back"> </button> </div> <div class="payment-request private-chat-view"> <form onsubmit="return skin.sendPaymentRequest();"> <div class="request-payment-header" b="paymentHeader"></div> <div class="request-payment-amount"> <label for="request-amount" b="amountText"></label> <div class="input-group input-currency" b="data-currency:currencySymbol"> <input type="number" name="amount" id="request-amount" placeholder="0" b="min:payMin,max:payMax" onkeyup="skin.updatePaymentRequestFee(this.value);"> <div class="input-group-append" b="currencyCode"></div> </div> <small class="total-amount-text" b="totalAmountText"></small> <small id="request-fee" b="data-currency:currencySymbol">0</small> </div> <div class="action-buttons"> <button type="button" class="back" b="cancelText" onclick="skin.closeRequestPayment()"></button> <button type="submit" b="requestText"></button> </div> </form> </div>',"p2p-message-template":'<div class="p2p-message"> <div class="message-bubble"> <span b="date,title:fullDate" class="message-date"></span> <span b="text" class="message-text"></span> </div> </div>',"button-template":'<button type="button" b="class:className,onclick:fn,title:title,text"></button>',"toggle-switch-template":'<label class="switch" b="class:className,title:title"> <span class="text" b="text"></span> <input type="checkbox" b="onchange:fn,checked:isChecked"> <span class="slider"></span> </label>',"plus-minus-template":'<div class="plus-minus" b="class:className,title:title"> <span class="text" b="text"></span> <div class="buttons"> <button b="onclick:minusFn" class="minus">-</button> <button b="onclick:plusFn" class="plus">+</button> </div> </div>',"user-setting-info-template":'<div class="user-setting-info" b="class:className"> <span b="label"></span> <div b="text"></div> </div>',"private-chat-template":'<div id="private-chat-log" class="private-chat-log" ondragenter="privateChat.imageDragEnter(event)" ondragleave="privateChat.imageDragLeave(event)" ondrop="skin.imageDrop(event)"></div> <div class="private-chat-text-cover"> <div class="private-chat-text" b="style:inputStyle" onkeydown="skin.privateKeyDown(event)" onkeyup="skin.privateEnter(event)" onblur="skin.preventSingleBr(event)" contenteditable="false" onpaste="skin.textOrImagePaste(event)"></div> <div class="private-placeholder" b="placeholderText,style:inputStyle" aria-hidden="true" role="presentation" tabindex="-1"></div> <button type="button" b="disabled:inputDisabled,title:textSend" class="private-chat-send" shown="displaySend" onclick="skin.sendPrivateMessage();"></button> <button type="button" b="style:displayUpload,title:textAdd,disabled:away" class="private-chat-upload" onclick="skin.privateUploadDialog();"></button> <button type="button" b="style:displaySmiley,title:textEmoji,disabled:away" class="private-chat-smiley" onclick="skin.toggleSmiliesPrivate(event);"></button> </div>',"private-message-template":'<div class="main-message-container"> <img b="image,alt:name" class="message-user-image"/> <div class="message-bubble"> <div class="menu-wrap" shown="displayMenu"> <span class="menu-icon" role="button" onclick="skin.openMenu(this);"></span> <div class="menu-items"> <button b="deleteText,onclick:deleteFn" class="delete-private-message"></button> </div> </div> <span b="date,title:fullDate" class="message-date"></span> <span b="text" class="message-text"></span> </div> </div>',"loader-template":'<div class="loading-bar"> <div b="text"></div> <div class="loader"></div> </div>',"content-message":'<div b="text" class="content-message"></div>',"donate-template":'<div class="user-preview donation-basic"> <span role="button" class="close-button" onclick="skin.toggleDonate(true);"></span> <img class="donate-user-image"> <span class="donate-username"></span> <input type="text" name="message" class="donate-message" b="placeholder:placeholder"> </div> <div class="amount-section"> <span b="currencySymbol"></span> <input type="number" name="amount" class="donation-amount" placeholder="0.00" b="min:min,max:max" onkeyup="skin.setDonateAmount(this.value, this)" onchange="skin.setDonateAmount(this.value, this)"> <span b="currencyCode"></span> </div> <div class="amount-options"></div> <button type="button" onclick="skin.confirmDonateDialog(this);" b="text"></button>',"donate-confirm-template":'<div class="donate-confirm"> <span role="button" class="close-button" onclick="skin.close();"></span> <h3 b="header"></h3> <p> <span b="paragraph"></span> <a href="https://rumbletalk.com/about_us/tc_payments/" b="readMore" target="_blank"></a> </p> <div class="send-donation-button-wrap"> <button type="button" b="onclick:fn,btnText"></button> </div> </div>',"donation-message-template":'<div class="message-bubble donation-message-container"> <img b="image,onclick:userDetails" class="message-user-image" role="button"> <div class="message-user-name" b="name,onclick:userDetails"></div> <span b="date" class="message-date"></span> <div class="donation-bubble" b="class:className"> <span class="donate-text" b="donateText"></span> <span class="donate-amount" b="donateAmount"></span> <div class="donate-message" b="text"></div> </div> </div>',"request-payment-notice-template":'<div class="request-payment-notice"> <button class="payment-request-dismiss" b="title:dismissText,onclick:dismissFn"></button> <button class="private-chat-block" b="payText,onclick:payFn"></button> <div b="text"></div> <a b="termsText,href:termsLink" class="request-payment-terms" target="_blank"></a> </div>',"s3upload-template":'<form id="s3upload-form" target="s3upload-iframe" b="action:s3Bucket" method="post" enctype="multipart/form-data"> <iframe id="s3upload-iframe" name="s3upload-iframe"></iframe> <input type="hidden" name="key"> <input type="hidden" name="acl" value="public-read"> <input type="hidden" name="Content-Type" value=""> <input type="hidden" name="AWSAccessKeyId" b="value:s3Key"> <input type="hidden" name="success_action_status" value="200"> <input type="hidden" name="Policy"> <input type="hidden" name="Signature"> <input id="s3upload-file-input" type="file" name="file"> </form>',"calling-box-template":'<div id="calling-box" role="dialog" aria-label="Call dialog"> <video id="calling-box-video" autoplay playsinline></video> <video id="calling-box-video-mini" autoplay playsinline></video> <div id="calling-box-details"> <img class="calling-box-avatar user-image"> <div class="calling-box-name-status"> <div class="calling-box-name"></div> <div id="calling-box-status"></div> </div> </div> <div id="calling-box-items"> <div id="calling-box-answer-buttons"> <button id="calling-box-answer-video" b="title:answerVideo" shown="displayVideo" onclick="skin.answerCall(event, \'video\');"></button> <button id="calling-box-answer-audio" b="title:answerAudio" shown="displayAudio" onclick="skin.answerCall(event, \'audio\');"></button> <button class="calling-box-decline" b="title:decline" onclick="skin.callingDecline(event);"></button> </div> <div id="calling-box-options"> <button class="calling-box-swap-camera" b="title:swapCameras" onclick="skin.swapCamera(event);"></button> <button class="calling-box-minimize" b="title:minimize" onclick="skin.callingMinimize(event);"></button> <button class="calling-box-decline" b="title:decline" onclick="skin.callingDecline(event);"></button> <button class="calling-box-mic" b="title:micToggle" onclick="skin.callingToggleMic(this);"></button> <button class="calling-box-camera" b="title:cameraToggle" shown="displayVideo" onclick="skin.callingToggleCamera(this);"></button> </div> </div> </div>',"user-info-main-template":'<div id="user-info"> <span role="button" class="close-button" onclick="skin.closeUserDetails();"></span> <span role="button" class="full-screen-button" onclick="skin.fullscreen();"></span> <div class="content"></div> <div class="resizer-corner" id="resizer-top-left"></div> <div class="resizer-corner" id="resizer-top-right"></div> <div class="resizer-corner" id="resizer-bottom-left"></div> <div class="resizer-corner" id="resizer-bottom-right"></div> <div class="resizer-horizontal-border" id="resizer-top"></div> <div class="resizer-horizontal-border" id="resizer-bottom"></div> <div class="resizer-vertical-border" id="resizer-left"></div> <div class="resizer-vertical-border" id="resizer-right"></div> </div>',"mobile-top":'<div class="top-bar"> <div id="invite-dialog" class="mobile-dialog"> <button class="login-type-button login-facebook" onclick="facebook.invite();"> <span b="facebook"></span> </button> <button class="login-type-button login-twitter" onclick="twitter.invite();"> <span b="twitter"></span> </button> </div> <div id="top-bar-left" class="mobile-dialog-button"> <img class="invite-icon" src="https://d1pfint8izqszg.cloudfront.net/images/skins/mobile/new/invite.png"> <span b="invite"></span> </div> <div id="top-bar-right" onclick="skin.optionsDialog();"> <img src="https://d1pfint8izqszg.cloudfront.net/images/skins/mobile/new/menu.png" b="alt:options"> </div> </div>',"mobile-bottom":'<div id="bottom"> <button id="users" class="mobile-dialog-button"> <span id="users-messages-count"></span> <img src="https://d1pfint8izqszg.cloudfront.net/images/skins/mobile/new/users.png" b="alt:users"> </button> <button id="photo"> <img src="https://d1pfint8izqszg.cloudfront.net/images/skins/mobile/new/photo.png" b="alt:takePhoto"> </button> <button id="uploadMobile"> <img src="https://d1pfint8izqszg.cloudfront.net/images/skins/mobile/new/upload.png" b="alt:add"> </button> </div>',"mention-tooltip-template":'<div class="mention-tooltip dialog"> <div class="mention-users"></div> </div>',"mention-tooltip-item":'<div class="mention-item" b="class:isAdmin,onclick:selectFn,data-user-id:userId"> <img b="avatar"> <span b="username"></span> </div>',"gui-parse-image":'<a b="href:href,title:title" target="_blank" rel="nofollow"> <img b="image,alt:alt" onload="gui.updateImageSrc(this);"> </a>',"gui-parse-youtube":'<div class="youtube-wrap"> <img b="image,alt:alt" onload="gui.updateYouTubeImage(this);"> <div class="youtube-play" b="onclick:loadFn"></div> </div>',"gui-parse-video":'<video b="poster:poster" onloadedmetadata="gui.initVideo(this);" muted width="32" height="32" preload="metadata"> <source b="source,type:mime" onerror="gui.updateVideoAudioSrc(this);"> </video>',"gui-parse-audio":'<audio controls preload="metadata"> <source b="source,type:mime" onerror="gui.updateVideoAudioSrc(this);"> </audio>',"gui-parse-link":'<a b="href:href" rel="nofollow" target="_blank"> <img b="thumbnail,alt:filename" class="file-icon" shown="thumbnail"> <span b="filename"></span> </a>',"premium-upgrade-template":'<div class="dialog-content premium-upgrade"> <span role="button" class="close-button" onclick="skin.close();"></span> <h2>Hey There!</h2> <p>It looks like you are trying to use a premium feature</p> <a b="href:upgradeLink" target="_blank" class="button premium-button">Upgrade to RumbleTalk premium</a> <div class="subtext">Requires an account</div> <p class="premium-learn-more"> Learn more about <a href="https://rumbletalk.com/premium" target="_blank">RumbleTalk premium</a> </p> </div>',"admin-mode-alert":'<div id="alert"> <span b="adminModeText"></span> <button class="btn-link" b="buttonText" onclick="skin.toggleAdminMode(false, true);"></button> <span class="tooltip" b="tooltipText"></span> </div>',"welcome-message-template":'<div id="welcome-message" class="dialog"> <span role="button" class="close-button" onclick="skin.closeWelcomeMessage();"></span> <div b="text"></div> </div>',"upload-image-dialog":'<div id="upload-image" class="upload-image-dialog dialog-content" b="class:classNames"> <span role="button" class="close-button" onclick="skin.close();"></span> <h2 b="title"></h2> <h3 shown="isFreeAccount"> <a b="href:upgradeLink" target="_blank"> <span b="free_text"></span> <img src="images/skins/general/new-tab.svg" alt="New tab"> </a> </h3> <div> <img class="image-preview" b="previewSrc"> </div> <button class="back" b="onclick:cancelFn,cancelText"></button> <button class="btn-upload" b="onclick:uploadFn,uploadText"></button> </div>',"user-status-template":'<input type="radio" name="user-status" class="user-status" b="id:id,value:value,onclick:fn,checked:checked"> <label b="for:for,text"></label>',"polls-dialog-template":'<div class="dialog-content polls-dialog"> <span role="button" class="close-button" onclick="skin.close();"></span> <h2 b="header"></h2> <div id="polls-dialog-content" class="block"> <div id="polls-table" class="flex-table" b="polls"></div> <div class="polls-pagination-wrapper"> <div class="polls-pagination" shown="hasPage"> <button class="polls-pagination-buttons" id="polls-pagination-prev" onclick="skin.pollsPaginate(\'-\')">&#8249;</button> <button class="polls-pagination-buttons" id="polls-pagination-next" onclick="skin.pollsPaginate(\'+\')">&#8250;</button> </div> </div> <button class="btn-polls create" b="onclick:createNewPollFn,createNewPollText"></button> </div> <div id="polls-dialog-loader" class="wait-dialog hidden"> <div class="wait-loader"></div> <b b="loaderText"></b> </div> </div>',"polls-row-template":'<div class="flex-row"> <div class="flex-cell question-container" b="class:deletedClass"> <i class="pencil"></i> <span class="question" b="questionText,onclick:viewFn"></span> </div> <div class="flex-cell create-date" b="createDateText"></div> <div class="flex-cell status"> <div class="polls-status" b="class:className"> <span b="statusText"></span> <span class="tooltip-content" b="tooltipText"></span> </div> </div> <div class="flex-cell delete-container"> <i class="btn-polls-delete" b="onclick:deletePollFn" shown="isNotDeleted"></i> </div> </div>',"polls-no-row-template":'<div class="flex-row no-records"> <div class="flex-cell" b="text"></div> </div>',"polls-update-dialog-template":'<div id="polls-update-dialog" class="dialog-content polls-update-dialog"> <span role="button" class="close-button" onclick="skin.pollsCancel(true);"></span> <h2 b="header"></h2> <form id="polls-update-form" onsubmit="event.preventDefault();"> <div class="form-group"> <label class="required" for="question" b="questionLabel"></label> <input id="question" type="text" class="form-field" b="value:question" onchange="skin.pollInputChange(event, \'question\')"> </div> <div class="form-group"> <label class="required" for="answer1" b="answer1Label"></label> <input id="answer1" type="text" class="form-field" b="value:answer1" onchange="skin.pollInputChange(event, \'answer1\')"> </div> <div class="form-group"> <label class="required" for="answer2" b="answer2Label"></label> <input id="answer2" type="text" class="form-field" b="value:answer2" onchange="skin.pollInputChange(event, \'answer2\')"> </div> <div class="form-group"> <label for="answer3" b="answer3Label"></label> <input id="answer3" type="text" class="form-field" b="value:answer3" onchange="skin.pollInputChange(event, \'answer3\')"> </div> <div class="form-group"> <label for="answer4" b="answer4Label"></label> <input id="answer4" type="text" class="form-field" b="value:answer4" onchange="skin.pollInputChange(event, \'answer4\')"> </div> <div class="btn-group-poll"> <button id="btn-polls-cancel" type="button" class="btn-polls cancel" b="cancelText,onclick:cancelFn"></button> <button id="btn-polls-delete" type="button" class="btn-polls delete" b="deleteText,onclick:deleteFn" shown="isNotCreateAndDeleted"></button> <button id="btn-polls-save" type="button" class="btn-polls save" b="saveText,onclick:saveFn"></button> <button id="btn-polls-send" type="button" class="btn-polls send" b="sendText,onclick:sendFn"></button> </div> </form> </div>',"polls-view-dialog-template":'<div class="polls-view-dialog" b="class:dlgClass"> <span role="button" class="close-button" onclick="skin.close(true);" shown="isNotPublished"></span> <div class="polls-view-header"> <h2 b="header"></h2> <b b="votes" shown="isNotVoting"></b> </div> <div class="polls-view-subheader"> <h3 b="question"></h3> <span class="lock"></span> </div> <div class="polls-answers-container" b="answers"></div> <div class="btn-group-poll" shown="isNotVoting"> <button id="btn-polls-cancel" type="button" class="btn-polls cancel" b="cancelText,onclick:cancelFn" shown="isNotPublished"></button> <button id="btn-polls-delete" type="button" class="btn-polls delete" b="deleteText,onclick:deleteFn" shown="isNotDeleted"></button> <button id="btn-polls-reset" type="button" class="btn-polls reset" b="resetText,onclick:resetFn" shown="isActive"></button> <button id="btn-polls-resend" type="button" class="btn-polls resend" b="resendText,onclick:resendFn" shown="isActive"></button> <button id="btn-polls-publish" type="button" class="btn-polls publish" b="publishText,onclick:publishFn" shown="isActive"></button> <button id="btn-polls-publish-again" type="button" class="btn-polls publish-again" b="publishAgainText,onclick:publishAgainFn" shown="isPublished"></button> </div> <button type="button" class="btn-polls close" b="closeText,onclick:closeFn" shown="isVoting"></button> </div>',"polls-view-answer-template":'<div class="answer-container" b="class:votingClass,onclick:voteFn"> <div class="details"> <b b="answer"></b> <div shown="isNotVoting"> <span class="polls-count" b="count" shown="isNotVoting"></span> <span class="polls-percentage" b="percentage"></span> </div> </div> <div class="progress-container" shown="isNotVoting"> <div class="progress-bar" b="class:className,style:style"></div> </div> </div>'},init:function(){gui.smiliesInit(),gui.donationsInit(),gui.textFormatInit()},textFormatInit:function(){var e,t={};for(e in gui.styles)gui.styles.hasOwnProperty(e)&&(t[e]=new RegExp("(\\W|_|^)(\\"+gui.styles[e]+")([^<>]+)(\\"+gui.styles[e]+")(\\W|_|$)","i"));gui.styles=t},smiliesInit:function(){if(cfg.parsers.smilies){var e;for(e in gui.smilies)gui.smilies.hasOwnProperty(e)&&(gui.smiliesRegex[e]=new RegExp("(\\s|^)"+gui.safe(gui.smilies[e]).replace(/(\W)/g,"\\$1")+"(\\s|$)","g"));skin.smiliesBox=t(skin.addToText),skin.chatExtra.appendChild(skin.smiliesBox),cfg.privateChat&&(skin.smiliesBoxPrivate=t(privateChat.addText)),skin.smiley.onclick=function(e){e.stopPropagation(),_i.mobile&&skin.mobileClearScreen(e,skin.smiliesBox),skin.toggleDonate(!0),skin.toggleSmilies()}}function t(t){var s,i=document.createElement("DIV");for(e in i.className="smilies-box mobile-dialog",gui.smilies)gui.smilies.hasOwnProperty(e)&&6!=e&&((s=new Image).src="images/smiles/yellow/s"+e+".png",s.className="smiley-"+e,s.smileyIndex=e,s.onclick=function(){t(gui.smilies[this.smileyIndex])},i.appendChild(s));return i}},donationsInit:function(){if(cfg.monetize.donations){skin.donateBox=document.createElement("div"),skin.donateBox.className="donate-dialog",skin.donateBox.innerHTML=gui.template("donate-template",{placeholder:cfg.strings.donate_message_string,text:cfg.strings.donate,currencySymbol:cfg.monetize.currencySymbol,currencyCode:cfg.monetize.currency,min:monetize.MIN_PAYMENT,max:monetize.MAX_PAYMENT});var e,t,s="",i=monetize.currencyMultiplier(cfg.monetize.currency);for(e in monetize.DONATION_CLASSES)monetize.DONATION_CLASSES.hasOwnProperty(e)&&(t=e*i,s+=gui.template("button-template",{fn:"skin.setDonateAmount("+t+", this);",title:cfg.monetize.currencySymbol+t,text:cfg.monetize.currencySymbol+t,className:monetize.DONATION_CLASSES[e]}));_i.firstCss("amount-options",skin.donateBox).innerHTML=s,skin.chatExtra.appendChild(skin.donateBox),skin.donate.onclick=function(e){e.stopPropagation();var t=rtc.user(auth.id);_i.firstCss("donate-user-image",skin.donateBox).src=t.image,_i.firstCss("donate-username",skin.donateBox).innerHTML=t.name,skin.toggleSmilies(!0),skin.toggleDonate()}}},template:function(e,t,s){var i,a,n=document.createElement("div");n.innerHTML=gui.templatesHash[e],i=_i.all(n);for(var o=0;o<i.length;o++){var r=i[o],l=r.getAttribute("b"),c=r.getAttribute("shown");if(c){if(!t[c]){_i.remove(r),o--;continue}r.removeAttribute("shown")}if(l){var d=l.split(",");for(a in d)if(d.hasOwnProperty(a)){var u=d[a].split(":");if(u.length>1)void 0!==t[u[1]]&&("class"==u[0]?_i.addClass(r,t[u[1]]):r.setAttribute(u[0],t[u[1]]));else if(void 0!==t[u[0]]){r[-1===["IMG","SOURCE"].indexOf(r.tagName)?"innerHTML":"src"]=t[u[0]]}}r.removeAttribute("b")}}if(s&&n.children.length>1)throw new Error("Template has more than one child and can not be returned as node");return s?n.children[0]:n.innerHTML.trim()},date:function(e,t){var s,i,a=new Date(e),n={M:a.getMonth()+1,D:a.getDate(),Y:a.getFullYear(),H:a.getHours(),m:a.getMinutes()};for(i in n)n.hasOwnProperty(i)&&(1==(s=n[i]+"").length&&(s="0"+s),t=t.replace(i,s));return t},safe:function(e){return(e=String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"))||""},textFormat:function(e){var t;for(t in gui.styles)gui.styles.hasOwnProperty(t)&&(e=e.replace(gui.styles[t],"$1<"+t+">$3</"+t+">$5"));return e},parse:function(e){function t(e,t,s,i){if(!i)return t;var a=e.splice(t,1)[0],n=a.str.indexOf(s);0<n&&e.splice(t++,0,{str:a.str.substring(0,n),replaced:!1}),e.splice(t++,0,{str:i,replaced:!0});var o=a.str.substring(n+s.length);return o&&e.splice(t++,0,{str:o,replaced:!1}),--t}var s,i,a,n,o=[{str:gui.safe(e),replaced:!1}],r=o[0].str.match(gui.httpLinksPattern);for(n=0;n<o.length;n++)if(!o[n].replaced)for(i=0;r&&i<r.length;i++){var l,c,d=r[i].trim(),u=d;if(/^(https?:)?\/\//.test(d)||(d="https://"+d),cfg.httpsOnly&&/^http:\/\//.test(d))cfg.parsers.links&&(l=gui.template("gui-parse-link",{href:gui.decode(d),thumbnail:!1,filename:u}));else if(cfg.parsers.images&&/\.(png|gif|jpg|jpeg|bmp|svg)(\?.*)?$/i.test(u))l=gui.template("gui-parse-image",{href:d,title:cfg.strings.click_to_see_image,alt:cfg.strings.thumbnail,image:cfg.defaultImg});else if(cfg.parsers.videos&&((s=u.match(/youtube.com\/watch\?[a-z&=0-9\-\+_]*v=([a-z0-9\-\_]+)/i))||(s=u.match(/youtu\.be\/([a-zA-Z0-9\-\_]+)/i))))l=gui.template("gui-parse-youtube",{image:"https://img.youtube.com/vi/"+s[1]+"/mqdefault.jpg",alt:cfg.strings.thumbnail,loadFn:"gui.loadVideo(this, '"+s[1]+"');"});else if(cfg.parsers.videos&&(s=u.match(/vimeo.com\/(\d+)/i)))l=_i.html("iframe",{width:"100%",height:"100%",src:"https://player.vimeo.com/video/"+s[1],allow:"autoplay; fullscreen"});else if(cfg.parsers.videos&&(c=_i.browserVideoSupport(u)))l=gui.template("gui-parse-video",{poster:cfg.defaultImg,mime:"video/"+c,source:-1===d.indexOf("#")?d+"#t=0.01":d});else if(cfg.parsers.audios&&(c=_i.browserAudioSupport(u)))l=gui.template("gui-parse-audio",{mime:"audio/"+c,source:d});else if(cfg.parsers.links){var g=_i.getFileThumbnail(u);l=gui.template("gui-parse-link",{href:gui.decode(d),thumbnail:g,filename:g?u.replace(/^.*[\\\/]|\?[^?]*$/,""):u})}n=t(o,n,u,l)}for(n=0;n<o.length;n++)if(!o[n].replaced){if(cfg.parsers.smilies)for(i in gui.smiliesRegex)if(gui.smiliesRegex.hasOwnProperty(i))for(a=0;a<2;a++)o[n].str=o[n].str.replace(gui.smiliesRegex[i],"$1"+_i.html("img",{src:"images/smiles/yellow/s"+i+".png",class:"smiley-icon smiley-"+i})+"$2");var p;if(cfg.mentions&&rtc.maxUsernameLength>0&&(o[n].str=mentions.parse(o[n].str)),keywords.pool.length>0)if(keywords.keywordCountCheck())for(i=0;i<keywords.pool.length;i++)if(p=o[n].str.match(keywords.pool[i].regex)){o[n].str=o[n].str.replace(keywords.pool[i].regex,"$1"+_i.html("a",{href:keywords.pool[i].link,rel:"nofollow",target:"_blank",class:"keyword",onclick:"keywords.track('clicked', '"+p[0].toLowerCase()+"');"},[p[0]])+"$2"),keywords.track("impression",p[0].toLowerCase()),keywords.keywordCountCheck(!0);break}o[n].str=o[n].str.replace(/\n/g,"<br>"),o[n].str=gui.textFormat(o[n].str)}for(e="",n=0;n<o.length;n++)e+=o[n].str;return e},loadVideo:function(e,t){for(var s=e.parentNode;s.lastChild;)s.removeChild(s.lastChild);_i.addClass(s,"initiated"),_i.create("iframe",{src:"https://www.youtube.com/embed/"+t+"?autoplay=1&wmode=opaque",allow:"autoplay; fullscreen"},s)},updateImageSrc:function(e){if(e.onload=null,document.body.contains(e)){for(var t=new Image,s=e.parentNode,i=s.href,a=0;"message-text"!=s.className&&"content"!=s.id;)s=s.parentNode;_i.now()-parseInt(s.getAttribute("data-time")||0)>gui.imgOld&&(a=gui.loadingTries-1),t.onload=function(){t.onload=null,t.onerror=null,e.src=t.src,e.onload=function(){skin.chatFrame.contains(e)?skin.scroll():privateChat.scroll()}},t.onerror=function s(){if(i==t.src)return a<gui.loadingTries?(a++,setTimeout((function(){t.src="",_i.ua==_i.userAgents.FIREFOX&&s()}),gui.loadingPause)):(this.onload=null,this.onerror=null,_i.remove(e)),!1;t.src=i},t.src=i}},updateVideoAudioSrc:function(e,t){if(e.onerror=null,document.body.contains(e)){var s=document.createElement(e.parentNode.nodeName),i=document.createElement("source"),a=e.parentNode,n=e.src;t=t||0,s.preload="metadata",s.onloadedmetadata=function(){this.onloadedmetadata=null,this.childNodes[0].onerror=null,a.load()},i.type=e.type,i.onerror=function(){var e=this;t<gui.loadingTries?(t++,setTimeout((function(){e.parentNode.load()}),gui.loadingPause)):(e.parentNode.onloadedmetadata=null,e.onerror=null,_i.remove(a))},s.appendChild(i),i.src=n}},initVideo:function(e,t){if(e.onloadedmetadata=null,e.removeAttribute("onloadedmetadata"),document.body.contains(e)){if(t=_i.extend({autoplay:!1,muted:!1,loop:!1,autowidth:!0,controls:!0},t),e.removeAttribute("poster"),t.autoplay?e.play():e.pause(),t.controls&&(e.controls=!0),t.autowidth&&(e.width=e.videoWidth),e.removeAttribute("height"),_i.ua==_i.userAgents.FIREFOX){e.onended=t.loop?function(){e.load(),e.play()}:e.load}else e.loop=t.loop;t.muted||setTimeout((function(){e.muted=!1}),1)}},updateYouTubeImage:function(e){if(e.onload=null,document.body.contains(e)&&!(e.width<=120)){var t=new Image,s=!1;t.onload=function(){t.width>120?(t.onload=null,e.src=t.src):s||(t.src=e.src.replace("mqdefault.jpg","sddefault.jpg"),s=!0)},t.src=e.src.replace("mqdefault.jpg","maxresdefault.jpg")}},decode:function(e){return(e=String(e).replace(/&amp;/g,"&"))||""}},_i={w:window,d:document,exposed:{},l:null,b:null,mobile:!1,webrtc:!!navigator.mediaDevices,p2p:"undefined"!=typeof RTCPeerConnection,protocol:"https:"===document.location.protocol?"https:":"http:",ua:0,uaVersion:0,userAgents:{IE:0,FIREFOX:1,CHROME:2,SAFARI:3,OPERA:4,EDGE:5},chatTypes:{GROUP:0,ONE_ON_ONE:1,MODERATED:2,PRIVATE:3},accountTypes:{FREE:0,PAID:1,PAID_END:2,TRIAL:3,SUPER:10},init:function(){var e,t,s=[["MSIE"],["FIREFOX"],["CHROME"],["SAFARI","CHROME"],["OPERA"]],i=navigator.userAgent.toUpperCase();if(-1!==i.indexOf("EDG"))_i.ua=_i.userAgents.EDGE;else if(-1!==i.indexOf("TRIDENT"))_i.ua=_i.userAgents.IE;else for(e in s)if(s.hasOwnProperty(e)&&-1!==i.indexOf(s[e][0])&&(!s[e][1]||-1===i.indexOf(s[e][1]))){_i.ua=Number(e);break}switch(_i.ua){case _i.userAgents.CHROME:t=i.indexOf("CHROME/"),_i.uaVersion=parseFloat(i.substring(t+7));break;case _i.userAgents.SAFARI:t=i.indexOf("VERSION/"),_i.uaVersion=parseFloat(i.substring(t+8));break;case _i.userAgents.FIREFOX:t=i.indexOf("FIREFOX/"),_i.uaVersion=parseFloat(i.substring(t+8));break;case _i.userAgents.OPERA:-1!==i.indexOf("OPERA/")?(t=i.indexOf("OPERA/"),_i.uaVersion=parseFloat(i.substring(t+6))):(t=i.indexOf("OPR/"),_i.uaVersion=parseFloat(i.substring(t+4)));break;case _i.userAgents.EDGE:-1!==i.indexOf("EDGE/")?(t=i.indexOf("EDGE/"),_i.uaVersion=parseFloat(i.substring(t+5))):(t=i.indexOf("EDG/"),_i.uaVersion=parseFloat(i.substring(t+4)));break;case _i.userAgents.IE:-1!==i.indexOf("MSIE ")?(t=i.indexOf("MSIE "),_i.uaVersion=parseFloat(i.substring(t+5))):_i.uaVersion=11}String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return t=t>0?0|t:0,this.substring(t,t+e.length)===e}}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),_i.mobile=-1!==i.indexOf("MOBILE")||-1!==i.indexOf("ANDROID")||-1!==i.indexOf("IOS"),_i.l=_i.d.location,_i.b=_i.d.body},storage:{data:{},getItem:function(e,t){try{return e===rtc.hash?t?JSON.parse(localStorage.getItem(e)):JSON.parse(sessionStorage.getItem(e)):t?JSON.parse(localStorage.getItem(rtc.hash))[e]:JSON.parse(sessionStorage.getItem(rtc.hash))[e]}catch(t){return _i.storage.data[e]||null}},setItem:function(e,t,s){try{if(s)return auth.local[e]=t,void localStorage.setItem(rtc.hash,JSON.stringify(auth.local));auth.session[e]=t,sessionStorage.setItem(rtc.hash,JSON.stringify(auth.session))}catch(s){_i.storage.data[e]=t}},removeItem:function(e,t){try{if(e===rtc.hash)return t?auth.local={}:auth.session={},void(t?localStorage.removeItem(rtc.hash):sessionStorage.removeItem(rtc.hash));if(t)return delete auth.local[e],localStorage.removeItem(e),void(_i.isEmpty(auth.local)||localStorage.setItem(rtc.hash,JSON.stringify(auth.local)));delete auth.session[e],sessionStorage.removeItem(e),_i.isEmpty(auth.session)||sessionStorage.setItem(rtc.hash,JSON.stringify(auth.session))}catch(t){delete _i.storage.data[e]}}},id:function(e){return _i.d.getElementById(e)},is:function(e){return!!_i.id(e)},parent:function(e){return"string"==typeof e?_i.id(e):e||_i.d},tag:function(e,t){return _i.parent(t).getElementsByTagName(e)},all:function(e){return _i.tag("*",e)},first:function(e,t){var s=_i.tag(e,t);return 0===s.length?0:s[0]},css:function(e,t){if(_i.d.getElementsByClassName)return _i.parent(t).getElementsByClassName(e);var s=_i.all(t),i=e.split(" "),a=[];for(var n in s)if(s.hasOwnProperty(n)){var o=0,r=s[n],l=r.className;if(l){var c=l.split(" ");for(var d in c)if(c.hasOwnProperty(d))for(var u in i)if(i.hasOwnProperty(u)&&i[u]==c[d]){o++;break}o===i.length&&a.push(r)}}return a},firstCss:function(e,t){var s=_i.css(e,t);return 0===s.length?0:s[0]},lastCss:function(e,t){var s=_i.css(e,t);return 0===s.length?0:s[s.length-1]},parentCss:function(e,t){for(;!_i.hasClass(t,e);)if(!(t=t.parentNode)||t===document)return null;return t},style:function(e){return _i.w.getComputedStyle?_i.w.getComputedStyle(e,""):e.currentStyle},selectors:function(e){var t,s,i,a={};for(t=0;t<_i.d.styleSheets.length;t++)if("rt-css"===_i.d.styleSheets[t].title){i=_i.d.styleSheets[t];break}if(!i||!e)return a;for(i=i.cssRules?i.cssRules:i.rules,t=0;t<i.length;++t)for(s=0;s<e.length;++s)if(i[t].selectorText&&-1!==i[t].selectorText.indexOf(e[s])){a[i[t].selectorText.replace("::",":")]=i[t];break}return a},inner:function(e){return _i.id(e).innerHTML},set:function(e,t){for(var s in t)if(t.hasOwnProperty(s))if("object"==typeof t[s])e[s]||(e[s]={}),_i.set(e[s],t[s]);else try{e[s]=t[s]}catch(e){}},create:function(e,t,s,i){var a=_i.d.createElement(e);return t&&_i.set(a,t),s&&(i?s.insertBefore(a,i):s.appendChild(a)),a},remove:function(e){"string"==typeof e&&(e=_i.id(e)),e&&e.parentNode.removeChild(e)},events:function(e){for(var t in e)if(e.hasOwnProperty(t)){var s=e[t];(s.obj?s.obj:_i.w).addEventListener(s.name,s.cb,!!s.capture)}},cancel:function(e){e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&(e.stopPropagation(),e.preventDefault())},cookies:function(e){var t={};for(var s in e)if(e.hasOwnProperty(s)){var i=e[s],a=encodeURIComponent(i).replace(/[\-.+*]/g,"\\$&"),n=new RegExp("(?:(?:^|.*;)\\s*"+a+"\\s*\\=\\s*([^;]*).*$)|^.*$");t[i]=decodeURIComponent(_i.d.cookie.replace(n,"$1"))||0}return t},getCookie:function(e){var t=`; ${_i.d.cookie}`.split(`; ${e}=`);if(2===t.length)return t.pop().split(";").shift()},setCookie:function(e,t,s,i){var a="";s&&(a="; Expires="+new Date(_i.now()+1e3*s).toUTCString());return i=i?"; Path="+i:"",_i.d.cookie=e+"="+t+a+i+"; SameSite=none; Secure;",_i.isCookie(e)},delCookie:function(e,t,s){return!!_i.isCookie(e)&&(t=t?" domain="+t+";":"",s=s?" path="+s+";":"",_i.d.cookie=e+"=;"+s+t+" Expires=Thu, 01-Jan-1970 00:00:01 GMT; SameSite=none; Secure;",!0)},isCookie:function(e){return!!_i.cookies([e])[e]},storageItems:function(e,t){var s={};for(var i in e)if(e.hasOwnProperty(i)){var a=e[i],n=encodeURIComponent(a).replace(/[\-.+*]/g,"\\$&"),o=new RegExp("(?:(?:^|.*;)\\s*"+n+"\\s*\\=\\s*([^;]*).*$)|^.*$"),r=_i.storage.getItem(a,!!t);s[a]=!!r&&(decodeURIComponent(r.replace(o,"$1"))||0)}return s},client:function(){return{width:_i.w.innerWidth,height:_i.w.innerHeight}},addUnit:function(e,t){return e+(t||"px")},outerDims:function(e){var t,s={marginBottom:0,marginTop:0,marginLeft:0,marginRight:0},i=_i.style(e);for(t in s)s.hasOwnProperty(t)&&(s[t]="auto"===i[t]?0:i[t]);var a=e.getBoundingClientRect();return{outerHeight:a.height+parseInt(s.marginBottom)+parseInt(s.marginTop),outerWidth:a.width+parseInt(s.marginLeft)+parseInt(s.marginRight)}},height:function(e){var t=_i.style(e);return e.getBoundingClientRect().height-parseInt(t.paddingTop)-parseInt(t.paddingBottom)},width:function(e){var t=_i.style(e);return e.getBoundingClientRect().width-parseInt(t.paddingLeft)-parseInt(t.paddingRight)},load:function(e,t,s,i,a){var n={async:!0,src:e,loaded:!1,onreadystatechange:function(){this.loaded||"loaded"===this.readyState&&(this.loaded=!0,"function"==typeof s&&s(i))},onload:function(){this.loaded||(this.loaded=!0,"function"==typeof s&&s(i))},onerror:function(){"function"==typeof a&&a(i)}};return"string"==typeof t&&(n.id=t),_i.create("script",n,_i.first("head"))},rand:function(e,t){return Math.floor(e+Math.random()*t)},num:function(e,t){return e=parseInt(e),isNaN(e)?void 0===t?e:t:e},html:function(e,t,s){var i,a,n,o="<"+e;if(t)for(i in t)t.hasOwnProperty(i)&&("string"==typeof(a=t[i])&&(a=a.replace('"',"&quote;")),o+=" "+i+'="'+a+'"');if(-1!==",img,input,".indexOf(","+e+","))o+="/>";else{if(o+=">",s)if("object"==typeof s)for(i=0;i<s.length;i++)o+="string"==typeof(n=s[i])?n:_i.html(n[0],n[1],n[2]);else o+=s;o+="</"+e+">"}return o},now:function(){return(new Date).getTime()},int2ip:function(e){if(!e)return"";var t,s=e%256;for(t=1;t<4;t++)s=(e=Math.floor(e/256))%256+"."+s;return s},getFileType:function(e){switch(e.split(".").pop()){case"gif":return"image/gif";case"jpg":case"jpeg":return"image/jpeg";case"pjpeg":return"image/pjpeg";case"png":return"image/png";case"tif":case"tiff":return"image/tiff"}return!1},getFileExtension:function(e){var t=e.split("/");switch((t=t[1].split(";"))[0]){case"x-matroska":case"webm":return"webm";case"ogg":return"ogv";default:return t[0]}},browserAudioSupport:function(e){return null!=(e=e.match(/\.(ogg|wav|mp3|m4a)$/))&&("m4a"===(e=e[1])&&(e="mp4"),!(_i.ua===_i.userAgents.IE&&"mp3"!==e||_i.ua===_i.userAgents.SAFARI&&"ogg"===e)&&e)},browserVideoSupport:function(e){return null!=(e=e.match(/\.(mp4|webm|ogv)$/))&&(e=e[1],!(_i.ua===_i.userAgents.IE&&"mp4"!==e||_i.ua===_i.userAgents.SAFARI&&"mp4"!==e)&&e)},getFileThumbnail:function(e){if(!(e=e.match(/\w\.(\w{1,4})(\?[^\\]*)?$/)))return!1;var t;switch(e=!!_i.getFileType(e[0])||e[1]){case"doc":case"docx":t="32-word.png";break;case"pdf":case"x-pdf":t="32-pdf.png";break;case"xls":case"xlsx":case"csv":t="32-excel.png";break;case"ppt":case"pptx":t="32-powerpoint.png";break;case"ogg":case"wav":case"mp3":case"m4a":t="32-audio.png";break;case"ogv":case"webm":case"mp4":t="32-video.png";break;case!0:t="32-image.png"}return!!t&&"chat/images/file_types/"+t},isEmpty:function(e){return 0===Object.keys(e).length},extend:function(e){if("object"!=typeof e&&"function"!=typeof e||!e)return e;var t,s,i,a;for(i=1,a=arguments.length;i<a;i++)for(s in t=arguments[i])t.hasOwnProperty(s)&&(e[s]=t[s]);return e},indexOf:function(e,t,s){var i,a;for(i=s||0,a=e.length;i<a;i++)if(e[i]===t)return i;return-1},hasClass:function(e,t){return!(!e||!t)&&(" "+e.className+" ").indexOf(" "+t+" ")>-1},addClass:function(e,t){t&&(_i.hasClass(e,t)||(e.className=(e.className+" "+t).trim()))},removeClass:function(e,t){if(_i.hasClass(e,t)){var s=e.className.split(" ");s.splice(_i.indexOf(s,t),1),e.className=s.join(" ").trim()}},toggleClass:function(e,t,s){var i=null;return _i.hasClass(e,t)?_i.removeClass(e,t):!0!==s&&(_i.addClass(e,t),i=!0),i},dashSeparated:function(e){return e.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()}))},getHostname:function(e){var t=document.createElement("a");return t.href=e,t.hostname},explode:function(e,t,s){var i=e.split(t);return s&&i.push(i.splice(s-1).join(t)),i},setBottom:function(e){e.scrollTop=e.scrollHeight},setTop:function(e){e.scrollTop=0},atBottom:function(e){return Math.ceil(e.scrollTop+e.offsetHeight)>=e.scrollHeight},atTheVeryTop:function(e){return 0===e.scrollY},atTop:function(e,t){return t=t||0,e.scrollHeight>e.offsetHeight-t&&e.scrollTop<=t},calculatePercentage:function(e,t){return 0===t||isNaN(t)?"0%":(e/t*100).toFixed(2)+"%"}},keywords={PARSE_FREQUENCY:2,RT_POOL_URL:"keywords/rt.json",AFFILIATES_POOL_URL:"keywords/affiliates.json",AFFILIATES_REDIRECT_URL:"https://cj.rumbletalk.com/piword/operation/click?p=",keywordCount:0,enabled:!1,pool:[],init:function(){keywords.RT_POOL_URL=cfg.cdnCors+keywords.RT_POOL_URL,keywords.AFFILIATES_POOL_URL=cfg.cdnCors+keywords.AFFILIATES_POOL_URL,keywords.add(cfg.keywords),cfg.accountType==_i.accountTypes.FREE?keywords.fetch():keywords.PARSE_FREQUENCY=1},fetch:function(){keywords.fetchSources(keywords.RT_POOL_URL,(function(){keywords.fetchSources(keywords.AFFILIATES_POOL_URL)}))},fetchSources:function(e,t){var s=new XMLHttpRequest;s.open("get",e,!0),s.onreadystatechange=function(){if(4==s.readyState){s.onreadystatechange=null;try{var e=JSON.parse(s.responseText);keywords.add(e)}catch(e){}"function"==typeof t&&t()}},s.send()},add:function(e){var t,s,i=e instanceof Array;for(t in e)e.hasOwnProperty(t)&&(t=i?e[t]:t,s=gui.safe(t.toLowerCase()).replace(/(\W)/g,"\\$1"),keywords.hasPhrase(s)||keywords.pool.push({regex:new RegExp("(\\s|^)"+s+"(\\W|$)","i"),link:i?keywords.AFFILIATES_REDIRECT_URL+t:e[t]}))},hasPhrase:function(e){var t;for(t=0;t<keywords.pool.length;t++)if(keywords.pool[t].phrase==e)return!0;return!1},keywordCountCheck:function(e){return e?(keywords.keywordCount=keywords.PARSE_FREQUENCY,!0):(keywords.keywordCount>0&&keywords.keywordCount--,0==keywords.keywordCount)},track:function(e,t){var s=cfg.accountType==_i.accountTypes.FREE?":free":"";rtc.track("Keywords"+s,e,t)}},mentions={lastSelection:{node:null,offsetStart:0,offsetEnd:0},handle:null,users:{},parse:function(e){var t,s,i,a,n,o,r=e.match(new RegExp("(@[^@]{1,"+rtc.maxUsernameLength+"}($|_|\\W))","g"));if(r)for(o=0;o<r.length;o++){r[o]=r[o].trim().substr(1),s=r[o].split(/\W|_/);do{if(i=s.join(" "),(t=rtc.userIndex("name",i,!0))>-1){a=rtc.users[t],n=new RegExp("([^>]|^)@"+i,"g"),e=e.replace(n,'$1<span class="mention" onclick="skin.showUserInfo('+a.id+');">@'+i+"</span>"),a.id==auth.id&&skin.playSound("notice");break}s.pop()}while(s.length>0)}return e},checkMention:function(){if(cfg.mentions){var e=document.getSelection();if(e.anchorNode&&(mentions.lastSelection.node=e.anchorNode,mentions.lastSelection.offsetEnd=e.anchorOffset,"#text"==mentions.lastSelection.node.nodeName)){var t=mentions.lastSelection.node.wholeText.substr(0,mentions.lastSelection.offsetEnd);(t=t.match(/(^|\s)@([^\s@]*)$/))?(t=t[2]||"",mentions.lastSelection.offsetStart=e.anchorOffset-t.length-1,mentions.open(t)):mentions.close()}}},usersThatStartWith:function(e){var t,s={};for(t=0;t<rtc.users.length;t++)rtc.users[t].name.toUpperCase().startsWith(e.toUpperCase())&&(s[rtc.users[t].id]={name:rtc.users[t].name,image:rtc.users[t].image,moderator:rtc.users[t].moderator});return s},open:function(e){var t,s,i=mentions.usersThatStartWith(e);if(_i.isEmpty(i))mentions.close();else{for(t in mentions.handle||(mentions.handle=gui.template("mention-tooltip-template",null,!0),skin.textCover.appendChild(mentions.handle),mentions.handle.addEventListener("mouseover",mentions.setSelected,!1)),s=_i.firstCss("mention-users",mentions.handle),mentions.users)mentions.users.hasOwnProperty(t)&&(i[t]||(_i.remove(mentions.users[t].handle),delete mentions.users[t]));for(t in i)i.hasOwnProperty(t)&&(mentions.users[t]||(i[t].handle=gui.template("mention-tooltip-item",{userId:t,avatar:i[t].image,username:gui.safe(i[t].name),selectFn:"skin.addMention("+t+");",isAdmin:i[t].moderator?"admin":void 0},!0),mentions.users[t]=i[t],s.appendChild(i[t].handle)));mentions.getSelectedUser()||_i.addClass(s.childNodes[0],"selected")}},close:function(){mentions.handle&&(mentions.handle.removeEventListener("mouseover",mentions.setSelected,!1),_i.remove(mentions.handle),mentions.handle=null),mentions.users={}},getSelectedUser:function(){return _i.firstCss("selected",mentions.handle)||null},setSelected:function(e){var t=_i.parentCss("mention-item",e.target);if(t){var s=_i.firstCss("selected",mentions.handle);if(t===s)return;_i.removeClass(s,"selected"),_i.addClass(t,"selected")}},handleKeys:function(e){if(!mentions.handle||-1===["ArrowUp","Up","ArrowDown","Down","Enter"].indexOf(e.key))return!1;if(e.preventDefault(),"Enter"===e.key){var t=mentions.getSelectedUser();return t&&skin.addMention(Number(t.getAttribute("data-user-id"))),!0}var s,i=_i.firstCss("mention-users",mentions.handle),a="ArrowUp"===e.key||"Up"===e.key;for(s=0;s<i.childNodes.length&&!_i.hasClass(i.childNodes[s],"selected");s++);return _i.removeClass(i.childNodes[s],"selected"),a?--s<0&&(s=i.childNodes.length-1):++s>i.childNodes.length-1&&(s=0),_i.addClass(i.childNodes[s],"selected"),i.childNodes[s].scrollIntoView(),!0}},monetize={postMessageEvents:{PAY_REGISTER_SUCCESS:"p.1",PAY_EXTEND_SUCCESS:"p.2",PAY_DONATION:"p.3",PAY_REQUEST:"p.4"},MIN_PAYMENT:2,MAX_PAYMENT:999,paymentWindow:{handle:null,name:"payment-window",payUrl:"q",extendUrl:"extend_session?id=",height:545,width:450},CURRENCIES:{USD:"$",EUR:"",GBP:"",ILS:""},DONATION_CLASSES:{2:"donation-basic",5:"donation-novice",20:"donation-expert",50:"donation-master",100:"donation-grand-master"},adjustCurrencyParameters:function(){var e=monetize.currencyMultiplier(cfg.monetize.currency);cfg.monetize.minimum*=e,cfg.monetize.processingFee.constant*=e,cfg.monetize.currencySymbol=monetize.formatCurrency(cfg.monetize.currency),monetize.MIN_PAYMENT*=e,monetize.MAX_PAYMENT*=e},isMonetizeMessage:function(e){return e&&"p."===e.substring(0,2)},handlePostMessage:function(e){if(monetize.isValidDomain(_i.getHostname(e.origin))){switch(e.data.type){case monetize.postMessageEvents.PAY_REGISTER_SUCCESS:monetize.handleRegisterPaymentSuccess();break;case monetize.postMessageEvents.PAY_EXTEND_SUCCESS:monetize.handleExtendPaymentSuccess(e.data.expiration);break;case monetize.postMessageEvents.PAY_DONATION:"donate-confirm-template"===dlg.reference&&dlg.close();break;case monetize.postMessageEvents.PAY_REQUEST:privateChat.removePaymentRequest()}monetize.paymentWindow.handle&&!monetize.paymentWindow.handle.closed&&monetize.paymentWindow.handle.close()}else e.source.postMessage("STOP",e.origin)},handleRegisterPaymentSuccess:function(){skin.loginHash?auth.login(rumbletalk,{hash:skin.loginHash}):skin.loginParamsDialog(rumbletalk)},handleExtendPaymentSuccess:function(e){auth.loggedIn?auth.updateExpiration(e):monetize.handleRegisterPaymentSuccess()},continueToPayPal:function(e){var t,s;!monetize.paymentWindow.handle||monetize.paymentWindow.handle.closed?monetize.paymentWindow.handle=window.open(e,monetize.paymentWindow.name,(window.outerWidth?(t=Math.round((window.outerWidth-monetize.paymentWindow.width)/2)+window.screenX,s=Math.round((window.outerHeight-monetize.paymentWindow.height)/2)+window.screenY):window.screen.width&&(t=Math.round((window.screen.width-monetize.paymentWindow.width)/2),s=Math.round((window.screen.height-monetize.paymentWindow.height)/2)),"width="+monetize.paymentWindow.width+",height="+monetize.paymentWindow.height+",left="+t+",top="+s)):monetize.paymentWindow.handle.focus()},isValidDomain:function(e){return e.endsWith(cfg.serverDomain)},formatCurrency:function(e){return monetize.CURRENCIES[e]||"[MISSING CURRENCY]"},currencyMultiplier:function(e){switch(e){case"ILS":return 4;default:return 1}},isValidMonetizeAmount:function(e,t){if(isNaN(e))return!1;var s=monetize.currencyMultiplier(t);return 2*s<=e&&e<=999*s},calculateFee:function(e){var t=e*cfg.monetize.processingFee.percent/100+cfg.monetize.processingFee.constant;return t<cfg.monetize.processingFee.minimum&&(t=cfg.monetize.processingFee.minimum),Number(t.toFixed(2))}},net={s:null,init:function(){try{net.s=new XMLHttpRequest}catch(e){return!1}return!0},send:function(e,t){if(t)setTimeout((function(){net.send(e)}),t);else{var s;if(1==net.s.readyState&&net.close(),net.s.open("POST","//"+_i.l.host+_i.l.pathname,!0),e.headers)for(s in e.headers)e.headers.hasOwnProperty(s)&&net.s.setRequestHeader(s,e.headers[s]);net.s.onreadystatechange=function(){e.cb(net.s,e)},net.s.send(e.data)}},close:function(){if(net.s)try{net.s.onreadystatechange=null,net.s.abort()}catch(e){}}},p2p={connection:null,configuration:{iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun3.l.google.com:19302"]},{urls:"turn:numb.viagenie.ca",credential:"a1234565",username:"nim@rumbletalk.com"}]},remoteId:0,remoteMode:"",mode:"",supportCameraSwap:!1,facingMode:"user",busy:!1,calling:!1,connected:!1,selfStream:null,remoteStream:null,hasAnswer:!1,waitingIceCandidates:[],responseMessages:{ERROR:0,BUSY:1,HANGUP:2,MISSED:3,BROWSER_INVALID:4},audioOnly:!1,sdpSent:!1,init:function(){try{if(p2p.supportCameraSwap=navigator.mediaDevices.getSupportedConstraints().facingMode,p2p.supportCameraSwap){var e=0;navigator.mediaDevices.enumerateDevices().then((function(t){"videoinput"===t.kind&&e++})),p2p.supportCameraSwap=e>1}}catch(e){p2p.supportCameraSwap=!1}p2p.supportCameraSwap||_i.remove(_i.firstCss("calling-box-swap-camera",skin.callingOptions))},applyAction:function(e,t,s){var i;if(_i.p2p){if(p2p.remoteId&&p2p.remoteId!=e&&p2p.connection)return i=new Error("different user trying to contact while in progress with a different user"),console.log(i.stack),void p2p.decline(e,p2p.responseMessages.BUSY);switch(t){case"call":if(p2p.busy)return i=new Error("The remote user has sent an additional call request"),void console.log(i.stack);var a;p2p.remoteId=e,p2p.remoteMode=s.mode,a=_i.mobile?"full":skin.usersListOpened&&!skin.isSmall?"side":"mini",skin.callingDialog(e,a);break;case"sdp":if(!p2p.connection)return i=new Error("Sending SDP while no connection is active"),console.log(i.stack),void(p2p.busy||p2p.calling||skin.closeCalling());p2p.remoteMode=s.mode,skin.drawCalling(),p2p.parseSDP(e,s.sdp);break;case"candidates":console.log("processing ice candidates"),p2p.hasAnswer?p2p.processIceCandidates(s):p2p.waitingIceCandidates=s,p2p.connected=!0,skin.drawCalling("full"),skin.callTextSet();break;case"decline":skin.noAnswer(e,s.reasonId),rtc.sendP2PAction(e,"declined-success",{});break;case"declined-success":if(!p2p.remoteId&&!p2p.remoteMode)return;skin.closeCalling();break;default:i=new Error("Invalid action supplied: "+t),console.log(i.stack)}}else p2p.decline(e,p2p.responseMessages.BROWSER_INVALID)},callRequest:function(e,t){if(p2p.busy){var s=new Error(cfg.strings.request_call_when_busy);return skin.showMessage(s.message),void console.log(s.stack)}var i=rtc.user(e);void 0!==i.p2p?!1!==i.p2p&&(rtc.track("P2P",rtc.hash,"call-"+t),skin.setSelectedUser(),p2p.busy=!0,p2p.calling=!0,p2p.remoteId=e,p2p.mode=t,skin.wait(cfg.strings.connecting),navigator.mediaDevices.getUserMedia(p2p.buildConstraints(t)).then(p2p.handleMedia).catch(p2p.handleMediaError)):p2p.userP2PSupport(i,t)},answer:function(e){if(p2p.busy){var t=new Error("Trying to answer when busy");return console.log(t.stack),!1}rtc.track("P2P",rtc.hash,"answer-"+e),p2p.busy=!0,p2p.mode=e,navigator.mediaDevices.getUserMedia(p2p.buildConstraints(e)).then(p2p.handleMedia).catch(p2p.handleMediaError)},handleMedia:function(e){dlg.close(),p2p.selfStream=e,skin.callVideo.muted=!0,setSrcObject(e,skin.callVideo),skin.localVideoHandle=skin.callVideo,cfg.p2p.video&&skin.callingToggleCamera(skin.callingOptions.querySelector(".calling-box-camera"),"video"==p2p.mode),skin.callingToggleMic(skin.callingOptions.querySelector(".calling-box-mic"),!0),"audio"===p2p.mode&&(p2p.audioOnly=!0),p2p.initPeerConnection(p2p.remoteId,e,!p2p.calling),p2p.calling?(skin.callingDialog(p2p.remoteId,"full"),p2p.sendCall(p2p.remoteId,p2p.mode)):skin.drawCalling("full")},handleMediaError:function(e){console.log(e),p2p.connected&&p2p.decline(p2p.remoteId,p2p.connected?p2p.responseMessages.HANGUP:p2p.calling?p2p.responseMessages.MISSED:p2p.responseMessages.BUSY),skin.closeCalling(),9===e.code?skin.showMessage(cfg.strings.p2p_not_secure):skin.showMessage("Oops. Something went wrong. Please try again later.")},initPeerConnection:function(e,t,s){if(!p2p.connection){var i;if(p2p.connection=new RTCPeerConnection(p2p.configuration),p2p.connection.onicecandidate=function(t){t.candidate&&(clearTimeout(i),p2p.sdpSent||(t.candidate?i=setTimeout((function(){p2p.sdpSent=!0,p2p.sendSDP(e,{sdp:p2p.connection.localDescription,mode:p2p.mode})}),1e3):(console.log("P2P finished fetching candidates"),p2p.sendSDP(e,{sdp:p2p.connection.localDescription,mode:p2p.mode}),console.log("total",JSON.stringify(p2p.connection.localDescription).length))))},"function"==typeof p2p.connection.addTrack){var a,n=!0;p2p.connection.ontrack=function(e){console.log("got stream"),e.streams&&e.streams[0]&&(p2p.remoteStream=null,p2p.remoteStream=e.streams[0],skin.drawCalling(),n?(skin.switchVideo(),n=!1):(clearTimeout(a),a=setTimeout((function(){var e;e=skin.localVideoHandle===skin.callVideo?skin.callVideoMini:skin.callVideo,setSrcObject(null,e),setSrcObject(p2p.remoteStream,e)}),1e3)),skin.callTextSet())}}else p2p.connection.onaddstream=function(e){console.log("on add stream: got stream"),p2p.remoteStream=e.stream,skin.drawCalling(),skin.switchVideo(),skin.callTextSet()};p2p.connection.oniceconnectionstatechange=function(){p2p.connection&&(console.log("change ice connection state: ",p2p.connection.iceConnectionState),"connected"==p2p.connection.iceConnectionState&&(p2p.connected=!0,skin.drawCalling(),rtc.track("P2P",rtc.hash,"connected-"+p2p.mode)))},s&&(p2p.connection.onnegotiationneeded=function(){console.log("negotiationneeded started"),p2p.connection.createOffer().then((function(e){return p2p.connection.setLocalDescription(e)})).then((function(){p2p.connected&&p2p.sendSDP(p2p.remoteId,{sdp:p2p.connection.localDescription,mode:p2p.mode})}))}),"function"==typeof p2p.connection.addTrack?(p2p.selfStream.getTracks().forEach((function(e){console.log("track",e),p2p.connection.addTrack(e,p2p.selfStream)})),p2p.connection.addTransceiver("video")):p2p.connection.addStream(t)}},processIceCandidates:function(e){e.forEach((function(e){p2p.connection.addIceCandidate(new RTCIceCandidate(e)).catch((function(e){console.log(e)}))}))},parseSDP:function(e,t){if("offer"==t.type)p2p.connection.setRemoteDescription(t).then((function(){return p2p.connection.createAnswer()})).then((function(e){return p2p.connection.setLocalDescription(e)})).then((function(){p2p.connected&&setTimeout((function(){p2p.sendSDP(e,{sdp:p2p.connection.localDescription,mode:p2p.mode})}),1e3)}));else if("answer"==t.type)console.log("received an answer"),p2p.connection.setRemoteDescription(t).catch((function(e){console.log(e)}));else{var s=new Error("Unsupported SDP type:",t.type);console.log(s.stack,t)}sfx.stopRing()},userP2PSupport:function(e,t){e.p2p=!0,p2p.callRequest(e.id,t)},sendSDP:function(e,t){rtc.sendP2PAction(e,"sdp",t)},sendCall:function(e,t){rtc.sendP2PAction(e,"call",{mode:t})},decline:function(e,t){rtc.sendP2PAction(e,"decline",{reasonId:t})},stop:function(){p2p.connection&&(p2p.connection.close(),p2p.connection=null),p2p.mode="",p2p.remoteId=0,p2p.remoteMode="",p2p.selfStream&&(webrtc.stopTracks(p2p.selfStream),p2p.selfStream=null),p2p.remoteStream=null,p2p.busy=!1,p2p.calling=!1,p2p.connected=!1,p2p.hasAnswer=!1,p2p.waitingIceCandidates=[],p2p.audioOnly=!1,p2p.sdpSent=!1},parseDeclineText:function(e,t){var s,i=rtc.user(e);if(!i)return!1;switch(t){case p2p.responseMessages.ERROR:console.log("ERROR"),s="p2p_call";break;case p2p.responseMessages.BUSY:console.log("BUSY"),s="p2p_missed_they";break;case p2p.responseMessages.HANGUP:console.log("HANGUP"),s="p2p_call";break;case p2p.responseMessages.MISSED:console.log("MISSED"),s="p2p_missed_you"}return cfg.strings[s].replace("{{caller}}",i.name)},messageIdToString:function(e,t){var s,i=rtc.user(e);if(!i)return!1;switch(t){case p2p.responseMessages.ERROR:console.log("ERROR"),s="p2p_error";break;case p2p.responseMessages.BUSY:console.log("BUSY"),s="p2p_busy";break;case p2p.responseMessages.HANGUP:console.log("HANGUP"),s="p2p_ended";break;case p2p.responseMessages.MISSED:console.log("MISSED"),s="p2p_ended";break;case p2p.responseMessages.BROWSER_INVALID:console.log("BROWSER_INVALID"),s="p2p_browser_invalid"}return cfg.strings[s].replace("{{caller}}",i.name)},swapCamera:function(){p2p.connection&&(p2p.facingMode="user"===p2p.facingMode?"environment":"user",navigator.mediaDevices.getUserMedia(p2p.buildConstraints("video")).then((function(e){if(p2p.connection){webrtc.stopTracks(p2p.selfStream),p2p.selfStream=e,setSrcObject(e,skin.localVideoHandle),"user"===p2p.facingMode?_i.removeClass(skin.localVideoHandle,"back-facing-camera"):_i.mobile&&_i.addClass(skin.localVideoHandle,"back-facing-camera"),skin.localVideoHandle.play();var t=e.getVideoTracks()[0];p2p.connection.getSenders().find((function(e){return e.track.kind===t.kind})).replaceTrack(t)}})).catch(p2p.handleMediaError))},audioToVideoCall:function(e){p2p.connection&&navigator.mediaDevices.getUserMedia(p2p.buildConstraints("video")).then((function(t){if(p2p.connection){var s=t.getVideoTracks()[0];p2p.selfStream.addTrack(s),skin.localVideoHandle.muted=!0,setSrcObject(null,skin.localVideoHandle),setSrcObject(p2p.selfStream,skin.localVideoHandle),p2p.connection.addTrack(s,p2p.selfStream),p2p.mode="video",p2p.audioOnly=!1,_i.removeClass(e,"disabled"),"user"===p2p.facingMode?_i.removeClass(skin.localVideoHandle,"back-facing-camera"):_i.mobile&&_i.addClass(skin.localVideoHandle,"back-facing-camera"),skin.localVideoHandle.play(),skin.drawCalling(),p2p.sdpSent=!1,p2p.calling&&p2p.connection.createOffer().then((function(e){return console.log("new offer",e),p2p.connection.setLocalDescription(e)})).then((function(){p2p.sendSDP(p2p.remoteId,{sdp:p2p.connection.localDescription,mode:p2p.mode})}))}})).catch(p2p.handleMediaError)},buildConstraints:function(e){return{audio:!0,video:"audio"!==e&&{facingMode:p2p.facingMode}}}},polls={model:null,records:null,totalCount:0,currentPage:1,hasActive:1,RECORDS_LIMIT:10,PAGE_LIMIT:7,STATUS:{EDIT:"Edit",ACTIVE:"Active",PUBLISHED:"Published",DELETED:"Deleted"},ACTIONS:{SEND:"send",RESET:"reset",PUBLISH:"publish",DELETE:"delete"},init:function(){polls.model={id:0,question:null,answer1:null,answer2:null,answer3:null,answer4:null,answer1count:0,answer2count:0,answer3count:0,answer4count:0,createDate:null,lastSentDate:null,publishedDate:null,dateDeleted:null}},resetForm:function(){polls.init(),_i.id("question").value="",_i.id("answer1").value="",_i.id("answer2").value="",_i.id("answer3").value="",_i.id("answer4").value=""},validate:function(){var e=[];return null!==polls.model.answer2&&0!==polls.model.answer2.trim().length||e.push("Answer 2 is required"),null!==polls.model.answer1&&0!==polls.model.answer1.trim().length||e.push("Answer 1 is required"),null!==polls.model.question&&0!==polls.model.question.trim().length||e.push("Question is required"),e},get:function(e){polls.totalCount=e.count,polls.records=e.polls,polls.hasActive=e.hasActivePolls,polls.display()},range:function(e,t){return Array.from(Array(t-e+1),(function(t,s){return s+e}))},getPageList:function(){var e=Math.ceil(polls.totalCount/polls.RECORDS_LIMIT),t=polls.PAGE_LIMIT<9?1:2,s=polls.PAGE_LIMIT-2*t-3>>1,i=polls.PAGE_LIMIT-2*t-2>>1;return e<=polls.PAGE_LIMIT?polls.range(1,e):polls.currentPage<=polls.PAGE_LIMIT-t-1-i?polls.range(1,polls.PAGE_LIMIT-t-1).concat(0,polls.range(e-t+1,e)):polls.currentPage>=e-t-1-i?polls.range(1,t).concat(0,polls.range(e-t-1-i-s,e)):polls.range(1,t).concat(0,polls.range(polls.currentPage-s,polls.currentPage+i),0,polls.range(e-t+1,e))},storeVote:function(e,t){var s=_i.storage.getItem("pollVotes",!0);s?e in s?s[e].push(t):s[e]=[t]:(s={})[e]=[t],_i.storage.setItem("pollVotes",s,!0)},hasDuplicateVote:function(e,t){var s=_i.storage.getItem("pollVotes",!0);return!!s&&(e in s&&s[e].indexOf(t)>-1)},deletePollInCache:function(e){var t=_i.storage.getItem("pollVotes",!0);t&&e in t&&(delete t[e],_i.storage.setItem("pollVotes",t,!0))},display:function(){var e="";polls.totalCount>0?polls.records.forEach((function(t){var s="";switch(t.status){case polls.STATUS.EDIT:s=gui.date(t.createDate,cfg.strings.date);break;case polls.STATUS.ACTIVE:s=gui.date(t.lastSentDate,cfg.strings.date);break;case polls.STATUS.PUBLISHED:s=gui.date(t.publishedDate,cfg.strings.date);break;case polls.STATUS.DELETED:s=gui.date(t.dateDeleted,cfg.strings.date)}var i={questionText:t.question,deletedClass:t.status===polls.STATUS.DELETED?"is-deleted":"",createDateText:gui.date(t.createDate,cfg.strings.date),className:t.status.toLowerCase(),viewFn:t.status===polls.STATUS.EDIT?"skin.editPollDialog('"+JSON.stringify(t)+"')":"skin.viewPollDialog('"+JSON.stringify(t)+"', false, false)",statusText:t.status,tooltipText:s,isNotDeleted:t.status!==polls.STATUS.DELETED,deleteText:cfg.strings.delete,deletePollFn:"skin.pollsDelete("+t.id+")"};e+=gui.template("polls-row-template",i)})):e=gui.template("polls-no-row-template",{text:cfg.strings.polls_no_records}),skin.showDialog("polls-dialog-template",{header:cfg.strings.polls_list,polls:e,hasPage:polls.totalCount>polls.RECORDS_LIMIT,createNewPollFn:"skin.createPollDialog()",createNewPollText:cfg.strings.polls_create_new,loaderText:cfg.strings.loading}),polls.buildPagination(),rtc.track("Polls","Opened",rtc.hash)},buildPagination:function(){var e=Math.ceil(polls.totalCount/polls.RECORDS_LIMIT);if(!(0===polls.totalCount||polls.totalCount<=polls.RECORDS_LIMIT||polls.currentPage<1||polls.currentPage>polls.totalPages)){[].slice.call(_i.css("polls-pagination-buttons")).slice(1,-1).forEach((function(e){e.parentNode.removeChild(e)}));var t=_i.lastCss("polls-pagination"),s=_i.id("polls-pagination-next");polls.getPageList().forEach((function(e){var i=_i.create("button",{},t,s);i.textContent=e||"...",i.disabled=!e||e===polls.currentPage,_i.addClass(i,"polls-pagination-buttons"),_i.addClass(i,e&&e!==polls.currentPage?"":" active"),e&&i.addEventListener("click",(function(){skin.pollsPaginate(e)}),!1)})),_i.id("polls-pagination-prev").disabled=1===polls.currentPage,_i.id("polls-pagination-next").disabled=polls.currentPage===e}},paginateLoaded:function(e){polls.records=e.data.polls,polls.totalCount=e.data.count,polls.buildPagination();var t="";polls.records.forEach((function(e){var s="";switch(e.status){case polls.STATUS.EDIT:s=gui.date(e.createDate,cfg.strings.date);break;case polls.STATUS.ACTIVE:s=gui.date(e.lastSentDate,cfg.strings.date);break;case polls.STATUS.PUBLISHED:s=gui.date(e.publishedDate,cfg.strings.date);break;case polls.STATUS.DELETED:s=gui.date(e.dateDeleted,cfg.strings.date)}var i={questionText:e.question,deletedClass:e.status===polls.STATUS.DELETED?"is-deleted":"",createDateText:gui.date(e.createDate,cfg.strings.date),className:e.status.toLowerCase(),viewFn:e.status===polls.STATUS.EDIT?"skin.editPollDialog('"+JSON.stringify(e)+"')":"skin.viewPollDialog('"+JSON.stringify(e)+"', false, false)",statusText:e.status,tooltipText:s,deletePollFn:"skin.pollsDelete("+e.id+")"};t+=gui.template("polls-row-template",i)})),_i.id("polls-table").innerHTML=t;var s=_i.id("polls-dialog-content");_i.removeClass(s,"hidden"),_i.addClass(s,"block");var i=_i.id("polls-dialog-loader");_i.removeClass(i,"flex"),_i.addClass(i,"hidden")}},privateChat={domHandle:null,paymentRequestHandle:null,userId:0,logs:{},messageTypes:{SYSTEM:-1,OWN:0,REMOTE:1,PAYMENT_REQUEST_SENT:2,PAYMENT_REQUEST_RECEIVED:3,PAYMENT_REQUEST_PAID:4},scrollHandle:0,pause:!1,position:0,lastPrivateMessageIds:[],ownMessages:{},PRIVATE_CACHE_SIZE:40,coordinates:{x:10,y:0},dimension:{width:0,height:0},newLineCount:0,TEXT_FIELD_BASE_HEIGHT:40,TEXT_FIELD_HEIGHT_INCREMENTS:16,resizers:{minimumWidth:450,minimumHeight:300,originalWidth:0,originalHeight:0,originalX:0,originalY:0,originalMouseX:0,originalMouseY:0},isFullScreen:!1,messageTimeout:null,messageInterval:null,init:function(){if(privateChat.domHandle=_i.id("user-info"),privateChat.logs=_i.storage.getItem("rumbletalk-private-message-logs")||{},!_i.mobile){var e,t={screenX:null,screenY:null,pageX:null,pageY:null};privateChat.domHandle.addEventListener("mousedown",(function(t){_i.hasClass(t.target,"resizer")||privateChat.isFullScreen||(e="user-info"===t.target.id)}),!1),privateChat.domHandle.addEventListener("dragstart",(function(s){e?(s.dataTransfer.setData("text","1"),t.screenX=s.screenX,t.screenY=s.screenY,t.pageX=s.pageX,t.pageY=s.pageY):s.preventDefault()}),!1),document.addEventListener("dragover",(function(e){e.preventDefault()}),!1),document.addEventListener("drop",(function(s){var i,a;(s.preventDefault(),e)&&(s.pageX&&_i.ua!==_i.userAgents.SAFARI?(i=t.pageX-s.pageX,a=t.pageY-s.pageY):(i=t.screenX-s.screenX,a=t.screenY-s.screenY),privateChat.coordinates.x=parseInt(privateChat.domHandle.style.left)-i,privateChat.coordinates.y=parseInt(privateChat.domHandle.style.top)-a,privateChat.domHandle.style.left=_i.addUnit(privateChat.coordinates.x),privateChat.domHandle.style.top=_i.addUnit(privateChat.coordinates.y),e=null)}),!1)}},checkDuplicates:function(e,t,s){if(s){if(-1!==privateChat.lastPrivateMessageIds.indexOf(s))return!1;privateChat.lastPrivateMessageIds.push(s),privateChat.lastPrivateMessageIds.length>=privateChat.PRIVATE_CACHE_SIZE&&privateChat.lastPrivateMessageIds.shift(),s==privateChat.position+1&&privateChat.position++}if(t){if(!privateChat.logs[e])return!0;if(privateChat.logs[e].log.some((function(e){return e.id==t})))return!1}return!0},close:function(e){skin.smiliesBoxPrivate&&skin.smiliesBoxPrivate.parentNode&&skin.smiliesBoxPrivate.parentNode.removeChild(skin.smiliesBoxPrivate),clearInterval(privateChat.scrollHandle),_i.removeClass(privateChat.domHandle,"active"),_i.firstCss("content",privateChat.domHandle).innerHTML="",privateChat.userId=0,e||skin.focus(),skin.setSelectedUser(),privateChat.adjustTextField(0)},buildDom:function(e,t){var s,i=_i.extend({loginTypeName:e.loginType.name},e),a=privateChat.shouldDisplayChatLog(e.id);if(t=t||{buttons:[],texts:[]},i.name=gui.safe(i.name),i.login_type=cfg.strings.login_type,i.back=cfg.strings.back,i.image||(i.image=e.loginType.pic(e)),i.imagePreview="skin.displayUserImage("+e.id+")",_i.mobile&&(i.mobileFn="skin.closeUserDetails();"),skin.close(),e.id!=auth.id&&auth.loggedIn){auth.moderator&&(t.texts.unshift({label:"IP",text:_i.int2ip(e.ip),className:"ip-text"}),rtc.usersOffline[e.id]||(t.buttons.unshift({fn:cfg.accountType===_i.accountTypes.FREE?"skin.upgradeDialog();":"skin.disconnectUser("+e.id+", rtc.commands.KICK);",text:cfg.strings.disconnect,className:"private-chat-block kick-user"}),cfg.monetize.paymentRequest&&(i.amountText=cfg.strings.amount,i.cancelText=cfg.strings.cancel,i.requestText=cfg.strings.request_payment,i.totalAmountText=cfg.strings.request_payment_fee,i.paymentHeader=gui.safe(cfg.strings.request_payment_header.replace("{{name}}",e.name)),i.currencySymbol=cfg.monetize.currencySymbol,i.currencyCode=cfg.monetize.currency),i.displayRequestPayment=cfg.monetize.paymentRequest),e.banned?t.texts.unshift({label:cfg.strings.ban_status,text:cfg.strings.banned,className:"ban-status"}):t.buttons.unshift({fn:cfg.accountType===_i.accountTypes.FREE?"skin.upgradeDialog();":"skin.disconnectUser("+e.id+", rtc.commands.BLOCK);",text:cfg.strings.ban_ip,className:"private-chat-block ban-user"})),e.moderator||t.buttons.unshift({fn:"skin.blockUser("+e.id+", this);",text:cfg.strings[rtc.usersBlocked[e.id]?"unignore":"ignore"],title:cfg.strings[rtc.usersBlocked[e.id]?"unignore_description":"ignore_description"],className:"private-chat-block block-user"});var n=_i.id("user"+e.id),o=n&&n.classList.contains("away");if(cfg.privateChat&&a){var r=privateChat.buttonsLocation(rtc.usersOffline[e.id]);r.placeholderText=cfg.strings.private_chat_placeholder,r.textSend=cfg.strings.send,r.textAdd=cfg.strings.add,r.textEmoji=cfg.strings.emoji,o&&(r.inputDisabled=!0,r.away=!0),i.messagesLog=gui.template("private-chat-template",r),(1===cfg.menuSettings.exportTranscript||2===cfg.menuSettings.exportTranscript&&auth.moderator)&&t.buttons.unshift({fn:"skin.exportArchive("+e.id+")",text:cfg.strings.export_transcript,title:cfg.strings.export_transcript_title,className:"private-export"})}_i.p2p&&!rtc.usersOffline[e.id]&&(uploader.validities.video||uploader.validities.audio)&&_i.extend(i,{disabled:cfg.accountType===_i.accountTypes.FREE?!auth.moderator||void 0:!!o||void 0,displayVideo:uploader.validities.video&&a,textCallVideo:cfg.strings.call_video,videoCall:cfg.accountType===_i.accountTypes.FREE?auth.moderator?"skin.upgradeDialog();":void 0:"skin.videoCallRequest("+e.id+");",displayAudio:uploader.validities.audio&&a,textCallAudio:cfg.strings.call_audio,audioCall:cfg.accountType===_i.accountTypes.FREE?auth.moderator?"skin.upgradeDialog();":void 0:"skin.audioCallRequest("+e.id+");"})}if(i.textSettings=cfg.strings.settings,i.textRequestPayment=cfg.strings.request_payment,i.userSettingsItems="",cfg.chatType!=_i.chatTypes.ONE_ON_ONE||auth.moderator||t.buttons.unshift({fn:"skin.logout();",text:cfg.strings.logout,className:"one-on-one-logout"}),auth.id==e.id&&e.loginType==rumbletalk){var l=cfg.profileUrl+"access";t.buttons.unshift({fn:"window.open('"+l+"');",text:cfg.strings.profile,className:"profile-page-link open-in-new"})}for(s=0;s<t.buttons.length;s++)i.userSettingsItems+=gui.template("button-template",t.buttons[s]);for(s=0;s<t.texts.length;s++)i.userSettingsItems+=gui.template("user-setting-info-template",t.texts[s]);if(rtc.usersOffline[e.id]?(_i.addClass(privateChat.domHandle,"user-offline"),i.messagesLog||(i.messagesLog=cfg.strings.user_offline)):_i.removeClass(privateChat.domHandle,"user-offline"),i.payMin=monetize.MIN_PAYMENT+monetize.calculateFee(monetize.MIN_PAYMENT),i.payMax=monetize.MAX_PAYMENT,_i.firstCss("content",privateChat.domHandle).innerHTML=gui.template("user-info-template",i),auth.loggedIn&&cfg.privateChat){var c=_i.lastCss("private-chat-text",privateChat.domHandle);if(privateChat.logs[e.id]&&privateChat.logs[e.id].fetched||e.id==auth.id)!a||rtc.usersOffline[e.id]||o||c.setAttribute("contenteditable",!0);else if(privateChat.logs[e.id]=privateChat.logs[e.id]||{fetched:!1,log:[]},cfg.archive){var d=_i.lastCss("private-chat-log",privateChat.domHandle);d.innerHTML=gui.template("loader-template",{text:cfg.strings.loading});var u=_i.firstCss("loading-bar",d);rtc.fetchPrivateMessages(e.id,(function(t){t.uid==e.id?(privateChat.logs[e.id].fetched=!0,t.data.forEach((function(t){privateChat.checkDuplicates(e.id,t.id)&&privateChat.addMessageLog(t,e.id,!0)})),u&&document.body.contains(u)&&(u.parentNode.removeChild(u),privateChat.loadMessages(e.id),!a||rtc.usersOffline[e.id]||o||c.setAttribute("contenteditable",!0))):u&&document.body.contains(u)&&(u.parentNode.removeChild(u),privateChat.loadMessages(e.id),!a||rtc.usersOffline[e.id]||o||c.setAttribute("contenteditable",!0))}))}else privateChat.logs[e.id].fetched=!0,c.setAttribute("contenteditable",!0);a&&!rtc.usersOffline[e.id]&&(skin.smiliesBoxPrivate&&_i.lastCss("private-chat-text-cover",privateChat.domHandle).appendChild(skin.smiliesBoxPrivate),c.focus(),c.onfocus=function(){privateChat.toggleSmilies(!0)})}e.id!==auth.id&&privateChat.logs[e.id]&&privateChat.logs[e.id].fetched&&privateChat.loadMessages(e.id),privateChat.adjustTextField(0),privateChat.draw(!0),e.id!=auth.id&&auth.loggedIn&&skin.initializeSendLimit(!0)},draw:function(e){var t,s,i=_i.outerDims(skin.chatFrame),a=_i.outerDims(_i.b),n=cfg.dir?"right":"left",o={},r=_i.lastCss("private-chat-log",privateChat.domHandle),l=_i.lastCss("private-chat-text-cover",privateChat.domHandle),c=_i.lastCss("user-settings",privateChat.domHandle),d=_i.lastCss("user-settings-items",privateChat.domHandle),u=_i.lastCss("user-messaging",privateChat.domHandle),g={userSelect:"text",cursor:"auto"},p=skin.chatFrame.getBoundingClientRect();_i.outerDims(skin.list);(e&&_i.addClass(privateChat.domHandle,"active"),_i.mobile||(skin.isSmall&&privateChat.domHandle.parentNode!==_i.b||!skin.isSmall&&privateChat.domHandle.parentNode!==skin.chatFrame)&&(skin.isSmall?_i.b.appendChild(privateChat.domHandle):skin.chatFrame.appendChild(privateChat.domHandle)),skin.isSmall||cfg.chatType==_i.chatTypes.ONE_ON_ONE)?(privateChat.domHandle.removeAttribute("style"),privateChat.domHandle.removeAttribute("draggable")):(privateChat.domHandle.setAttribute("draggable","true"),_i.mobile||cfg.chatType===_i.chatTypes.ONE_ON_ONE||privateChat.configureResizable(),skin.isPrivateChat()?(t=skin.usersListOpened?i.outerWidth:i.outerWidth-50,s=skin.usersListOpened?0:50):(t=privateChat.dimension.width>0?privateChat.dimension.width:i.outerWidth<600?i.outerWidth:600,s=i.outerWidth<610?0:privateChat.coordinates.x,skin.usersListOpened||(s+=privateChat.coordinates.x?0:50,t-=50)),o.width=_i.addUnit(t),o[n]=_i.addUnit(s),t<420?_i.addClass(privateChat.domHandle,"compact"):_i.removeClass(privateChat.domHandle,"compact"),a.outerHeight<230?(o.height=a.outerHeight,o.top=0):skin.isPrivateChat()?(o.height=i.outerHeight,o.top=p.top):(o.height=privateChat.dimension.height>0?privateChat.dimension.height:a.outerHeight<400?a.outerHeight:400,o.top=privateChat.coordinates.y||(a.outerHeight-o.height)/2),o.height=_i.addUnit(o.height),o.top=_i.addUnit(o.top),privateChat.isFullScreen||_i.set(privateChat.domHandle,{style:o}));if(r&&l&&(privateChat.adjustTextField(),e&&(_i.setBottom(r),_i.events([{obj:r,name:"scroll",cb:privateChat.scrollBar}]),privateChat.scrollHandle=setInterval(privateChat.scroll,100))),d){var m=_i.outerDims(_i.lastCss("login-type",privateChat.domHandle)),f=_i.outerDims(_i.lastCss("user-settings-back-button",privateChat.domHandle));d.style.height=_i.addUnit(_i.height(c)-m.outerHeight-f.outerHeight)}_i.set(c,{style:g}),_i.set(u,{style:g})},open:function(e){var t=skin.findUserDiv(e),s=rtc.user(e)||rtc.usersOffline[e];privateChat.toggleSmilies(!0),skin.toggleDonate(!0),privateChat.userId!==s.id?(privateChat.setScroll(!1),skin.wait(cfg.strings.downloading_user_info),privateChat.userId=s.id,t||!auth.moderator?(skin.setSelectedUser(t),s.loginType.getUserInfo(s,privateChat.buildDom)):rtc.getOfflineUserInfo(s,privateChat.buildDom),rtc.track("User Info","Opened",rtc.hash)):privateChat.close()},sendMessage:function(e){if(!privateChat.messageTimeout){var t=_i.lastCss("private-chat-text",privateChat.domHandle);if(rtc.usersBlocked[privateChat.userId]&&privateChat.alertPrivateSend(),(e=(e||t.innerText).trim()).length>rtc.MAX_MESSAGE_LENGTH)skin.showMessage(cfg.strings.message_too_long.replace("{{maxlength}}",rtc.MAX_MESSAGE_LENGTH));else if(t.innerHTML="",t.focus(),e){var s=privateChat.addMessageLog({type:privateChat.messageTypes.OWN,text:e,time:_i.now()},privateChat.userId);s.tempId=_i.now(),privateChat.ownMessages[s.tempId]={handle:privateChat.appendMessageDom(s,auth.id),data:s},skin.updateUserPosition(privateChat.userId),rtc.sendPrivateMessage(privateChat.userId,s.tempId,e),rtc.track("Private Chat","Message Sent",rtc.hash),privateChat.adjustTextField(0),privateChat.scroll(),cfg.sendLimitPrivate&&cfg.sendLimit>0&&!auth.moderator&&skin.handleSendMessageLimit(!0)}}},updateOwn:function(e){if(privateChat.ownMessages[e.tempId]){var t=privateChat.ownMessages[e.tempId];delete privateChat.ownMessages[e.tempId],t.data.id=e.id,t.data.time=e.timestamp,t.data.position=e.position,e.position==privateChat.position+1&&privateChat.position++,privateChat.updateSessionStorage(),t.handle.id="pm_"+e.id;var s=_i.firstCss("delete-private-message",t.handle);s&&s.setAttribute("onclick","privateChat.deleteMessage("+e.id+");")}},alertPrivateSend:function(){var e,t=_i.lastCss("private-chat-text",privateChat.domHandle),s=0;e=setInterval((function(){s++,_i.toggleClass(t,"block-warning"),s>9&&(clearInterval(e),_i.removeClass(t,"block-warning"))}),100)},scroll:function(){if(privateChat.domHandle){var e=_i.lastCss("private-chat-log",privateChat.domHandle);!e||privateChat.pause||_i.atBottom(e)||_i.setBottom(e)}},scrollBar:function(e){privateChat.setScroll(!_i.atBottom(e.target))},setScroll:function(e){privateChat.pause=e},buttonsLocation:function(e){var t=_i.mobile?40:30,s=cfg.dir?"left":"right",i=uploader.validities.upload?_i.mobile?2*t:t+5:_i.mobile?t:5,a=_i.mobile?t:5,n={displayUpload:uploader.validities.upload?s+": "+a+"px;":"display: none;",displaySmiley:cfg.parsers.smilies?s+": "+i+"px;":"display: none;"};if(!e){var o=(_i.mobile?t:0)+(!!uploader.validities.upload+!!cfg.parsers.smilies)*t;o>0&&(n.inputStyle=cfg.dir?"padding-left: ":"padding-right: ",n.inputStyle+=o+"px;")}return n.displaySend=_i.mobile,n},shouldDisplayChatLog:function(e){if(e==auth.id)return!1;if(0===cfg.privateChatAccess)return!1;if(1===cfg.privateChatAccess)return!0;if(privateChat.logs[e]&&privateChat.logs[e].log.length>0)return!0;if(2===cfg.privateChatAccess)return auth.moderator;var t=rtc.user(e)||rtc.usersOffline[e];return auth.moderator||t&&t.moderator},addMessageLog:function(e,t,s){return privateChat.logs[t]||(privateChat.logs[t]={fetched:!1,log:[]}),e.position=Number(e.position||0),e.id=Number(e.id||0),e.type=Number(e.type),s?privateChat.logs[t].log.unshift(e):privateChat.logs[t].log.push(e),privateChat.updateSessionStorage(),e},updateSessionStorage:function(){_i.storage.setItem("rumbletalk-private-message-logs",JSON.stringify(privateChat.logs))},clearMessages:function(){privateChat.logs={},privateChat.lastPrivateMessageIds=[];var e=_i.lastCss("private-chat-log",privateChat.domHandle);e&&(e.innerHTML=""),_i.storage.removeItem("rumbletalk-private-message-logs")},loadMessages:function(e){privateChat.logs[e].log.forEach((function(t){privateChat.appendMessageDom(t,e)}))},findMessage:function(e,t){var s;for(s=0;s<privateChat.logs[e].log.length;s++)if(privateChat.logs[e].log[s].id==t)return privateChat.logs[e].log[s]},appendMessageDom:function(e,t){var s,i=_i.lastCss("private-chat-log",privateChat.domHandle);switch(e.type){case privateChat.messageTypes.PAYMENT_REQUEST_RECEIVED:e.paid||privateChat.displayPaymentRequest(e.amount,e.currency,e.link);case privateChat.messageTypes.PAYMENT_REQUEST_PAID:e.type==privateChat.messageTypes.PAYMENT_REQUEST_PAID&&privateChat.removePaymentRequest();case privateChat.messageTypes.PAYMENT_REQUEST_SENT:case privateChat.messageTypes.SYSTEM:s=_i.create("DIV",{innerHTML:gui.template("p2p-message-template",{text:gui.parse(e.text),date:gui.date(e.time,"H:m"),fullDate:gui.date(e.time,cfg.strings.date)})},i);break;case privateChat.messageTypes.OWN:case privateChat.messageTypes.REMOTE:var a,n=rtc.user(e.type===privateChat.messageTypes.REMOTE?t:auth.id);n||(n=rtc.usersOffline[t]),a={text:gui.parse(e.text),image:n.loginType.pic(n),name:n.name,date:gui.date(e.time,"H:m"),fullDate:gui.date(e.time,cfg.strings.date),deleteText:cfg.strings.delete,deleteFn:e.id?"privateChat.deleteMessage("+e.id+")":"privateChat.deleteMessage("+e.tempId+", true)",displayMenu:e.type===privateChat.messageTypes.OWN},s=_i.create("div",{className:e.type===privateChat.messageTypes.REMOTE?"normal":"flip",innerHTML:gui.template("private-message-template",a)},i),e.id&&(s.id="pm_"+e.id)}return _i.setBottom(i),s},inputKeyUp:function(e){if(auth.loggedIn){var t=e.target.innerText.substr(0,e.target.innerText.length-1).match(/\n/g);if((t=(t||[]).length)!==privateChat.newLineCount&&privateChat.adjustTextField(t),e.target.innerText.length>0){var s=_i.lastCss("private-placeholder",privateChat.domHandle);"none"!==s.style.display&&(s.style.display="none")}}},inputKeyDown:function(e){auth.loggedIn&&("Enter"!==e.key||e.shiftKey||_i.mobile||(e.preventDefault(),e.target.innerText.trim().length>0&&(privateChat.sendMessage(),e.target.focus())))},addText:function(e){if(auth.loggedIn){var t=_i.lastCss("private-chat-text",privateChat.domHandle);t.childNodes.length>=2&&"BR"===t.childNodes[t.childNodes.length-1].nodeName&&"BR"===t.childNodes[t.childNodes.length-2].nodeName&&t.removeChild(t.lastChild),t.innerText+=" "+e+" ",t.focus()}},toggleSmilies:function(e){skin.smiliesBoxPrivate&&_i.toggleClass(skin.smiliesBoxPrivate,"active",e)},switchView:function(e){if(privateChat.domHandle){var t,s=_i.css("private-chat-view",privateChat.domHandle);for(t=0;t<s.length;t++)s[t].style.display="none";_i.firstCss(e,privateChat.domHandle).style.display="block",privateChat.togglePrivateMenu(!0),privateChat.draw(!0)}},sendPaymentRequest:function(e){var t=rtc.user(privateChat.userId),s=parseInt(e.value),i=100*(s-cfg.monetize.processingFee.constant)/(100+cfg.monetize.processingFee.percent);i=Number(i.toFixed(2)),s-i<cfg.monetize.processingFee.minimum&&(i=s-cfg.monetize.processingFee.minimum),monetize.isValidMonetizeAmount(i,cfg.monetize.currency)?(e.value="",skin.showDialog("loader-template",{text:cfg.strings.request_payment_header.replace("{{name}}",t.name)}),rtc.sendPaymentRequest(t.id,i,cfg.monetize.currency,(function(e){if(skin.close(),1==e.data.result){var i=privateChat.addMessageLog({type:privateChat.messageTypes.PAYMENT_REQUEST_SENT,text:cfg.strings.request_payment_initiate.replace("{{name}}",t.name).replace("{{amount}}",cfg.monetize.currencySymbol+s),time:_i.now()},t.id);privateChat.appendMessageDom(i,auth.id),skin.switchPrivateView("user-messaging")}}))):skin.signalWarning(e.parentNode)},displayPaymentRequest:function(e,t,s){var i=_i.firstCss("message-log",privateChat.domHandle),a=rtc.user(privateChat.userId)||rtc.usersOffline[privateChat.userId],n=cfg.strings.private_payment_notice;a&&(n=n.replace("{{name}}",a.name).replace("{{amount}}",monetize.formatCurrency(t)+e),privateChat.removePaymentRequest(),privateChat.paymentRequestHandle=gui.template("request-payment-notice-template",{text:n,payText:cfg.strings.pay,payFn:"skin.continueToPayPal('"+s+"');",dismissText:cfg.strings.dismiss,dismissFn:"skin.dismissPaymentRequest()",termsText:cfg.strings.request_payment_terms,termsLink:cfg.defaultTermsMonetizeLink},!0),i.appendChild(privateChat.paymentRequestHandle))},removePaymentRequest:function(){privateChat.paymentRequestHandle&&_i.remove(privateChat.paymentRequestHandle),privateChat.paymentRequestHandle=null},togglePrivateMenu:function(e){_i.toggleClass(_i.firstCss("private-menu-items",privateChat.domHandle),"active",e)},deleteMessage:function(e,t,s){var i=!s;if(s=s||privateChat.userId,privateChat.logs[s]){var a,n,o,r=privateChat.logs[s].log;if(t){if(!privateChat.ownMessages[e])return;_i.remove(privateChat.ownMessages[e].handle),a=r.indexOf(privateChat.ownMessages[e].data),r.splice(a,1),delete privateChat.ownMessages[e]}else{for(e instanceof Array||(e=[e]),a=0;a<e.length;a++)for(n=0;n<r.length;n++)if(e[a]==r[n].id){(o=_i.id("pm_"+r[n].id))&&_i.remove(o);var l=privateChat.lastPrivateMessageIds.indexOf(r[n].position);-1!=l&&privateChat.lastPrivateMessageIds.splice(l,1),r.splice(n,1);break}i&&rtc.deletePrivateMessages(s,e)}privateChat.updateSessionStorage()}},configureResizable:function(){var e=privateChat.domHandle;function t(t,s){(t=_i.id(t)).addEventListener("mousedown",(function(t){t.preventDefault(),privateChat.resizers.originalWidth=parseFloat(getComputedStyle(e,null).getPropertyValue("width").replace("px","")),privateChat.resizers.originalHeight=parseFloat(getComputedStyle(e,null).getPropertyValue("height").replace("px","")),privateChat.resizers.originalX=parseInt(privateChat.domHandle.style.left),privateChat.resizers.originalY=e.getBoundingClientRect().top,privateChat.resizers.originalMouseX=t.pageX,privateChat.resizers.originalMouseY=t.pageY,window.addEventListener("mousemove",s),window.addEventListener("mouseup",(function e(){window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",e)}))}))}t("resizer-top-left",(function(t){if(!privateChat.isFullScreen){var s=privateChat.resizers.originalWidth-(t.pageX-privateChat.resizers.originalMouseX),i=privateChat.resizers.originalHeight-(t.pageY-privateChat.resizers.originalMouseY);s>privateChat.resizers.minimumWidth&&(e.style.width=s+"px",e.style.left=privateChat.resizers.originalX+(t.pageX-privateChat.resizers.originalMouseX)+"px",privateChat.dimension.width=s,privateChat.coordinates.x=privateChat.resizers.originalX+(t.pageX-privateChat.resizers.originalMouseX)),i>privateChat.resizers.minimumHeight&&(e.style.height=i+"px",e.style.top=privateChat.resizers.originalY+(t.pageY-privateChat.resizers.originalMouseY)+"px",privateChat.dimension.height=i),privateChat.redraw()}})),t("resizer-top-right",(function(t){if(!privateChat.isFullScreen){var s=privateChat.resizers.originalWidth+(t.pageX-privateChat.resizers.originalMouseX),i=privateChat.resizers.originalHeight-(t.pageY-privateChat.resizers.originalMouseY);s>privateChat.resizers.minimumWidth&&(e.style.width=s+"px",privateChat.dimension.width=s),i>privateChat.resizers.minimumHeight&&(e.style.height=i+"px",e.style.top=privateChat.resizers.originalY+(t.pageY-privateChat.resizers.originalMouseY)+"px",privateChat.dimension.height=i),privateChat.redraw()}})),t("resizer-bottom-left",(function(t){if(!privateChat.isFullScreen){var s=privateChat.resizers.originalHeight+(t.pageY-privateChat.resizers.originalMouseY),i=privateChat.resizers.originalWidth-(t.pageX-privateChat.resizers.originalMouseX);s>privateChat.resizers.minimumHeight&&(e.style.height=s+"px",privateChat.dimension.height=s),i>privateChat.resizers.minimumWidth&&(e.style.width=i+"px",e.style.left=privateChat.resizers.originalX+(t.pageX-privateChat.resizers.originalMouseX)+"px",privateChat.dimension.width=i,privateChat.coordinates.x=privateChat.resizers.originalX+(t.pageX-privateChat.resizers.originalMouseX)),privateChat.redraw()}})),t("resizer-bottom-right",(function(t){if(!privateChat.isFullScreen){var s=privateChat.resizers.originalWidth+(t.pageX-privateChat.resizers.originalMouseX),i=privateChat.resizers.originalHeight+(t.pageY-privateChat.resizers.originalMouseY);s>privateChat.resizers.minimumWidth&&(e.style.width=s+"px",privateChat.dimension.width=s),i>privateChat.resizers.minimumHeight&&(e.style.height=i+"px",privateChat.dimension.height=i),privateChat.redraw()}})),t("resizer-top",(function(t){if(!privateChat.isFullScreen){var s=privateChat.resizers.originalHeight-(t.pageY-privateChat.resizers.originalMouseY);s>privateChat.resizers.minimumHeight&&(e.style.height=s+"px",e.style.top=privateChat.resizers.originalY+(t.pageY-privateChat.resizers.originalMouseY)+"px",privateChat.dimension.height=s),privateChat.redraw()}})),t("resizer-bottom",(function(t){if(!privateChat.isFullScreen){var s=privateChat.resizers.originalHeight+(t.pageY-privateChat.resizers.originalMouseY);s>privateChat.resizers.minimumHeight&&(e.style.height=s+"px",privateChat.dimension.height=s),privateChat.redraw()}})),t("resizer-left",(function(t){if(!privateChat.isFullScreen){var s=privateChat.resizers.originalWidth-(t.pageX-privateChat.resizers.originalMouseX);s>privateChat.resizers.minimumWidth&&(e.style.width=s+"px",e.style.left=privateChat.resizers.originalX+(t.pageX-privateChat.resizers.originalMouseX)+"px",privateChat.dimension.width=s,privateChat.coordinates.x=privateChat.resizers.originalX+(t.pageX-privateChat.resizers.originalMouseX)),privateChat.redraw()}})),t("resizer-right",(function(t){if(!privateChat.isFullScreen){var s=privateChat.resizers.originalWidth+(t.pageX-privateChat.resizers.originalMouseX);s>privateChat.resizers.minimumWidth&&(e.style.width=s+"px",privateChat.dimension.width=s),privateChat.redraw()}}))},redraw:function(e){var t=_i.outerDims(skin.chatFrame),s=_i.outerDims(_i.b),i=cfg.dir?"right":"left",a={},n=_i.lastCss("private-chat-log",privateChat.domHandle),o=_i.lastCss("private-chat-text-cover",privateChat.domHandle),r=_i.lastCss("user-settings",privateChat.domHandle),l=_i.lastCss("user-settings-items",privateChat.domHandle),c=privateChat.dimension.width>0?privateChat.dimension.width:t.outerWidth<600?t.outerWidth:600;if(a.width=_i.addUnit(c),c<420?_i.addClass(privateChat.domHandle,"compact"):_i.removeClass(privateChat.domHandle,"compact"),a.height=privateChat.dimension.height>0?privateChat.dimension.height:s.outerHeight<400?s.outerHeight:400,a.height=_i.addUnit(a.height),e)if(privateChat.isFullScreen)privateChat.domHandle.removeAttribute("style");else{var d=t.outerWidth<610?0:privateChat.coordinates.x;skin.usersListOpened||(d+=privateChat.coordinates.x?0:50,c-=50),a.width=_i.addUnit(c),a.height=privateChat.dimension.height>0?privateChat.dimension.height:s.outerHeight<400?s.outerHeight:400,a.top=privateChat.coordinates.y||(s.outerHeight-a.height)/2,a.top=_i.addUnit(a.top),a[i]=_i.addUnit(d),a.bottom=null,a.right=null,a.height=_i.addUnit(a.height),_i.set(privateChat.domHandle,{style:a})}if(n&&o&&privateChat.adjustTextField(),l){var u=_i.outerDims(_i.lastCss("login-type",privateChat.domHandle)),g=_i.outerDims(_i.lastCss("user-settings-back-button",privateChat.domHandle));l.style.height=_i.addUnit(_i.height(r)-u.outerHeight-g.outerHeight)}},adjustTextField:function(e){if(privateChat.userId){"number"==typeof e&&(privateChat.newLineCount=e);var t=_i.lastCss("private-chat-text-cover",privateChat.domHandle);if(t){var s=_i.lastCss("private-chat-log",privateChat.domHandle),i=_i.height(privateChat.domHandle)-s.parentNode.offsetTop,a=privateChat.TEXT_FIELD_BASE_HEIGHT+privateChat.TEXT_FIELD_HEIGHT_INCREMENTS*privateChat.newLineCount,n=_i.lastCss("private-chat-text",t);i<2*a&&(a=parseInt(i/2)),n.style.height=_i.addUnit(a),s.style.height=_i.addUnit(i-_i.outerDims(t).outerHeight)}}},fullscreen:function(){privateChat.isFullScreen=!privateChat.isFullScreen,privateChat.isFullScreen?_i.addClass(privateChat.domHandle,"is-fullscreen"):_i.removeClass(privateChat.domHandle,"is-fullscreen"),privateChat.redraw(!0)},updatePaymentRequestFee:function(e){var t=_i.id("request-fee");t&&(e=Number(e)||0,t.innerHTML=monetize.calculateFee(e))},imageDragEnter:function(e){e.stopPropagation(),e.preventDefault(),_i.addClass(_i.id("private-chat-log"),"droparea")},imageDragLeave:function(e){e.stopPropagation(),e.preventDefault(),_i.removeClass(_i.id("private-chat-log"),"droparea")}},register={id:"register",errors:{EMPTY_USER_NAME:"register.1",BAD_USER_NAME:"register.2",USER_NAME_IN_USE:"register.3",EMPTY_PASSWORD:"register.4",INVALID_PASSWORD:"register.5",BAD_EMAIL:"register.6",IMAGE_TOO_LARGE:"register.7",IMAGE_UPLOADING:"register.8",INVALID_URL:"register.9"},PASSWORD_REGEX:/^[^,]{6,50}$/,previewImageHandle:null,init:function(){},enter:function(e,t){"Enter"===e.key&&skin.register(t)},previewImage:function(e){register.previewImageHandle.src=e.value,register._setError(e)},validate:function(e,t){var s=!1;0===e.username.value.length?(register._setError(e.username,"EMPTY_USER_NAME"),s=!0):register.validateUsername(e.username.value)?0==e.usernameValid.value&&(register._setError(e.usernameValid,"USER_NAME_IN_USE"),s=!0):(register._setError(e.username,"BAD_USER_NAME"),s=!0),0==e.password.value.length?(register._setError(e.password,"EMPTY_PASSWORD"),s=!0):register.validatePassword(e.password.value)||(register._setError(e.password,"INVALID_PASSWORD"),s=!0),register.validateEmail(e.email.value)||(register._setError(e.email,"BAD_EMAIL"),s=!0),uploader.busy&&(register._setError(e.image,"IMAGE_UPLOADING"),s=!0),s||t()},validateUsernameDom:function(e){register._clickedOnButton(e)||(e.target.value=e.target.value.trim(),0!=e.target.value.length&&(register.validateUsername(e.target.value)?rtc.validateUsernameAvailability(e.target.value,(function(t){var s=_i.firstCss("valid-username",e.target.parentNode);t.free?(s.value=1,register._setError(e.target)):(s.value=0,register._setError(e.target,"USER_NAME_IN_USE"))})):register._setError(e.target,"BAD_USER_NAME")))},validateUsername:function(e){return e&&!/(^(-?\d+)$)|,/.test(e)},validatePasswordDom:function(e){register._clickedOnButton(e)||0!=e.target.value.length&&register._setError(e.target,register.validatePassword(e.target.value)?null:"INVALID_PASSWORD")},validatePassword:function(e){return register.PASSWORD_REGEX.test(e)},validateEmailDom:function(e){register._clickedOnButton(e)||(e.target.value=e.target.value.trim(),0!=e.target.value.length&&register._setError(e.target,register.validateEmail(e.target.value)?null:"BAD_EMAIL"))},validateEmail:function(e){return/^([\w!#$%&'\*\+\-\/=\?\^`{\|}~]+\.)*[\w!#$%&'\*\+\-\/=\?\^`{\|}~]+@((((([a-z0-9][a-z0-9\-]{0,62}[a-z0-9])|[a-z0-9])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(:\d{1,5})?)$/i.test(e)},validateImageDom:function(e){if(!register._clickedOnButton(e)&&(e.target.value=e.target.value.trim(),0!=e.target.value.length))if(register.validateUrl(e.target.value)){var t=new Image;t.onload=function(){register._setError(e.target)},t.onerror=function(){register._setError(e.target,"INVALID_URL")},t.src=e.target.value}else register._setError(e.target,"INVALID_URL")},validateUrl:function(e){return/(https?:)?\/\/(www\.)?[-\w@:%.\+~#=]{2,256}\.[a-z]{2,6}\b([-\w@:%\+.~#?&/=]*)/i.test(e)},uploadFile:function(){uploader.configurations={closeDlg:!1,callback:function(e){var t=document.getElementById("register-image");t&&(t.value=e,register.previewImage(t))},accept:"image/*",imageWidthLimit:128,imageHeightLimit:128,forceResize:!0},skin.uploadFileDialog()},_setError:function(e,t){setTimeout((function(){_i.firstCss("error-label",e.parentNode).innerHTML=t?skin.errors[register.errors[t]]:""}),10)},_clickedOnButton:function(e){return e.relatedTarget&&"BUTTON"===e.relatedTarget.nodeName}},rtc={serverStart:0,mq:[],users:[],maxUsernameLength:0,usersOffline:{},usersBlocked:{},messagesLog:[],usersPrivateMessages:0,archiveId:-1,connectionDone:!1,connected:!1,busy:!1,hash:"",adminMode:!1,listeners:0,reconnects:0,reconnected:!1,reconnectedHandle:0,FLOOD_RECONNECT_DELAY:5e3,RECONNECTED_DELTA:5e3,chatPos:0,approvedPos:0,releaseInterval:0,lastCommand:0,MAX_RECONNECTS:100,MAX_RECONNECTS_SHORT:5,RECONNECTS_DELAY:1e4,RECONNECTS_SHORT_DELAY:2e3,MAX_MESSAGE_LENGTH:2e3,POSITIONS_HEADER:"RumbleTalk-Positions",s3bucket:"rumbletalk-images-upload",commands:{DONATION:1,REQUEST_PAYMENT:2,REQUEST_PAYMENT_PAID:3,DELETE_PM:6,LOGIN:7,PRIVATE_MESSAGE:8,PRIVATE_MESSAGE_OWN:9,GLOBAL_MESSAGE:10,LOAD_ARCHIVE:11,PAYPAL_RESPONSE:12,PRE_APPROVED_MESSAGE:13,APPROVE_MESSAGE:14,UPDATE_OWN:15,DELETE_APPROVED_MESSAGE:16,CLEAR_ALL_MESSAGES:17,RELOAD_CLIENT:18,ADMIN_MODE:19,FETCH_PRIVATE_MESSAGES:20,CHECK_USERNAME:21,LOGOUT_LISTENER:22,P2P:23,DELETE_MESSAGES:24,KICK:25,BLOCK:26,LISTENER_TO_USER:27,NEW_LISTENER:28,USERS_LIST:29,GET_USER_INFO:30,LOGOUT:31,UPDATE_USERS_IP:32,REGISTER_USER:33,MONETIZE_REGISTER:34,EXTEND_SESSION:35,SYSTEM_MESSAGE:36,UPDATE_USER_ID:37,USER_TO_LISTENER:38,GET_MESSAGES:39,USER_STATUS:40,POLLS_GET:41,POLLS_CREATE:42,POLLS_UPDATE:43,POLLS_ACTION:44,POLLS_DISPLAY:45,POLLS_VOTE:46,POLLS_PUBLISH:47},statuses:{OK:200,ACCESS_DENIED:400,ADMIN_PASSWORD:401,PAYMENT_REQUIRED:402,INVALID_CREDENTIALS:403,USER_NAME_IN_USE:409,CHAT_CLOSED:410,SPEAKERS_QUOTA_EXCEEDED:429,LISTENERS_QUOTA_EXCEEDED:430,KICKED:431,BAD_WORDS:432,FLOOD:433,BANNED:434,NOT_REGISTERED_ROOM:435,DISCONNECTED:0},pollsAction:{SEND:"send",RESET:"reset",PUBLISH:"publish",DELETE:"delete"},userStatuses:{},init:function(){_i.init(),rtc.hash=_i.l.pathname.substr(1,_i.l.pathname.length-2);var e=new XMLHttpRequest;e.open("GET","https://"+rtc.s3bucket+".s3.amazonaws.com/"+rtc.hash+"/configuration/cfg.json"),e.onreadystatechange=function(){if(4===e.readyState){try{window.cfg=JSON.parse(e.responseText)}catch(e){console.error("Failed to load cfg.json file")}_i.is("init-loader")&&_i.remove("init-loader"),_i.addClass(document.documentElement,cfg.dir?"rtl":"ltr"),auth.init(),_i.events([{name:"beforeunload",cb:rtc.beforeClosing},{name:"orientationchange",cb:function(){setTimeout(skin.draw,100)}}]),rtc.userStatuses={ONLINE:{text:cfg.strings.online,value:1},AWAY:{text:cfg.strings.away,value:2},BUSY:{text:cfg.strings.busy,value:3}},skin.setOneOnOne(cfg.chatType===_i.chatTypes.ONE_ON_ONE),uploader.updateValidities(),window.dataLayer=[],window.gtag=function(){dataLayer.push(arguments)},_i.load("https://www.googletagmanager.com/gtag/js?id=UA-20104634-3"),gtag("js",new Date),gtag("config","UA-20104634-3"),cfg.menuSettings.exportTranscript>0&&_i.load("chat/js/FileSaver.min.js"),_i.webrtc&&(_i.load("chat/js/RecordRTC.5.6.2.min.js"),_i.ua===_i.userAgents.EDGE&&_i.load("https://webrtc.github.io/adapter/adapter-latest.js")),keywords.init(),skin.buildCustomizedCss(_i.mobile?cfg.mobileCss:cfg.css),skin.init(),_i.mobile&&(_i.id("photo").onclick=function(){uploader.configurations={closeDlg:!0,callback:skin.messageFullPost,imageWidthLimit:800,imageHeightLimit:600},skin.takePhotoDialog()},skin.callingBox.addEventListener("touchmove",(function(e){e.preventDefault()})),setInterval(skin.checkDims,100),document.addEventListener("click",skin.mobileClearScreen,!1),cfg.inviteFriends?_i.id("top-bar-left").onclick=function(e){var t=_i.id("invite-dialog");e.stopPropagation(),skin.mobileClearScreen(e,t),_i.toggleClass(t,"active")}:_i.remove(_i.id("top-bar-left")),skin.listHandle.onclick=function(e){e.stopPropagation(),skin.mobileClearScreen(e,skin.listFrame),skin.toggleListDisplay(!skin.usersListOpened)},_i.webrtc&&!skin.isPrivateChat()||(_i.remove("photo"),_i.id("users").style.width="50%",_i.id("uploadMobile").style.width="50%"),cfg.upload&&!skin.isPrivateChat()||(_i.remove("photo"),_i.remove("uploadMobile"),_i.id("users").style.width="100%"),skin.sound||_i.addClass(_i.firstCss("sound-li"),"inactive"),skin.privatePopup||_i.addClass(_i.firstCss("toggle-private"),"inactive")),(cfg.logins.facebook||cfg.inviteFriends)&&facebook.init(),twitter.init(),guest.init(),rumbletalk.init(),net.init()?(polls.init(),auth.loadStorage(),rtc.connect((function(){rtc.connectionDone=!0,skin.draw(),skin.welcomeMessage(),skin.initializeSendLimit(!1),setInterval(sdk.handleStorageRequests,1e3)}))):skin.showMessage(cfg.strings.invalid_browser)}},e.send()},beforeClosing:function(){p2p.stop(),net.close()},reconnect:function(){dlg.close(!0),skin.wait(cfg.strings.connecting),setTimeout(rtc.connect,rtc.FLOOD_RECONNECT_DELAY)},connect:function(e){rtc.reconnects=0,dlg.close(!0),skin.wait(cfg.strings.connecting),_i.storage.removeItem("d",!1);var t={delay:0,data:{cmd:rtc.commands.USERS_LIST},endCb:e};rtc.send(t)},disconnect:function(e,t,s){if(clearInterval(rtc.releaseInterval),net.close(),auth.loggedIn&&s){var i=rtc.user(auth.id)||rtc.user(auth.lastId);0!==i.loginType.ssoType&&1!==i.loginType.ssoType||i.loginType.logout(),sdk.notifyLogout(s)}rtc.users=[],rtc.mq=[],rtc.archiveId=-1,auth.setLoggedIn(!1),rtc.connected=!1,rtc.busy=!1,auth.id=0,rtc.listeners=0,rtc.chatPos=0,rtc.approvedPos=0,privateChat.position=0,rtc.lastCommand=0,rtc.releaseInterval=0,skin.lastArchivedUser=0,skin.lastMsgIds=[],auth.setModerator(!1),skin.closeCalling(),skin.chatExtra.style.display="none",e&&(skin.ownMessages=[]),privateChat.clearMessages(),_i.storage.removeItem(rtc.hash),_i.storage.removeItem(rtc.hash,!0),skin.clearUsers(),skin.setListeners(),skin.readyForLogin(),!t&&cfg.allowListeners||skin.disconnected(t)},releaseSend:function(){-1!==_i.indexOf([0,1,4],net.s.readyState)&&rtc.busy&&rtc.mq.length>0&&rtc.releasableCommand(rtc.lastCommand)&&(rtc.lastCommand=0,rtc.busy=!1,rtc.sendQ())},releasableCommand:function(e){return-1!==[rtc.commands.DELETE_PM,rtc.commands.P2P,rtc.commands.DELETE_MESSAGES,rtc.commands.KICK,rtc.commands.BLOCK,rtc.commands.GET_MESSAGES].indexOf(e)},delaySend:function(e,t){net.send(e,t)},send:function(e){if(rtc.busy)return rtc.connected||e.delay||(e.delay=1500),void rtc.mq.push(e);rtc.lastCommand=e.data.cmd,e.data=JSON.stringify(e.data),rtc.busy=!0;var t=rtc.chatPos+","+privateChat.position;cfg.chatType==_i.chatTypes.MODERATED&&auth.moderator&&(t+=","+rtc.approvedPos);var s={"Cache-Control":"no-store","Content-Type":"application/json; charset=utf-8"};if(s[rtc.POSITIONS_HEADER]=t,auth.local.s||rtc.lastCommand==rtc.commands.USERS_LIST&&auth.local.r||_i.storage.getItem(rtc.hash,!0)&&_i.storage.getItem(rtc.hash,!0).s||auth.local[twitter.storageName]||auth.local[facebook.storage]){var i,a=[];for(i in auth.session)if(auth.session.hasOwnProperty(i)){if("rumbletalk-private-message-logs"===i)continue;a.push(i+"="+auth.session[i])}for(i in auth.local)auth.local.hasOwnProperty(i)&&a.push(i+"="+auth.local[i]);s.Sookie=a.join(";")}e.cb=rtc.netHandler,e.headers=s,rtc.delaySend(e,e.delay||200)},sendQ:function(){var e;e=rtc.mq.length>0?rtc.mq.shift():{data:{cmd:rtc.commands.GET_MESSAGES}},rtc.send(e)},resend:function(e,t){rtc.delaySend(e,t)},commandAffectsConnection:function(e){var t=[rtc.commands.CHECK_USERNAME,rtc.commands.EXTEND_SESSION,rtc.commands.MONETIZE_REGISTER,rtc.commands.REGISTER_USER];return-1===_i.indexOf(t,e)||cfg.allowListeners},netHandler:function(e,t){if(4==e.readyState){var s,i,a=e.responseText,n=0,o=!0,r=e.getResponseHeader(rtc.POSITIONS_HEADER)||"",l=e.status==rtc.statuses.OK&&0==a.length?rtc.statuses.DISCONNECTED:e.status;if(auth.handleStorage(e)){if(a)try{a=JSON.parse(a)}catch(e){return void console.log("Invalid JSON in rtc.netHandler:",a)}switch(l){case rtc.statuses.OK:if(t.loginType===twitter&&twitter.clearStorage(),t.cmdCb)t.cmdCb(a,t);else if(a instanceof Array)for(s=0;s<a.length;s++)rtc.parseCommand(a[s],a[0].cmd==rtc.commands.USERS_LIST);else rtc.parseCommand(a);(r=r.split(",")).length>1&&(rtc.chatPos=Number(r[0]),privateChat.position=Number(r[1]),auth.moderator&&cfg.chatType==_i.chatTypes.MODERATED&&(rtc.approvedPos=Number(r[2]))),!rtc.connected&&rtc.commandAffectsConnection(a.cmd)&&(rtc.connected=!0,rtc.releaseInterval=setInterval(rtc.releaseSend,1e3),skin.connected(),auth.loggedIn||skin.readyForLogin(),skin.checkWaitingForModerator(),skin.checkWaitingForOtherUsers(),_i.storage.getItem("s",!0)||console.log("WARNING: storage are disabled"));break;case rtc.statuses.BANNED:i="abuse_banned";case rtc.statuses.ACCESS_DENIED:i=i||"access_denied";case rtc.statuses.KICKED:i=i||"abuse_kicked";case rtc.statuses.FLOOD:i=i||"abuse_flood",_i.storage.removeItem("r",!0),rtc.connected?rtc.disconnect(!0,l,auth.getLastLogoutReason()||i):skin.mustLogin(),l==rtc.statuses.BANNED&&(auth.moderator||(_i.storage.setItem("banned",!0,!0),auth.banned=!0));break;case rtc.statuses.BAD_WORDS:skin.showMessage(cfg.strings.bad_words,"bad-words");break;case rtc.statuses.INVALID_CREDENTIALS:if(rtc.lastCommand==rtc.commands.USERS_LIST)return rtc.busy=!1,_i.storage.removeItem("r",!0),void rtc.send({data:{cmd:rtc.commands.USERS_LIST}});t.loginType===twitter&&twitter.clearStorage(),skin.showError({type:t.loginType,status:rtc.statuses.INVALID_CREDENTIALS,fields:t.fields});break;case rtc.statuses.USER_NAME_IN_USE:skin.showError({type:t.loginType,status:rtc.statuses.USER_NAME_IN_USE,fields:t.fields});break;case rtc.statuses.ADMIN_PASSWORD:t.loginType===twitter&&(twitter.process=!1),_i.storage.removeItem("r",!0),skin.showError({type:rumbletalk,status:rtc.statuses.ADMIN_PASSWORD,fields:t.fields,realType:t.loginType});break;case rtc.statuses.SPEAKERS_QUOTA_EXCEEDED:rtc.connected&&rtc.disconnect(!1,!1,!!auth.loggedIn&&"quota_exceeded"),skin.quota(rtc.statuses.SPEAKERS_QUOTA_EXCEEDED);break;case rtc.statuses.LISTENERS_QUOTA_EXCEEDED:rtc.connected&&rtc.disconnect(!1),skin.quota(rtc.statuses.LISTENERS_QUOTA_EXCEEDED);break;case rtc.statuses.CHAT_CLOSED:rtc.disconnect(!0,null,"chat_closed"),skin.close(!0),skin.closed();break;case rtc.statuses.PAYMENT_REQUIRED:skin.paymentSummaryDialog(a,!0);break;case rtc.statuses.NOT_REGISTERED_ROOM:skin.loginHash=a.hash,skin.confirmRegisterDialog();break;default:if(o=!1,rtc.MAX_RECONNECTS<=++rtc.reconnects){rtc.disconnect(!1,null,"network_issue"),skin.cannotConnect();break}rtc.connected&&(rtc.connected=!1,clearInterval(rtc.releaseInterval),rtc.releaseInterval=0),rtc.resend(t,rtc.MAX_RECONNECTS_SHORT<=rtc.reconnects?rtc.RECONNECTS_DELAY:rtc.RECONNECTS_SHORT_DELAY),n=1}o&&(rtc.reconnects>0&&rtc.reconnectingGrace(),rtc.reconnects=0),rtc.busy=n,"function"==typeof t.endCb&&t.endCb(),rtc.connected&&rtc.sendQ()}else rtc.disconnect(!0,rtc.statuses.DISCONNECTED,"different_sessions")}},reconnectingGrace:function(){rtc.reconnected=!0,clearTimeout(rtc.reconnectedHandle),rtc.reconnectedHandle=setTimeout((function(){rtc.reconnected=!1,rtc.reconnectedHandle=0}),rtc.RECONNECTED_DELTA)},userIndex:function(e,t,s){var i;for(i=0;i<rtc.users.length;i++)if(!s&&rtc.users[i][e]==t||s&&rtc.users[i][e].toUpperCase()==t.toUpperCase())return i;return-1},user:function(e){return rtc.users[rtc.userIndex("id",e)]},positionUser:function(e){var t;for(t=0;t<rtc.users.length;t++)if(!rtc.users[t].moderator||e.moderator){if(!rtc.users[t].moderator&&e.moderator)break;if(!rtc.users[t].hadPrivateMsg||e.hadPrivateMsg){if(e.hadPrivateMsg)break;if(e.privateMsg>0)break;if(!(rtc.users[t].name.localeCompare(e.name)<0))break}}return rtc.users.splice(t,0,e),t},addUser:function(e,t,s,i,a,n,o,r){var l={id:e,name:t,image:s,ip:i,ssoUid:a,loginType:n,moderator:o,privateMsg:0,status:r},c=rtc.positionUser(l);l.image||(l.image=n.pic(l)),rtc.maxUsernameLength<t.length&&(rtc.maxUsernameLength=t.length),delete rtc.usersOffline[e],skin.newUser({user:l,index:c+1})},removeUser:function(e){var t=rtc.userIndex("id",e);return t>-1&&(rtc.usersOffline[e]=rtc.users.splice(t,1)[0],rtc.usersOffline[e].name.length==rtc.maxUsernameLength&&rtc.updateMaxUsernameLength(),skin.removeUser(rtc.usersOffline[e]),e!=auth.id&&e!=auth.lastId&&skin.systemMessage(rtc.usersOffline[e].name+cfg.strings.left,"userLeft"),!0)},updateMaxUsernameLength:function(){var e;for(rtc.maxUsernameLength=0,e=0;e<rtc.users.length;e++)rtc.maxUsernameLength<rtc.users[e].name.length&&(rtc.maxUsernameLength=rtc.users[e].name.length)},parseUser:function(e,t){var s=auth.getLoginType(e.ssoType);rtc.user(e.id)||(rtc.addUser(e.id,e.un,e.image,e.ip,e.ssoUid,s,e.mod,e.status),skin.updateBlockedUserDom(e.id),skin.updateUserStatusDom(e.id,e.status)),auth.loggedIn||auth.id!=e.id||(auth.setLoggedIn(!0),auth.lastSsoUid=e.ssoUid,e.se&&auth.updateExpiration(e.se),uploader.updateValidities(),skin.loggedIn(),!t&&cfg.chatType==_i.chatTypes.ONE_ON_ONE&&auth.moderator&&cfg.allowListeners&&skin.reloadUsers(),rtc.user(e.id).status=e.status,skin.updateUserStatusDom(e.id,e.status),rtc.track("Login",s.id,rtc.hash))},usersList:function(e){var t;if(auth.id=e.uId,auth.setModerator(e.mod),auth.updateExpiration(e.exp),rtc.listeners=e.listeners,rtc.archiveId=e.aId,skin.toggleAdminMode(e.aMode),rtc.users=[],rtc.updateMessagesOnRestart(e.ts),skin.clearUsers(),skin.setListeners(),auth.setLoggedIn(!1),e.users)for(t=0;t<e.users.length;t++)rtc.parseUser(e.users[t],!0)},getUserOfMessage:function(e){var t=rtc.user(e.uid)||rtc.usersOffline[e.uid];return t||((t={id:e.uid,loginType:auth.getLoginType(e.ssotype),ssoUid:e.ssouid,name:e.un,image:e.img}).image||(t.image=t.loginType.pic(t)),rtc.usersOffline[t.id]=t),t},loadArchive:function(){rtc.send({data:{cmd:rtc.commands.LOAD_ARCHIVE,data:{aId:rtc.archiveId}},cmdCb:rtc.archiveLoaded})},archiveLoaded:function(e,t){e.data.forEach((function(e){skin.archivedMessage(e)})),rtc.archiveId=e.aId,skin.archiveDone(!0===t)},disconnectUser:function(e,t){auth.moderator&&(rtc.usersOffline[e]&&(rtc.updateOfflineUsersBanned(rtc.usersOffline[e].ip),privateChat.close(),skin.showUserInfo(e),privateChat.switchView("user-messaging")),rtc.send({data:{cmd:t,data:{id:e}}}))},clearAllMessages:function(){auth.moderator&&rtc.send({data:{cmd:rtc.commands.CLEAR_ALL_MESSAGES,data:{global:!0,private:!1}}})},deleteMessages:function(e){auth.moderator&&rtc.send({data:{cmd:rtc.commands.DELETE_MESSAGES,data:{ids:e}}})},sendP2PAction:function(e,t,s){auth.banned||rtc.send({data:{cmd:rtc.commands.P2P,data:{uId:e,action:t,data:s}}})},validateUsernameAvailability:function(e,t){rtc.send({data:{cmd:rtc.commands.CHECK_USERNAME,data:{un:e}},cmdCb:t})},fetchPrivateMessages:function(e,t){rtc.send({data:{cmd:rtc.commands.FETCH_PRIVATE_MESSAGES,data:{uId:e}},cmdCb:t})},track:function(e,t,s,i){cfg.track&&gtag("event",t,{event_category:e,event_label:s,value:i})},addToMessagesLog:function(e,t,s){var i={position:e.pos,userId:t.id,name:t.name,image:t.image,time:e.time,text:e.text};return s?rtc.messagesLog.unshift(i):rtc.messagesLog.push(i),i},removeFromMessagesLog:function(e){var t;for(t=0;t<rtc.messagesLog.length;t++)if(rtc.messagesLog[t].position==e)return void rtc.messagesLog.splice(t,1)},updateUsersIp:function(e){var t,s;for(s=0;s<e.length;s++)(t=rtc.user(e[s].id))&&(t.ip=e[s].ip)},clearIpAddresses:function(){var e;for(e=0;e<rtc.users.length;e++)delete rtc.users[e].ip;for(e=0;e<rtc.usersOffline;e++)delete rtc.usersOffline[e].ip,delete rtc.usersOffline[e].banned},getOfflineUserInfo:function(e,t){rtc.usersOffline[e.id].ip?rtc.usersOffline[e.id].loginType.getUserInfo(rtc.usersOffline[e.id],t):rtc.send({data:{cmd:rtc.commands.GET_USER_INFO,data:{uId:e.id}},params:{userId:e.id,callback:t},cmdCb:rtc.gotOfflineUserInfo})},gotOfflineUserInfo:function(e,t){rtc.usersOffline[t.params.userId].ip=e.data.ip,rtc.usersOffline[t.params.userId].banned=1==e.data.ban,rtc.usersOffline[t.params.userId].loginType===rumbletalk&&(rtc.usersOffline[t.params.userId].description=rumbletalk.parseDescription(e.data.desc)),rtc.usersOffline[t.params.userId].loginType.getUserInfo(rtc.usersOffline[t.params.userId],t.params.callback)},getUserInfo:function(e,t){var s={data:{cmd:rtc.commands.GET_USER_INFO,data:{uId:e.id}},cmdCb:t};rtc.send(s)},updateOfflineUsersBanned:function(e){var t;for(t in rtc.usersOffline)rtc.usersOffline.hasOwnProperty(t)&&rtc.usersOffline[t].ip==e&&(rtc.usersOffline[t].banned=!0)},updateMessagesOnRestart:function(e){var t,s,i;if(rtc.serverStart!=e){if(0==cfg.archive){for(t=0;t<rtc.messagesLog.length;t++)rtc.messagesLog[t].marked||(s=_i.id("msg_"+rtc.messagesLog[t].position),rtc.messagesLog[t].position=e+"-"+rtc.messagesLog[t].position,rtc.messagesLog[t].marked=!0,s.id="msg_"+rtc.messagesLog[t].position,auth.moderator&&(i=_i.firstCss("delete-message",s))&&i.setAttribute("onclick","skin.deleteMessages(this);"));skin.lastMsgIds=[]}rtc.reconnectingGrace()}privateChat.clearMessages(),rtc.serverStart=e},parseCommand:function(e,t){var s;switch(e.cmd){case rtc.commands.DONATION:skin.donationMessage({userId:e.uid,ssoType:e.ssotype,ssoUid:e.ssouid,name:e.un,time:1e3*e.ts,text:e.msg,amount:parseFloat(e.amt),currency:e.currency});break;case rtc.commands.REQUEST_PAYMENT:if(!(s=rtc.user(e.senderId)||rtc.usersOffline[e.senderId]))return;skin.privateMessage({position:e.pos,id:e.id,time:1e3*e.ts,senderId:e.senderId,type:privateChat.messageTypes.PAYMENT_REQUEST_RECEIVED,text:cfg.strings.request_payment_message.replace("{{name}}",s.name).replace("{{amount}}",monetize.formatCurrency(e.currency)+e.amt),amount:e.amt,currency:e.currency,link:e.link},t);break;case rtc.commands.REQUEST_PAYMENT_PAID:var i,a=e.amt+monetize.calculateFee(e.amt);if(!(s=rtc.user(e.uId)||rtc.usersOffline[e.uId]))return;i=(i=e.type==privateChat.messageTypes.REMOTE?cfg.strings.request_payment_receive:cfg.strings.request_payment_sent).replace("{{amount}}",monetize.formatCurrency(e.currency)+a).replace("{{name}}",s.name),skin.privateMessage({position:e.pos,id:e.id,time:1e3*e.ts,senderId:e.uId,type:privateChat.messageTypes.PAYMENT_REQUEST_PAID,text:i,amount:a,currency:e.currency},t);var n=privateChat.findMessage(e.uId,e.requestId);n&&(n.paid=!0);break;case rtc.commands.DELETE_PM:privateChat.deleteMessage(e.ids,!1,e.uid);break;case rtc.commands.LOGIN:rtc.parseUser(e.data),skin.checkWaitingForModerator(),skin.checkWaitingForOtherUsers();break;case rtc.commands.PRIVATE_MESSAGE:skin.privateMessage({id:e.id,position:e.pos,text:e.text,time:1e3*e.ts,type:e.type,senderId:e.uid},t);break;case rtc.commands.PRIVATE_MESSAGE_OWN:privateChat.updateOwn({id:e.id,tempId:e.tempId,position:e.pos,timestamp:e.ts});break;case rtc.commands.GLOBAL_MESSAGE:skin.message(e);break;case rtc.commands.PAYPAL_RESPONSE:try{console.log(e.data)}catch(t){console.log("[no parsing]",e)}break;case rtc.commands.PRE_APPROVED_MESSAGE:e.pending=!0,skin.message(e);break;case rtc.commands.APPROVE_MESSAGE:if(!auth.moderator)return;var o=_i.id("apr_"+e.pos);o&&(_i.addClass(o,"removed"),setTimeout((function(){_i.remove(o)}),300));break;case rtc.commands.UPDATE_OWN:skin.updateOwnMessage(e);break;case rtc.commands.DELETE_APPROVED_MESSAGE:skin.deleteMessages([e.pos],!0);break;case rtc.commands.CLEAR_ALL_MESSAGES:e.data.global&&skin.clear(),e.data.private&&privateChat.clearMessages();break;case rtc.commands.RELOAD_CLIENT:_i.storage.removeItem("banned",!0),skin.requestToolbarReload();break;case rtc.commands.ADMIN_MODE:skin.toggleAdminMode(e.data.mute),skin.systemMessage(rtc.adminMode?cfg.strings.admin_mode_on:cfg.strings.admin_mode_off,"notice",!0),rtc.adminMode&&!auth.moderator&&(skin.textInput.innerText="",skin.adjustTextField(0)),auth.loggedIn&&skin.textInput.setAttribute("contenteditable",(!rtc.adminMode||auth.moderator).toString());var r=document.querySelector(".admin-mode-switch input");r&&(r.checked=rtc.adminMode);break;case rtc.commands.LOGOUT_LISTENER:rtc.connected&&rtc.listeners>0&&(rtc.listeners--,skin.setListeners());break;case rtc.commands.P2P:skin.p2pAction(e.data);break;case rtc.commands.DELETE_MESSAGES:skin.deleteMessages(e.data.ids);break;case rtc.commands.LISTENER_TO_USER:rtc.connected&&rtc.listeners>0&&(rtc.listeners--,skin.setListeners()),rtc.parseUser(e.data),skin.checkWaitingForModerator(),skin.checkWaitingForOtherUsers();break;case rtc.commands.NEW_LISTENER:rtc.listeners++,skin.setListeners();break;case rtc.commands.LOGOUT:e.data.soft||(auth.id==e.data.id?rtc.disconnect(!0,!1,auth.getLastLogoutReason()):rtc.removeUser(e.data.id));break;case rtc.commands.UPDATE_USERS_IP:rtc.updateUsersIp(e.data);break;case rtc.commands.EXTEND_SESSION:auth.updateExpiration(e.data.exp);break;case rtc.commands.SYSTEM_MESSAGE:skin.systemMessageAPI(e.data);break;case rtc.commands.UPDATE_USER_ID:auth.updateUserId(e.data);break;case rtc.commands.USER_TO_LISTENER:auth.id==e.data.id||auth.lastId==e.data.id?auth.loggedOut(e.data,auth.getLastLogoutReason()):(rtc.listeners++,skin.setListeners(),rtc.removeUser(e.data.id),skin.checkWaitingForModerator(),skin.checkWaitingForOtherUsers());break;case rtc.commands.USERS_LIST:rtc.usersList(e.data);break;case rtc.commands.USER_STATUS:rtc.userStatus(e.data);break;case rtc.commands.POLLS_GET:polls.get(e.data);break;case rtc.commands.POLLS_ACTION:skin.close(!0);var l=e.data.action===polls.ACTIONS.DELETE,c=e.data.action===polls.ACTIONS.RESET;if(!e.data.status&&l){skin.showMessage(cfg.strings.polls_delete_failed);break}if(!e.data.status&&c){skin.showMessage(cfg.strings.polls_reset_failed);break}if((l||c)&&polls.deletePollInCache(e.data.id),e.data.fromAdmin)return;skin.pollsDialog();break;case rtc.commands.POLLS_DISPLAY:skin.viewPollDialog(JSON.stringify(e.data),!0,!1);break;case rtc.commands.POLLS_VOTE:if(e.data.err_msg)return void skin.showMessage(cfg.strings.polls_vote_fail);polls.storeVote(e.data.id,e.data.vote),skin.showMessage(cfg.strings.polls_vote_success);break;case rtc.commands.POLLS_PUBLISH:skin.viewPollDialog(JSON.stringify(e.data),!1,!0)}},getPaymentLink:function(e,t,s){rtc.send({data:{cmd:rtc.commands.DONATION,data:{message:t,amount:s}},cmdCb:function(t){if(t.cmd!=rtc.commands.DONATION)return console.log("invalid paypal response:",t),void skin.close();setTimeout((function(){e(t.data.link)}),1)}})},sendPaymentRequest:function(e,t,s,i){auth.moderator&&auth.id!=e&&!auth.banned&&rtc.send({data:{cmd:rtc.commands.REQUEST_PAYMENT,data:{toUserId:e,amount:t,currency:s}},cmdCb:i})},deletePrivateMessages:function(e,t){rtc.send({data:{cmd:rtc.commands.DELETE_PM,data:{uid:e,ids:t}}})},sendMessage:function(e){auth.banned||rtc.adminMode&&!auth.moderator||rtc.send({data:{cmd:rtc.commands.GLOBAL_MESSAGE,data:{text:e}}})},sendPrivateMessage:function(e,t,s){auth.banned||rtc.send({data:{cmd:rtc.commands.PRIVATE_MESSAGE,data:{uid:e,tempId:t,text:s}}})},approveMessage:function(e,t){rtc.send({data:{cmd:rtc.commands.APPROVE_MESSAGE,data:{pos:e,uId:auth.id,status:t}}})},setAdminMode:function(){rtc.send({data:{cmd:rtc.commands.ADMIN_MODE,data:{mute:rtc.adminMode}}})},userStatus:function(e){rtc.user(e.userId)&&(rtc.user(e.userId).status=e.status,skin.updateUserStatusDom(e.userId,e.status))},updateUserStatus:function(e){skin.updateUserStatusDom(auth.id,e),rtc.send({data:{cmd:rtc.commands.USER_STATUS,data:{userId:auth.id,status:e}}})},sendPollsGet:function(e){var t={cmd:rtc.commands.POLLS_GET};if(e)return t.data={id:e},void rtc.send({data:t,cmdCb:polls.paginateLoaded});t.data={id:(polls.currentPage-1)*polls.RECORDS_LIMIT},rtc.send({data:t})},sendPollSave:function(e){var t=0===polls.model.id,s=t?rtc.commands.POLLS_CREATE:rtc.commands.POLLS_UPDATE,i={question:polls.model.question,answer1:polls.model.answer1,answer2:polls.model.answer2,answer3:polls.model.answer3,answer4:polls.model.answer4};e&&(i.send=!0),t||(i.id=polls.model.id),rtc.send({data:{cmd:s,data:i},cmdCb:function(){t?rtc.pollsCreate(e):rtc.pollsUpdate(e)}})},pollsCreate:function(e){_i.id("btn-polls-cancel").disabled=!1,_i.id("btn-polls-send").disabled=!1,_i.id("btn-polls-save").disabled=!1,(e?_i.id("btn-polls-send"):_i.id("btn-polls-save")).innerHTML=e?cfg.strings.polls_send:cfg.strings.polls_save,polls.resetForm();var t=_i.create("div",{className:"alert alert-success",innerHTML:"<b>Success!</b> Poll created"},_i.id("polls-update-dialog"),_i.id("polls-update-form"));setTimeout((function(){t.style.opacity="0",t.style.display="none",_i.remove(t)}),3e3)},pollsUpdate:function(e){_i.id("btn-polls-cancel").disabled=!1,_i.id("btn-polls-delete").disabled=!1,_i.id("btn-polls-send").disabled=!1,_i.id("btn-polls-save").disabled=!1,(e?_i.id("btn-polls-send"):_i.id("btn-polls-save")).innerHTML=e?cfg.strings.polls_send:cfg.strings.polls_save;var t=_i.create("div",{className:"alert alert-success",innerHTML:"<b>Success!</b> Poll updated"},_i.id("polls-update-dialog"),_i.id("polls-update-form"));setTimeout((function(){t.style.opacity="0",t.style.display="none",_i.remove(t)}),3e3)},sendPollsAction:function(e,t){t===polls.ACTIONS.DELETE&&(skin.close(!0),skin.wait(cfg.strings.deleting)),rtc.send({data:{cmd:rtc.commands.POLLS_ACTION,data:{id:e,action:t}}})},sendPollsVote:function(e,t){rtc.send({data:{cmd:rtc.commands.POLLS_VOTE,data:{id:e,vote:t}}})}},rumbletalk={id:"rumbletalk",isSSO:!0,ssoType:2,name:"Username",errors:{EMPTY_USER_NAME:"rumbletalk.1",EMPTY_PASSWORD:"rumbletalk.2",BAD_USER_NAME:"rumbletalk.3"},init:function(){rumbletalk.name=cfg.strings.rumbletalk},setup:function(e,t){if(!e.hash)return e.username=e.username.trim(),e.username&&0!=e.username.length?/^-?\d+$/.test(e.username)?rumbletalk.errors.BAD_USER_NAME:e.password&&0!=e.password.length?void t(rumbletalk,!0,e):rumbletalk.errors.EMPTY_PASSWORD:rumbletalk.errors.EMPTY_USER_NAME;t(rumbletalk,!0,e)},logout:function(e){e()},pic:function(e){return e.image||guest.pic()},getUserInfo:function(e,t){"string"==typeof e.description?rumbletalk.gotUserInfo(e,t):rtc.getUserInfo(e,(function(s){auth.moderator&&(e.ip=s.data.ip,e.banned=s.data.ban),e.description=rumbletalk.parseDescription(s.data.desc),rumbletalk.gotUserInfo(e,t)}))},gotUserInfo:function(e,t){e.description?t(e,{buttons:[],texts:[{label:cfg.strings.description,text:e.description}]}):t(e)},parseDescription:function(e){return"string"!=typeof e?"":e=(e=gui.safe(e)).replace(/(^|[^\\](\\\\)*)(\\n)/g,(function(e,t){return t+"<br>"})).replace(/\\\\/g,"\\")}},sdk={postMessageEvents:{LOGOUT_CB:"pm.1",LOGOUT_CB_RECEIVED:"pm.2",LOGIN:"pm.3",LOGIN_SUCCESS:"pm.4",LOGIN_ALREADY_LOGGED_IN:"pm.5",LOGOUT:"pm.6",OPEN_PRIVATE_CHAT:"pm.7"},logoutCallbackTarget:{source:null,origin:""},isSDKMessage:function(e){return e&&"pm."==e.substring(0,3)},handleEventRequests:function(e){if(sdk.isValidDomain(_i.getHostname(e.origin)))switch(e.data.type){case sdk.postMessageEvents.LOGIN:sdk.handleSDKLogin(e);break;case sdk.postMessageEvents.LOGOUT:sdk.handleSDKLogout(e);break;case sdk.postMessageEvents.LOGOUT_CB:sdk.handleSDKLogoutCB(e);break;case sdk.postMessageEvents.OPEN_PRIVATE_CHAT:sdk.handleOpenPrivateChat(e)}else e.source.postMessage("STOP",e.origin)},handleSDKLoginLegacy:function(e){if(!auth.loggedIn&&!_i.storage.getItem("r",!0)&&sdk.isValidDomain(_i.getHostname(e.origin))){var t=e.data.substr(6);t={username:(t=t.split(","))[0],password:t[1]},dlg.close(!0),auth.login(t.password?rumbletalk:guest,t)}e.source.postMessage("RTloginSuccess",e.origin)},handleSDKLogin:function(e){var t;if(e.data.forceLogin||!auth.loggedIn&&!_i.storage.getItem("r",!0)){var s={username:e.data.username,password:e.data.password};function i(){dlg.close(!0),skin.login(s.password?rumbletalk:guest,s)}e.data.image&&!s.password&&(s.image=e.data.image),dlg.close(!0),auth.loggedIn||_i.storage.getItem("r",!0)?rtc.user(auth.id).name!==s.name&&auth.logout("sdk_request",i):i(),t=sdk.postMessageEvents.LOGIN_SUCCESS}else t=sdk.postMessageEvents.LOGIN_ALREADY_LOGGED_IN;e.source.postMessage({type:t,hash:rtc.hash},e.origin)},handleSDKLogout:function(e){rtc.connectionDone||setTimeout((function(){sdk.handleSDKLogout(e)}),1e3),auth.loggedIn||_i.storage.getItem("r",!0)?e.data.userId&&e.data.userId!=auth.id?console.log("invalid user id supplied"):e.data.username&&e.data.username!==rtc.user(auth.id).name?console.log("invalid user name supplied"):auth.logout("sdk_request"):console.log("user is not logged in")},handleSDKLogoutCB:function(e){sdk.logoutCallbackTarget={source:e.source,origin:e.origin},e.source.postMessage({type:sdk.postMessageEvents.LOGOUT_CB_RECEIVED,hash:rtc.hash},e.origin)},handleOpenPrivateChat:function(e){var t;if(e.data.userId)t=rtc.user(e.data.userId);else{if(!e.data.username)return;t=rtc.users[rtc.userIndex("name",e.data.username,!0)]}t?(privateChat.open(t.id),e.source.postMessage({type:sdk.postMessageEvents.OPEN_PRIVATE_CHAT,hash:rtc.hash,result:"success"},e.origin)):e.source.postMessage({type:sdk.postMessageEvents.OPEN_PRIVATE_CHAT,hash:rtc.hash,result:"user not found"},e.origin)},notifyLogout:function(e){sdk.logoutCallbackTarget.source&&sdk.logoutCallbackTarget.source.postMessage({type:sdk.postMessageEvents.LOGOUT_CB,hash:rtc.hash,reason:e||"unknown"},sdk.logoutCallbackTarget.origin)},handleStorageRequests:function(){var e,t=_i.storageItems(["rt_tmp_username","rt_tmp_password","rt_sdk_request"],!0);if(t.rt_sdk_request){_i.storage.removeItem("rt_sdk_request",!0);try{e=JSON.parse(t.rt_sdk_request)}catch(e){console.log(e)}if(!sdk.isValidDomain(e.hostname))return;switch(e.username&&(e.name=e.username,delete e.username),e.type){case sdk.postMessageEvents.LOGIN:sdk.handleStorageLogin(e);break;case sdk.postMessageEvents.LOGOUT:sdk.handleStorageLogout(e)}}t.rt_tmp_username&&(_i.storage.removeItem("rt_tmp_username",!0),_i.storage.removeItem("rt_tmp_password",!0),e={name:decodeURIComponent(t.rt_tmp_username).replace("+"," ")},0!=t.rt_tmp_password&&(e.password=decodeURIComponent(t.rt_tmp_password).replace("+"," ")),sdk.handleStorageLogin(e))},handleStorageLogin:function(e){if(!_i.storage.getItem("r",!0)&&!auth.loggedIn){var t={username:e.name,password:e.password};dlg.close(!0),skin.login(e.password?rumbletalk:guest,t)}},handleStorageLogout:function(e){auth.loggedIn?e.userId&&e.userId!=auth.id?console.log("user id check failed"):e.username&&e.username!=rtc.user(auth.id).name?console.log("username check failed"):auth.logout("sdk_request"):console.log("user is not logged in")},handleCookieLogin:function(e){if(!_i.isCookie("r")&&!auth.loggedIn){var t={username:e.name,password:e.password};dlg.close(!0),skin.login(e.password?rumbletalk:guest,t)}},handleCookieLogout:function(e){auth.loggedIn?e.userId&&e.userId!=auth.id?console.log("user id check failed"):e.username&&e.username!=rtc.user(auth.id).name?console.log("username check failed"):auth.logout("sdk_request"):console.log("user is not logged in")},isValidDomain:function(e){if(0==cfg.domains.length)return!0;if("string"!=typeof e)return!1;var t;for(t=0;t<cfg.domains.length;t++)if("."==cfg.domains[t][0]&&e.endsWith(cfg.domains[t].substr(1))||cfg.domains[t]==e)return!0;return!1}},sfx={html5:!1,hasRinging:!1,ready:!1,player:null,players:{},src:{},ext:".mp3",ringing:!1,ringInterval:0,ringPause:2e3,ringDuration:18e4,init:function(e){for(var t in sfx.player||(sfx.player=document.createElement("audio"),sfx.player.preload="auto",sfx.html5=!!sfx.player.canPlayType&&!/FireFox\/3\./i.test(navigator.userAgent),_i.ua==_i.userAgents.FIREFOX&&(sfx.ext=".ogg")),sfx.players={},e)e.hasOwnProperty(t)&&e[t]&&(sfx.src[t]="sounds/"+e[t]+sfx.ext,sfx.html5&&(sfx.players[e[t]]||(sfx.players[e[t]]=_i.create("audio",{preload:"auto"}),sfx.players[e[t]].src=sfx.src[t]),sfx.src[t]=sfx.players[e[t]]));if(sfx.html5)e.ring&&(sfx.hasRinging=!0,sfx.player.src="sounds/"+e.ring+sfx.ext);else{var s,i="sounds/sm2.swf";s=_i.ua==_i.userAgents.IE?'<object id="_player" data="'+i+'" type="application/x-shockwave-flash" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0" width="1" height="1"><param name="movie" value="'+i+'"/><param name="wmode" value="transparent"/><param name="allowscriptaccess" value="always"/></object>':'<embed id="_player" src="'+i+'" wmode="transparent" width="1" height="1" allowscriptaccess="always" type="application/x-shockwave-flash"/>',_i.create("DIV",{innerHTML:s},_i.b),sfx.wait()}},wait:function(){if(sfx.player=_i.id("_player"),sfx.player&&sfx.player._createSound)for(var e in sfx.ready=!0,sfx.src)sfx.src.hasOwnProperty(e)&&(sfx.player._createSound(e,!1),sfx.player._load(e,sfx.src[e],!1,!1));else setTimeout((function(){sfx.wait()}),100)},play:function(e){if(sfx.src[e]&&!sfx.ringing)if(sfx.html5){var t=sfx.src[e].play();void 0!==t&&t.catch((function(e){}))}else sfx.ready&&sfx.player._start(e,0,0)},ring:function(e){if(!sfx.ringing){sfx.ringing=!0;var t,s=_i.now();sfx.ringInterval=setInterval((function(){_i.now()-s>=sfx.ringDuration?(sfx.stopRing(),"function"==typeof e&&e()):sfx.hasRinging&&void 0!==(t=sfx.player.play())&&t.catch((function(e){}))}),1e3*sfx.player.duration+sfx.ringPause)}},stopRing:function(){clearInterval(sfx.ringInterval),sfx.ringInterval=0,sfx.ringing&&(sfx.player.pause(),sfx.ringing=!1)}},skin={errors:{},list:null,listFrame:null,listHandle:null,searchBar:null,chat:null,chatFrame:null,content:null,textCover:null,textInput:null,newLineCount:0,TEXT_FIELD_BASE_HEIGHT:40,TEXT_FIELD_HEIGHT_INCREMENTS:16,chatExtra:null,smiley:null,smiliesBox:null,donateBox:null,upload:null,send:null,donate:null,callingBox:null,callingAnswerButtons:null,callingOptions:null,callText:null,callVideo:null,callVideoMini:null,localVideoHandle:null,info:null,listeners:null,speakers:null,session:null,options:null,mobileDims:null,lastUserId:0,lastMsgIds:[],lastMsgTime:0,otherUsersLastMsgTime:0,lastMsg:null,archivePos:null,lastArchivedUser:0,lastArchivedMsgTime:0,lastArchivedMsg:null,loadingArchiveInterval:null,pause:!1,sound:!0,privatePopup:!0,toolbar:null,invited:!1,ownMessages:[],loginType:null,lastCallDialogSize:"side",noAnswerTimeout:0,registerDetails:{},loginHash:"",usersListOpened:!0,isSmall:!1,SMALL_SCREEN:480,MIN_USERS_LIST_WIDTH:180,MESSAGES_INTERVAL:3e4,imageBlob:null,messageTimeout:null,messageInterval:null,init:function(){var e;for(e in skin.sound=!_i.storage.getItem("settings.sound")||JSON.parse(_i.storage.getItem("settings.sound")),skin.privatePopup=!_i.storage.getItem("settings.privatePopup")||JSON.parse(_i.storage.getItem("settings.privatePopup")),skin.rebuildHtml(),privateChat.init(),skin.isSmall=_i.mobile||_i.client().width<=skin.SMALL_SCREEN,skin.toggleListDisplay(!skin.isSmall),_i.userAgents)_i.userAgents.hasOwnProperty(e)&&_i.userAgents[e]===_i.ua&&_i.addClass(_i.b,"is"+e);var t=_i.selectors(["#text-cover"]);t&&t["#text-cover"]&&t["#text-cover"].style.height&&(skin.TEXT_FIELD_BASE_HEIGHT=parseInt(t["#text-cover"].style.height),skin.TEXT_FIELD_HEIGHT_INCREMENTS=1.2*parseInt(_i.style(skin.textCover).getPropertyValue("font-size"))),skin.session.onclick=function(){skin.toggleExtendPopup(!0)},_i.firstCss("timer",skin.session).onclick=function(){skin.usersListOpened||(skin.toggleListDisplay(!0),skin.toggleExtendPopup(!0))},skin.updateUsersListDisplay(),monetize.adjustCurrencyParameters(),sfx.init(cfg.sounds),uploader.init(),gui.init(),_i.mobile||(cfg.inviteFriends||_i.remove(_i.id("invite-button")),skin.listHandle.onclick=function(){skin.toggleListDisplay(!skin.usersListOpened)}),cfg.inviteFriends&&_i.addClass(_i.id("search-button"),"invite-enabled"),skin.usersMessagesCount.onclick=function(){skin.list.scrollTop=0},skin.textCover.onclick=function(){auth.loggedIn||skin.loginDialog()},skin.isPrivateChat()&&(skin.chatFrame.onclick=function(){auth.loggedIn||skin.loginDialog()}),skin.textInput.onfocus=function(){skin.toggleSmilies(!0),skin.toggleDonate(!0),auth.loggedIn&&!privateChat.userId?mentions.checkMention():skin.textInput.blur()},skin.textInput.onblur=skin.preventSingleBr,skin.textInput.onkeydown=function(e){auth.loggedIn&&(mentions.handleKeys(e)||"Enter"!==e.key||e.shiftKey||_i.mobile||(e.preventDefault(),e.target.innerText.trim().length>0&&(skin.messageFullPost(e.target.innerText),skin.focus())))},skin.textInput.onkeyup=function(e){if(auth.loggedIn){var t=e.target.innerText.substr(0,e.target.innerText.length-1).match(/\n/g);(t=(t||[]).length)!=skin.newLineCount&&skin.adjustTextField(t),e.target.innerText.length>0&&"none"!==skin.textPlaceholder.style.display&&(skin.textPlaceholder.style.display="none"),mentions.checkMention()}},skin.send.onclick=function(){auth.loggedIn&&0!=skin.textInput.innerText.trim().length&&(skin.messageFullPost(skin.textInput.innerText),skin.focus())},skin.textInput.addEventListener("paste",skin.textOrImagePaste,!1),uploader.validities.upload&&(skin.chatFrame.addEventListener("dragenter",skin.imageDragEnter,!1),skin.chatFrame.addEventListener("dragleave",skin.imageDragLeave,!1),skin.chatFrame.addEventListener("drop",skin.imageDrop,!1)),skin.errors[guest.errors.EMPTY_USER_NAME]=cfg.strings.empty_user_name,skin.errors[guest.errors.BAD_USER_NAME]=cfg.strings.bad_user_name,skin.errors[rumbletalk.errors.EMPTY_USER_NAME]=cfg.strings.empty_user_name,skin.errors[rumbletalk.errors.BAD_USER_NAME]=cfg.strings.bad_user_name,skin.errors[rumbletalk.errors.EMPTY_PASSWORD]=cfg.strings.empty_password,skin.errors[rtc.statuses.USER_NAME_IN_USE]=cfg.strings.user_name_in_use,skin.errors[rtc.statuses.INVALID_CREDENTIALS]=cfg.strings.invalid_credentials,skin.errors[rtc.statuses.ADMIN_PASSWORD]=cfg.strings.admin_password,skin.errors[rtc.statuses.SPEAKERS_QUOTA_EXCEEDED]=cfg.strings.quota_exceeded,skin.errors[rtc.statuses.LISTENERS_QUOTA_EXCEEDED]=cfg.strings.quota_exceeded,skin.errors[rtc.statuses.ACCESS_DENIED]=cfg.strings.disconnected,skin.errors[rtc.statuses.KICKED]=cfg.strings.kicked,skin.errors[rtc.statuses.BANNED]=cfg.strings.kicked,skin.errors[rtc.statuses.BAD_WORDS]=cfg.strings.bad_words,skin.errors[rtc.statuses.FLOOD]=cfg.strings.flood,skin.errors[register.errors.EMPTY_USER_NAME]=cfg.strings.empty_user_name,skin.errors[register.errors.BAD_USER_NAME]=cfg.strings.bad_user_name,skin.errors[register.errors.USER_NAME_IN_USE]=cfg.strings.user_name_in_use,skin.errors[register.errors.EMPTY_PASSWORD]=cfg.strings.empty_password,skin.errors[register.errors.INVALID_PASSWORD]=cfg.strings.invalid_password,skin.errors[register.errors.BAD_EMAIL]=cfg.strings.bad_email,skin.errors[register.errors.IMAGE_TOO_LARGE]=cfg.strings.image_too_large,skin.errors[register.errors.IMAGE_UPLOADING]=cfg.strings.image_uploading,skin.errors[register.errors.INVALID_URL]=cfg.strings.invalid_url,dlg.init(),document.onkeydown=function(e){if((cfg.chatType!==_i.chatTypes.ONE_ON_ONE||auth.moderator)&&"Escape"===e.key){if(dlg.opened)return void skin.close();if(privateChat.userId>0)return void privateChat.close();skin.toggleSmilies(!0),skin.toggleDonate(!0),mentions.close()}},skin.redraw(),_i.events([{obj:skin.chat,name:"scroll",cb:skin.scrollBar},{name:"resize",cb:skin.redraw},{name:"message",cb:skin.messageEvent}]),skin.initP2P(),setInterval(skin.scroll,100),window.addEventListener("beforeunload",(function(e){var t=e||window.event;if(rtc.mq.length>0||skin.ownMessages.length>0||Object.keys(privateChat.ownMessages).length>0)if(_i.userAgents.IE||_i.userAgents.CHROME)t.returnValue="You still have messages being sent, are you sure you want to leave this page?";else{if(!_i.userAgents.FIREFOX)return _i.userAgents.SAFARI||(t.preventDefault(),t.returnValue="You still have messages being sent, are you sure you want to leave this page?"),"You still have messages being sent, are you sure you want to leave this page?";t.preventDefault()}}))},buildCustomizedCss:function(e){if(e){var t=document.createElement("style");t.title="rt-css",t.appendChild(document.createTextNode(e)),document.head.appendChild(t)}},rebuildHtml:function(){_i.b.appendChild(gui.template("s3upload-template",{s3Bucket:"https://"+cfg.s3.bucket+".s3.amazonaws.com/",s3Key:cfg.s3.key},!0)),_i.b.appendChild(gui.template("calling-box-template",{answerVideo:cfg.strings.answer_video,answerAudio:cfg.strings.answer_audio,decline:cfg.strings.decline,swapCameras:cfg.strings.swap_cameras,minimize:cfg.strings.minimize,micToggle:cfg.strings.mic_toggle,cameraToggle:cfg.strings.camera_toggle,displayVideo:cfg.p2p.video,displayAudio:cfg.p2p.audio},!0)),_i.b.appendChild(gui.template("list-template",{invite:cfg.strings.invite,searchTitle:cfg.strings.search_placeholder,closeSearchTitle:cfg.strings.cancel,showSearch:!0,placeholderSearch:cfg.strings.search_placeholder,speakers:cfg.strings.speakers,listeners:cfg.strings.listeners,pause:cfg.strings.pause,options:cfg.strings.options,logout:cfg.strings.logout},!0)),_i.b.appendChild(gui.template("chat-template",{adminMode:cfg.strings.admin_mode,adminModeHover:cfg.strings.admin_mode_hover,typeMessage:cfg.strings.type_message,emoji:cfg.strings.emoji,donate:cfg.strings.donate,add:cfg.strings.add,send:cfg.strings.send},!0)),_i.b.appendChild(gui.template("user-info-main-template",null,!0)),_i.mobile&&(_i.b.appendChild(gui.template("mobile-top",{invite:cfg.strings.invite,options:cfg.strings.options,facebook:cfg.strings.facebook,twitter:cfg.strings.twitter},!0)),_i.b.appendChild(gui.template("mobile-bottom",{users:cfg.strings.users,takePhoto:cfg.strings.take_photo,add:cfg.strings.add},!0))),skin.list=_i.id("list"),skin.chat=_i.id("chat"),skin.content=_i.id("content"),skin.info=_i.id("info"),skin.options=_i.id("options"),skin.listeners=_i.id("listeners"),skin.speakers=_i.id("speakers"),skin.session=_i.id("session"),skin.textCover=_i.id("text-cover"),skin.textInput=_i.id("text-input"),skin.textPlaceholder=_i.id("text-placeholder"),skin.chatExtra=_i.id("chat-extra"),skin.donate=_i.id("donate"),skin.smiley=_i.id("smiley"),skin.callingBox=_i.id("calling-box"),skin.callText=_i.id("calling-box-status"),skin.callVideo=_i.id("calling-box-video"),skin.callVideoMini=_i.id("calling-box-video-mini"),skin.callingAnswerButtons=_i.id("calling-box-answer-buttons"),skin.callingOptions=_i.id("calling-box-options"),skin.usersMessagesCount=_i.id("users-messages-count"),skin.chatFrame=_i.id("chat-frame"),skin.listFrame=_i.id("list-frame"),skin.upload=_i.mobile?_i.id("uploadMobile"):_i.id("upload"),skin.listHandle=_i.mobile?_i.id("users"):_i.id("list-handle"),skin.send=_i.id("send"),skin.searchBar=_i.id("search-bar"),skin.searchInput=_i.id("search-input")},updateUsersListDisplay:function(){cfg.userslist?cfg.userslistAdmin&&(_i.addClass(_i.b,"list-hide-admin"),skin.toggleListDisplay(!1)):(_i.addClass(_i.b,"list-hide"),skin.toggleListDisplay(!1))},toggleListDisplay:function(e){if(e)skin.usersListOpened=!0,_i.addClass(_i.b,"list-opened"),_i.removeClass(_i.b,"list-closed"),_i.mobile&&skin.searchInput.focus();else if(skin.usersListOpened=!1,_i.addClass(_i.b,"list-closed"),_i.removeClass(_i.b,"list-opened"),_i.mobile&&cfg.chatType!==_i.chatTypes.ONE_ON_ONE){skin.searchInput.value="";var t=new Event("keyup");skin.searchInput.dispatchEvent(t)}skin.draw()},redraw:function(){skin.isSmall=_i.mobile||_i.client().width<=skin.SMALL_SCREEN,dlg.center(),skin.draw()},draw:function(){var e,t=_i.client(),s=!(!uploader.validities.upload&&!_i.mobile)+!!cfg.parsers.smilies+!!cfg.monetize.donations,i=_i.width(_i.b);skin.isSmall?_i.addClass(_i.b,"small-screen"):_i.removeClass(_i.b,"small-screen"),e=skin.usersListOpened?skin.options.offsetHeight+skin.info.offsetHeight+skin.session.offsetHeight:skin.session.offsetHeight,_i.b.style.height=_i.addUnit(t.height),skin.listFrame.style.height=_i.addUnit(_i.height(_i.b)),skin.list.style.height=_i.addUnit(_i.height(skin.listFrame)-e-_i.id("top-buttons").offsetHeight-(_i.mobile?skin.searchBar.offsetHeight:0)),!_i.mobile&&skin.usersListOpened&&i*cfg.usersWidth/100<skin.MIN_USERS_LIST_WIDTH?(skin.listFrame.style.width=_i.addUnit(skin.MIN_USERS_LIST_WIDTH),skin.chatFrame.style.width=skin.isSmall?"":_i.addUnit(parseInt(i-skin.MIN_USERS_LIST_WIDTH))):(skin.listFrame.style.width="",skin.chatFrame.style.width="");var a=cfg.dir?"left":"right";if(auth.loggedIn&&s){var n=_i.style(skin.chatFrame);skin.chatExtra.style.bottom=n.paddingBottom,skin.chatExtra.style[a]=n[cfg.dir?"paddingLeft":"paddingRight"],skin.chatExtra.style.width=_i.addUnit(40*s),skin.textInput.style[cfg.dir?"paddingLeft":"paddingRight"]=_i.addUnit(40*s)}_i.webrtc&&skin.callingBox.className&&skin.drawCalling(),skin.adjustTextField(),privateChat.draw(),skin.mobileDims=_i.client(),auth.loggedIn&&skin.setupPrivateChat(),window.cfg.messagesFromBottom?(skin.content.style.display="flex",skin.content.style.flexDirection="column-reverse"):(skin.content.style.display="block",skin.content.style.flexDirection=null)},checkDims:function(){var e=_i.client();skin.mobileDims.width==e.width&&skin.mobileDims.height==e.height||document.activeElement===skin.textInput||skin.draw()},logout:function(){auth.loggedIn?auth.logout("button_clicked"):skin.loginDialog()},messageFullPost:function(e){skin.messageTimeout||(e=e.trim(),skin.textInput.innerText.length>rtc.MAX_MESSAGE_LENGTH?skin.showMessage(cfg.strings.message_too_long.replace("{{maxlength}}",rtc.MAX_MESSAGE_LENGTH)):(skin.textInput.innerText="",skin.focus(),skin.message({pos:0,uid:auth.id,ts:_i.now()/1e3,text:e,own:!0}),rtc.sendMessage(e),skin.adjustTextField(0),rtc.track("Messages","Sent",rtc.hash),cfg.sendLimit>0&&!auth.moderator&&skin.handleSendMessageLimit(!1)))},sendPrivateMessage:function(){privateChat.sendMessage()},focus:function(){if(auth.loggedIn&&!_i.mobile){var e=document.createRange();e.selectNodeContents(skin.textInput),e.collapse(!1);var t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}},clearUsers:function(e){var t;if(e)for(t=0;t<rtc.users.length;t++)rtc.users[t].moderator||skin.removeUser(rtc.users[t]);else for(;skin.list.lastChild&&"search-bar"!==skin.list.lastChild.id;)skin.list.removeChild(skin.list.lastChild);skin.setSpeakers()},reloadUsers:function(){var e;for(skin.clearUsers(),e=0;e<rtc.users.length;e++)skin.newUser({user:rtc.users[e],index:e})},setListeners:function(){skin.listeners.innerHTML=rtc.listeners,skin.toolbarMessage()},setSpeakers:function(){skin.speakers.innerHTML=rtc.users.length.toString(),skin.toolbarMessage()},userColor:function(e){return 0===cfg.userColors.length||1===cfg.userColors.length&&"000000"===cfg.userColors[0]?null:"#"+cfg.userColors[e.id%cfg.userColors.length]},messageBg:function(){return!cfg.messageColors||0===cfg.messageColors.length||1===cfg.messageColors.length&&"000000"===cfg.messageColors[0]||1===cfg.messageColors.length&&""===cfg.messageColors[0]?null:"#"+cfg.messageColors[skin.content.childNodes.length%cfg.messageColors.length]},newUser:function(e){var t,s=e.user,i=rtc.users[e.index],a={};if(cfg.chatType!==_i.chatTypes.ONE_ON_ONE||s.moderator||auth.moderator){if(_i.extend(a,s),a.title=cfg.strings.user_info,a.name=gui.safe(a.name),a.click="skin.showUserInfo("+a.id+");",i&&(t=skin.findUserDiv(i.id)))for(;t.parentNode!==skin.list;)t=t.parentNode;_i.create("DIV",{id:"user"+s.id,innerHTML:gui.template("user-template",a),className:s.moderator?"admin":"",style:{color:skin.userColor(s),fontWeight:s.id===auth.id?"bold":"inherit"}},skin.list,t),e.id!==auth.id&&skin.systemMessage(s.name+cfg.strings.joined,"userJoined"),skin.setSpeakers(),skin.setListeners()}},removeUser:function(e){var t=_i.id("user"+e.id);t&&_i.remove(t),skin.setSpeakers(),e.privateMsg>0&&skin.updateUsersPrivateMessagesCounter(-1),privateChat.userId===e.id&&(privateChat.close(!0),privateChat.open(e.id))},showDialog:function(e,t,s,i,a){dlg.show(gui.template(e,t),e,i,s,a)},showMessage:function(e,t){skin.oneButton({text:e,onclick:"skin.close();",buttonText:cfg.strings.ok,className:t})},wait:function(e,t,s){skin.showDialog("wait",{text:e},s,t)},disconnected:function(e){privateChat.close(),skin.textInput.blur(),skin.clearUsers(),skin.clear(),skin.oneButton({text:skin.errors[e||rtc.statuses.ACCESS_DENIED],onclick:-1==[rtc.statuses.FLOOD,rtc.statuses.KICKED,rtc.statuses.BANNED].indexOf(e)?"rtc.connect();":"rtc.reconnect();",buttonText:cfg.strings.reconnect},!0)},oneButton:function(e,t){skin.showDialog("one-button",e,null,null,t)},confirmDialog:function(e,t,s){skin.showDialog("confirm-dialog",e,t,null,s)},cannotConnect:function(){skin.oneButton({text:cfg.strings.cannot_connect,onclick:"rtc.connect();",buttonText:cfg.strings.try_again})},close:function(e){dlg.close(e),0==privateChat.userId&&-1===[_i.userAgents.CHROME,_i.userAgents.IE].indexOf(_i.ua)&&skin.focus()},readyForLogin:function(){dlg.close(),skin.textInput.blur(),skin.textInput.setAttribute("contenteditable","false"),skin.textInput.innerText=cfg.forceSDKLogin?" ":cfg.strings.click_to_join,skin.lastMsg=0,skin.lastUserId=0,skin.adjustTextField(0),cfg.allowListeners||skin.loginDialog()},mustLogin:function(){skin.readyForLogin(),cfg.forceSDKLogin?skin.showDialog("no-button-dialog",{text:cfg.strings.force_sdk_login},null,"force-sdk-login",!0):-1!==[_i.userAgents.CHROME,_i.userAgents.IE].indexOf(_i.ua)?skin.loginDialog():skin.focus()},logginIn:function(e){skin.wait(cfg.strings.login_in,"login-loading login-loading-"+e.name)},getDurationUnit:function(e){return e%525600==0?{unit:cfg.strings.years,divider:525600}:e%43200==0?{unit:cfg.strings.months,divider:43200}:e%10080==0?{unit:cfg.strings.weeks,divider:10080}:e%1440==0?{unit:cfg.strings.days,divider:1440}:e%60==0?{unit:cfg.strings.hours,divider:60}:{unit:cfg.strings.minutes,divider:1}},paymentTitle:function(){var e=skin.getDurationUnit(cfg.monetize.loginDuration);return 1==cfg.monetize.loginType?e.unit==cfg.strings.months?cfg.strings.subscription_monthly:cfg.strings.subscription_yearly:cfg.strings.join_chat_monetize.replace("{{count}}",cfg.monetize.loginDuration/e.divider).replace("{{units}}",e.unit)},loginDialog:function(){cfg.forceSDKLogin||(cfg.monetize.login?skin.registerDialog(!0):skin.showDialog("login",{title:cfg.strings.login_using,displayGuest:cfg.logins.guest,guest:cfg.strings.guest,guestTitle:cfg.strings.login_guest,displayRumbletalk:cfg.logins.rumbletalk,rumbletalk:cfg.strings.user_name,rumbletalkTitle:cfg.strings.login_rumbletalk,displayFacebook:cfg.logins.facebook,facebook:cfg.strings.facebook,facebookTitle:cfg.strings.login_facebook,displayTwitter:cfg.logins.twitter,twitter:cfg.strings.twitter,twitterTitle:cfg.strings.login_twitter,displayRegister:cfg.logins.register,register:cfg.strings.register_button,registerTitle:cfg.strings.register_description}))},loginParamsDialog:function(e,t){var s,i,a=e.id+"-login",n={username:cfg.strings.user_name,password:cfg.strings.password,backText:cfg.strings.back,loginText:cfg.strings.login,forgotPassword:cfg.strings.forgotPassword,resetPassword:t,textAddAvatar:cfg.accountType==_i.accountTypes.FREE?cfg.strings.paid_plans_only:cfg.strings.add_avatar};return gui.templatesHash[a]?(e===guest&&(n.previewSrc=skin.registerDetails.image||guest.pic(),n.onEnter="skin.enter(event, guest)",n.textImageUrl=cfg.strings.image_url,cfg.accountType==_i.accountTypes.FREE&&(n.uploadClass="not-allowed"),n.displayAvatar=cfg.guestAvatar),e===rumbletalk&&skin.loginType===twitter?skin.showDialog(a,n,twitter.logout):skin.showDialog(a,n),e===guest?(skin.loginType=null,i="guest-username",guest.previewImageHandle=_i.firstCss("image-preview",dlg.dialog),guest.previewImageHandle.onerror=function(){guest.previewImageHandle.src=guest.pic()},dlg.callback=function(){return guest.previewImageHandle=null,!0}):i=t?"rumbletalk-password":"rumbletalk-username",(s=document.getElementById(i))&&s.focus()):auth.login(e),!1},getDialogFields:function(){var e,t=_i.tag("input",dlg.dialog),s={};for(e in t)if(t.hasOwnProperty(e))switch(t[e].name){case"username":s.username=t[e].value;break;case"password":s.password=t[e].value;break;case"image":register.validateUrl(t[e].value)&&(s.image=t[e].value)}return s},enter:function(e,t){"Enter"===e.key&&skin.login(t)},setDialogFields:function(e){if(e){var t,s=_i.tag("input",dlg.dialog);for(t in s)s.hasOwnProperty(t)&&"username"==s[t].name&&(s[t].value=e.username)}},showError:function(e){e.type&&cfg.logins[guest.id]?(skin.loginType=e.realType&&e.realType!==guest?e.realType:e.type,skin.loginParamsDialog(e.type,e.status===rtc.statuses.ADMIN_PASSWORD||e.status===rtc.statuses.INVALID_CREDENTIALS),skin.setDialogFields(e.fields),_i.firstCss("error-label",dlg.dialog).innerHTML=skin.errors[e.status]):skin.oneButton({text:skin.errors[e.status],onclick:"skin.loginDialog();",buttonText:cfg.strings.back})},connected:function(){skin.toolbarMessage(),skin.close()},login:function(e,t){null!=skin.loginType&&(e===rumbletalk&&skin.loginType===twitter&&(twitter.process=!0),e=skin.loginType,skin.loginType=null),auth.login(e,t||skin.getDialogFields())},parseAndSaveRegisterFields:function(e){var t,s=["firstName","lastName","username","email","password","image","description"],i={};for(t=0;t<s.length;t++)e[s[t]].value=e[s[t]].value.replace(/,/g,""),"password"!=s[t]&&(e[s[t]].value=e[s[t]].value.trim(),skin.registerDetails[s[t]]=e[s[t]].value),i[s[t]]=e[s[t]].value;return i},register:function(e){var t=dlg.fields();return register.validate(t,(function(){var s=skin.parseAndSaveRegisterFields(t);skin.wait(cfg.strings.registering),e?(rtc.track("Monetize","Submit Register",rtc.hash),auth.register(s)):(rtc.track("Register","Submit",rtc.hash),auth.register(s,!0))})),!1},registerDialog:function(e){var t="return skin.register("+(e=!!e).toString()+");",s="skin.registerEnter(event, "+e.toString()+");",i=skin.paymentTitle(),a={textUsername:cfg.strings.user_name,textPassword:cfg.strings.password,textEmail:cfg.strings.email,textFirstName:cfg.strings.first_name,textLastName:cfg.strings.last_name,textImageUrl:cfg.strings.image_url,textAddAvatar:cfg.accountType==_i.accountTypes.FREE?cfg.strings.paid_plans_only:cfg.strings.add_avatar,alreadyMember:cfg.strings.already_memeber,separatorText:cfg.strings.and,defaultTermsTitle:cfg.strings.register_default_title,continueButtonText:e?cfg.strings.continue_to_checkout:cfg.strings.register,textDescription:cfg.strings.description,textLogin:cfg.strings.login,textBack:cfg.strings.back};rtc.track("Register","Open",rtc.hash),skin.showDialog("register-dialog",_i.extend({uploadClass:cfg.accountType==_i.accountTypes.FREE?"not-allowed":void 0,title:e?i:cfg.strings.join_chat,finishRegister:t,onEnter:s,previewSrc:skin.registerDetails.image||guest.pic(),cost:cfg.monetize.currencySymbol+parseInt(cfg.monetize.loginFee).toFixed(2),defaultTermsUrl:e?cfg.defaultTermsMonetizeLink:cfg.defaultTermsLink,displayUserTerms:e&&cfg.monetize.termsLink&&cfg.monetize.termsTitle||!e&&cfg.registerLink&&cfg.registerTitle,termsUrl:e?cfg.monetize.termsLink:cfg.registerLink,termsTitle:e?cfg.monetize.termsTitle:cfg.registerTitle},a,skin.registerDetails),null,e?"payment-register":"");var n=_i.firstCss("register-login-dialog",dlg.dialog);e?_i.addClass(n,"is-monetize"):_i.removeClass(n,"is-monetize"),register.previewImageHandle=_i.firstCss("image-preview",dlg.dialog),register.previewImageHandle.onerror=function(){register.previewImageHandle.src=guest.pic()},dlg.callback=function(){return register.previewImageHandle=null,!0}},validateUsernameDom:function(e){register.validateUsernameDom(e)},validatePasswordDom:function(e){register.validatePasswordDom(e)},validateEmailDom:function(e){register.validateEmailDom(e)},validateImageDom:function(e){register.validateImageDom(e)},previewImageRegister:function(e){register.previewImage(e)},previewImageGuest:function(e){guest.previewImage(e)},uploadFileGuest:function(){guest.uploadFile()},uploadFileRegister:function(){register.uploadFile()},registerEnter:function(e,t){register.enter(e,t)},paymentSummaryDialog:function(e,t){var s=skin.paymentTitle(),i=monetize.calculateFee(cfg.monetize.loginFee);skin.loginHash=e.hash,skin.showDialog("payment-summary-dialog",{title:s,price:cfg.monetize.currencySymbol+cfg.monetize.loginFee,processingFee:cfg.monetize.currencySymbol+i,total:cfg.monetize.currencySymbol+(cfg.monetize.loginFee+i).toFixed(2),backFunction:t?"skin.registerDialog(true);":"skin.close(true);",continueFunction:"skin.continueToPayPal('"+gui.safe(e.link)+"');",continueString:cfg.strings.continue,backString:cfg.strings.back,textAmount:cfg.strings.amount,textProcessingFee:cfg.strings.processing_fee,textTotal:cfg.strings.total,orderDetailsText:cfg.strings.order_details})},continueToPayPal:function(e){monetize.continueToPayPal(e)},moderatorClasses:function(e){e?_i.addClass(_i.b,"moderator"):_i.removeClass(_i.b,"moderator")},loggedInClasses:function(){if(auth.loggedIn){var e=rtc.user(auth.id);_i.addClass(_i.b,"logged-in"),_i.b.setAttribute("data-logged-in",auth.id),_i.b.setAttribute("data-logged-type",e.loginType.id)}else _i.removeClass(_i.b,"logged-in"),_i.b.removeAttribute("data-logged-in"),_i.b.removeAttribute("data-logged-type")},loggedIn:function(){skin.close(),skin.draw(),skin.updateVisibilities(),skin.textInput.setAttribute("contenteditable",(!rtc.adminMode||auth.moderator).toString()),skin.textInput.innerText="",setTimeout((function(){-1===[_i.userAgents.CHROME,_i.userAgents.IE].indexOf(_i.ua)&&skin.focus()}),200),cfg.autoInvite&&!skin.invited&&(skin.invited=!0,skin.invite())},updateVisibilities:function(){skin.chatExtra.style.display=auth.loggedIn&&!skin.isPrivateChat()?"block":"",skin.upload.style.display=uploader.validities.upload?"":"none",skin.donate.style.display=cfg.monetize.donations?"":"none",skin.smiley.style.display=cfg.parsers.smilies?"":"none"},closed:function(){var e=cfg.offlineMessage&&String(cfg.offlineMessage).trim().length>0?gui.safe(cfg.offlineMessage).replace(/\n/g,"<br>"):cfg.strings.chat_closed;rtc.track("Offline","Offline Message Shown",rtc.hash),skin.showDialog("offline-template",{text:e,displayForm:cfg.offlineShowForm,labelEmail:cfg.strings.email,labelName:cfg.strings.name,labelMessage:cfg.strings.message,buttonText:cfg.strings.send},null,"",!0)},quota:function(e){skin.oneButton({text:skin.errors[e],onclick:"skin.loginDialog();",buttonText:cfg.strings.ok})},playSound:function(e){rtc.connected&&skin.sound&&sfx.play(e)},deleteMessages:function(e,t){var s,i=[],a=!(e instanceof Array),n=t?"apr_":"msg_";if(a){if(!(e=_i.parentCss("main-message-container",e)))return;i.push(Number(e.id.substr(4)));var o=_i.css("message-text",e);for(s=0;s<o.length;s++)o[s].id&&o[s].id.substr(0,4)==n&&i.push(Number(o[s].id.substr(4)));rtc.deleteMessages(i)}else i=e;for(skin.lastMsg=0,skin.lastUserId=0,skin.lastArchivedMsg=0,skin.lastArchivedUser=0,s=0;s<i.length;s++)try{rtc.removeFromMessagesLog(i[s]);var r=_i.id(n+i[s]);if(a)_i.remove(r);else{var l=_i.css("message-text",r);_i.hasClass(r,"main-message-container")&&l.length>1?(_i.remove(l[0]),r.id=l[0].id,l[0].removeAttribute("id"),_i.addClass(l[0],"first")):_i.remove(r)}}catch(e){}},updateOwnMessage:function(e){var t=skin.ownMessages.shift();if(t){t.log.position=e.pos,t.div.id=e.pending?"apr_"+e.pos:"msg_"+e.pos;var s=_i.parentCss("main-message-container",t.div),i=_i.firstCss("delete-message",s);_i.hasClass(t.div,"main-message-container")&&i&&!i.dataset.deleteSet&&(i.setAttribute("onclick","skin.deleteMessages(this);"),i.dataset.deleteSet="1")}},messageClasses:function(e,t,s){var i=[];return t&&i.push("own-message"),e&&i.push("admin"),s&&i.push("pending"),i.length>0?i.join(" "):void 0},message:function(e){if(cfg.chatType!=_i.chatTypes.ONE_ON_ONE){var t,s,i=rtc.getUserOfMessage(e),a=skin.userColor(i),n=e.pending?"apr_"+e.pos:"msg_"+e.pos;if(_i.id(n))console.log("prevented duplicate:",e);else if(!rtc.usersBlocked[i.id]){if(skin.playSound("message"),e.time=1e3*e.ts,auth.id!=i.id&&(skin.otherUsersLastMsgTime=e.time),skin.lastMsgTime+skin.MESSAGES_INTERVAL<e.time||skin.lastUserId!=i.id||!skin.lastMsg||e.pending||_i.hasClass(skin.lastMsg.parentNode,"pending")){s={image:i.image,name:gui.safe(i.name)+":",date:gui.date(e.time,cfg.strings.date),text:e.html?e.text:gui.parse(e.text),del:cfg.strings.delete_this_message,uid:i.id,userDetails:i.id>0?"skin.showUserInfo("+i.id+");":null,classNames:skin.messageClasses(i.moderator,auth.id==i.id,e.pending),delClick:cfg.accountType==_i.accountTypes.FREE?"skin.upgradeDialog();":"skin.deleteMessages(this);",pending:e.pending,approveFn:"skin.approveMessage("+e.pos+", true, this);",approveTitle:cfg.strings.approve_message_title,disapproveFn:"skin.approveMessage("+e.pos+", false, this);",disapproveTitle:cfg.strings.disapprove_message_title},e.own||(s.id=n),skin.lastUserId=i.id,skin.lastMsgTime=e.time,t=gui.template("main-message-template",s,!0),skin.content.appendChild(t),skin.lastMsg=_i.firstCss("message-bubble",t);var o={color:a};if(!e.pending){var r=skin.messageBg();r=null==r?"transparent":r,o.backgroundColor=r}_i.set(skin.lastMsg,{style:o})}else s={innerHTML:gui.parse(e.text),className:"message-text",style:{color:a}},e.own||(s.id=n),t=_i.create("div",s,skin.lastMsg);if(skin.scroll(),!e.pending){var l=rtc.addToMessagesLog(e,i,!1);e.own&&skin.ownMessages.push({div:t,log:l})}}}},archivedMessage:function(e){var t,s=skin.content.childNodes[0],i=rtc.getUserOfMessage(e),a=skin.userColor(i),n="msg_"+e.pos;if(e.time=1e3*e.ts,_i.id(n))console.log("prevented duplicate:",e);else if(!rtc.usersBlocked[i.id])if(!skin.archivePos&&s&&(skin.archivePos=_i.firstCss("message-text",s)),rtc.addToMessagesLog(e,i,!0),skin.lastArchivedUser!=i.id||skin.lastArchivedMsgTime-skin.MESSAGES_INTERVAL>e.time){t={id:n,image:i.image,name:gui.safe(i.name)+":",date:gui.date(e.time,cfg.strings.date),text:gui.parse(e.text),del:cfg.strings.delete_this_message,uid:i.id,userDetails:i.id>0?"skin.showUserInfo("+i.id+");":null,classNames:skin.messageClasses(i.moderator,auth.id==i.id),delClick:"skin.deleteMessages(this);"},skin.lastArchivedUser=i.id,skin.lastArchivedMsgTime=e.time;var o=gui.template("main-message-template",t,!0);skin.content.insertBefore(o,s),skin.lastArchivedMsg=_i.firstCss("message-bubble",o);var r=skin.messageBg();r=null==r?"transparent":r,_i.set(skin.lastArchivedMsg,{style:{color:a,backgroundColor:r}})}else{var l=_i.firstCss("first",skin.lastArchivedMsg);_i.removeClass(l,"first"),l.id=skin.lastArchivedMsg.parentNode.id,skin.lastArchivedMsg.parentNode.id=n,_i.create("div",{innerHTML:gui.parse(e.text),className:"message-text first",style:{color:a}},skin.lastArchivedMsg,_i.firstCss("message-text",skin.lastArchivedMsg))}},archiveDone:function(e){e||dlg.close(),skin.archivePos&&(e||skin.archivePos.scrollIntoView(!1),skin.archivePos=null)},systemMessage:function(e,t,s,i){(s||cfg.systemMessages&&cfg.chatType!=_i.chatTypes.ONE_ON_ONE)&&(skin.playSound(t),skin.lastUserId=0,skin.lastMsg=0,rtc.connected&&!rtc.reconnected&&(_i.create("DIV",{innerHTML:i?e:gui.safe(e),className:"system-message-text "+_i.dashSeparated(t)},skin.content),skin.scroll()))},systemMessageAPI:function(e){if(cfg.chatType!=_i.chatTypes.ONE_ON_ONE){var t={id:0,name:e.name||"System",image:e.img||guest.pic()};e.time=_i.now()-1e3*parseInt(e.time),skin.playSound("message"),skin.lastUserId=0,skin.lastMsg=0;var s=gui.template("main-message-template",{id:"msg_"+e.pos,del:cfg.strings.delete_this_message,classNames:"system-message-api",image:t.image,name:gui.safe(t.name)+":",date:gui.date(e.time,cfg.strings.date),text:gui.parse(e.text),delClick:"skin.deleteMessages(this);"},!0);skin.content.appendChild(s),rtc.addToMessagesLog(e,t,!1),skin.scroll()}},scroll:function(){window.cfg.messagesFromBottom||skin.pause||_i.atBottom(skin.chat)?!window.cfg.messagesFromBottom||skin.pause||_i.atTheVeryTop(skin.chat)||_i.setTop(skin.chat):_i.setBottom(skin.chat)},scrollBar:function(e){"object"!=typeof e&&(e=event),window.cfg.messagesFromBottom?skin.setScroll(!_i.atTop(skin.chat)):skin.setScroll(!_i.atBottom(skin.chat)),_i.atTop(skin.chat,30)&&-1!=rtc.archiveId&&!skin.loadingArchiveInterval&&(skin.loadingArchiveInterval=setTimeout(dlg.close,5e3),skin.wait(cfg.strings.loading_archive,"loading-archive",(function(){clearTimeout(skin.loadingArchiveInterval),skin.loadingArchiveInterval=null})),rtc.loadArchive(),rtc.track("Archive","Load",rtc.hash),_i.cancel(e))},setScroll:function(e){var t=_i.id("pause");skin.pause=e,skin.pause?_i.addClass(t,"paused"):_i.removeClass(t,"paused"),t.title=e?cfg.strings.scroll:cfg.strings.pause},clear:function(){rtc.messagesLog=[],rtc.archiveId=-1,skin.content.innerHTML="",skin.lastUserId=0,skin.lastMsg=0,skin.focus()},popup:function(){window.open(cfg.websiteUrl+"client/chat.php?"+rtc.hash,"__rtcPopup","top=0,left=0,width="+Math.round(screen.width/1.5)+",height="+Math.round(screen.height/1.5)+",toolbars=0,menus=0,location=0,resizable=1"),rtc.track("Popup","Opened",rtc.hash)},toggleSound:function(){skin.sound=!skin.sound,_i.storage.setItem("settings.sound",skin.sound)},togglePrivate:function(){skin.privatePopup=!skin.privatePopup,_i.storage.setItem("settings.privatePopup",skin.privatePopup)},getLink:function(){var e;return _i.l.hash&&(e=_i.l.hash.substr(1)),/^(https?:)?\/\//i.test(e)||(e=_i.d.referrer?_i.d.referrer:_i.l.href),"//"==e.substr(0,2)?_i.l.protocol+e:e},disconnectUser:function(e,t){dlg.close(),rtc.disconnectUser(e,t)},blockUser:function(e,t){auth.id!=e&&(rtc.usersBlocked[e]?delete rtc.usersBlocked[e]:rtc.usersBlocked[e]=!0,_i.storage.setItem("rumbletalk-users-blocked["+rtc.hash+"]"+auth.id,JSON.stringify(rtc.usersBlocked)),skin.updateBlockedUserDom(e),privateChat.userId==e&&t&&(t.title=cfg.strings[rtc.usersBlocked[e]?"unignore_description":"ignore_description"],t.innerHTML=cfg.strings[rtc.usersBlocked[e]?"unignore":"ignore"]))},updateBlockedUserDom:function(e){var t=document.getElementById("user"+e);t&&(rtc.usersBlocked[e]?_i.addClass(t,"blocked"):_i.removeClass(t,"blocked"))},clearBlockedUsersDom:function(){var e;for(e=0;e<skin.list.childNodes.length;e++)_i.removeClass(skin.list.childNodes[e],"blocked")},clearAllMessages:function(){dlg.close(),skin.confirmDialog({text:cfg.strings.confirm_clear_messages,cancelText:cfg.strings.cancel,cancelFnc:"skin.optionsDialog();",confirmText:cfg.strings.ok,confirmFnc:"skin.confirmClearAllMessages();"})},confirmClearAllMessages:function(){dlg.close(),rtc.clearAllMessages()},messageEvent:function(e){"string"==typeof e.data?"toolbar"===e.data?skin.setToolbar(e):0===e.data.indexOf("login:")&&rtc.connectionDone&&sdk.handleSDKLoginLegacy(e):"object"==typeof e.data&&rtc.connectionDone&&(sdk.isSDKMessage(e.data.type)?sdk.handleEventRequests(e):monetize.isMonetizeMessage(e.data.type)&&monetize.handlePostMessage(e))},setToolbar:function(e){skin.toolbar={s:e.source,o:e.origin},skin.toolbarMessage()},toolbarMessage:function(){skin.toolbar&&skin.toolbar.s.postMessage(rtc.users.length+rtc.listeners,skin.toolbar.o)},requestToolbarReload:function(){skin.toolbar&&skin.toolbar.s.postMessage({reload:!0},skin.toolbar.o)},showUserInfo:function(e){privateChat.open(e)},setSelectedUser:function(e){var t=_i.firstCss("user-info-selected",skin.list);t&&_i.removeClass(t,"user-info-selected"),e&&(skin.updateMessageCounter(skin.findUserId(e.parentNode),!1),_i.addClass(e.parentNode,"user-info-selected"))},switchPrivateView:function(e){privateChat.switchView(e)},closeUserDetails:function(e){_i.mobile&&cfg.chatType===_i.chatTypes.ONE_ON_ONE&&!auth.moderator||privateChat.close(e)},findUserDiv:function(e){var t=document.getElementById("user"+e);return t?_i.firstCss("user-container",t):null},findUserId:function(e){var t=e.id.match(/user(\d+)/);return t?t[1]:0},invite:function(){skin.showDialog("invite-template",{facebookTitle:cfg.strings.invite_facebook,facebookTwitter:cfg.strings.invite_twitter,inviteFrom:cfg.strings.invite_from,facebook:cfg.strings.facebook,twitter:cfg.strings.twitter}),rtc.track("Invites","Opened",rtc.hash)},inviteFacebook:function(){facebook.invite()},inviteTwitter:function(){twitter.invite()},toggleExtendPopup:function(e,t){t&&t.stopPropagation();var s=_i.firstCss("extend-popup",skin.session);s&&(s.style.display=e?"block":"none")},requestExtendSession:function(e){e||(e=rtc.user(auth.id))&&(e=e.ssoUid),skin.wait(cfg.strings.loading,"loading-dialog"),auth.extendSession(e||auth.lastSsoUid)},optionsDialog:function(){var e,t,s=[],i=[],a=[],n="",o="";for((1==cfg.menuSettings.sound||2==cfg.menuSettings.sound&&auth.moderator)&&i.push({fn:"skin.toggleSound();",text:cfg.strings.sound,title:cfg.strings.sound_title,isChecked:skin.sound||void 0,className:"toggle-sound"}),(1==cfg.menuSettings.privateChatPopup||2==cfg.menuSettings.privateChatPopup&&auth.moderator)&&i.push({fn:"skin.togglePrivate();",text:cfg.strings.private_chat_popup,title:cfg.strings.private_chat_popup_title,isChecked:skin.privatePopup||void 0,className:"toggle-private"}),2==cfg.menuSettings.adminMode&&auth.moderator&&cfg.chatType!==_i.chatTypes.PRIVATE&&cfg.chatType!==_i.chatTypes.ONE_ON_ONE&&i.push({fn:"skin.toggleAdminMode(!rtc.adminMode, true);",text:cfg.strings.admin_mode,title:cfg.strings.admin_mode_title,isChecked:rtc.adminMode||void 0,className:"admin-mode-switch"}),t=0;t<i.length;t++)n+=gui.template("toggle-switch-template",i[t]);for((1==cfg.menuSettings.fontSize||2==cfg.menuSettings.fontSize&&auth.moderator)&&(e={minusFn:"skin.fontChange('-');",plusFn:"skin.fontChange('+');",text:cfg.strings.font_size,title:cfg.strings.font_size,className:"font-size"},n+=gui.template("plus-minus-template",e)),(1==cfg.menuSettings.qr||2==cfg.menuSettings.qr&&auth.moderator)&&s.push({fn:"skin.qrDialog();",text:"QR",title:cfg.strings.qr_title,className:"qr-option"}),2==cfg.menuSettings.polls&&auth.moderator&&s.push({fn:"skin.pollsDialog();",text:cfg.strings.polls,title:cfg.strings.polls,className:"polls beta"}),(1==cfg.menuSettings.exportTranscript||2==cfg.menuSettings.exportTranscript&&auth.moderator)&&s.push({fn:"skin.exportArchive();",text:cfg.strings.export_transcript,title:cfg.strings.export_conversation,className:"export"}),(1==cfg.menuSettings.openChatInNewWindow||2==cfg.menuSettings.openChatInNewWindow&&auth.moderator)&&s.push({fn:"skin.popup();",text:cfg.strings.popup,title:cfg.strings.popup,className:"popup"}),2==cfg.menuSettings.clearChatMessages&&auth.moderator&&s.push({fn:"skin.clearAllMessages();",text:cfg.strings.clear_messages,title:cfg.strings.clear_messages,className:"clear-messages"}),_i.mobile&&s.push({fn:"skin.logout();",text:cfg.strings.logout,title:cfg.strings.logout,className:"logout"}),t=0;t<s.length;t++)n+=gui.template("button-template",s[t]);if(rtc.user(auth.id)){for(var r in rtc.userStatuses)if(rtc.userStatuses.hasOwnProperty(r)){var l=rtc.userStatuses[r];a.push({id:"user-status-"+l.value,value:l.value,fn:"rtc.updateUserStatus("+l.value+");",for:"user-status-"+l.value,text:l.text})}for(t=0;t<a.length;t++)rtc.user(auth.id).status==a[t].value&&(a[t].checked=!0),o+=gui.template("user-status-template",a[t])}skin.showDialog("options-template",{header:cfg.strings.options,userStatus:!!rtc.user(auth.id),statuses:o,buttons:n,footer:cfg.accountType==_i.accountTypes.FREE,footerText:cfg.strings.powered_by_rumbletalk}),rtc.track("Options","Opened",rtc.hash)},qrDialog:function(){var e=cfg.websiteUrl+"client/qr.php?url=";skin.showDialog("image-preview",{image:e+encodeURIComponent(_i.l.href),callback:"dlg.center();"}),rtc.track("QR","Opened",rtc.hash)},privateMessage:function(e,t){if(!rtc.usersBlocked[e.senderId]&&privateChat.checkDuplicates(e.senderId,e.id,e.position)){e.time=e.time||_i.now();var s=privateChat.addMessageLog(e,e.senderId);if(!t){if(0===privateChat.userId&&skin.privatePopup)skin.findUserDiv(e.senderId)&&privateChat.open(e.senderId);else if(e.senderId!==privateChat.userId)skin.updateMessageCounter(e.senderId,!0);else{privateChat.appendMessageDom(s,e.senderId),_i.lastCss("private-chat-log",privateChat.domHandle)||(privateChat.close(),skin.findUserDiv(e.senderId)&&privateChat.open(e.senderId))}skin.updateUserPosition(e.senderId),skin.playSound("privateMessage")}}},p2pAction:function(e){if(!rtc.usersBlocked[e.uId]){if(p2p.applyAction(e.uId,e.action,e.data),"decline"===e.action){var t=p2p.parseDeclineText(e.uId,e.data.reasonId);t&&skin.privateMessage({senderId:e.uId,text:t,type:privateChat.messageTypes.SYSTEM})}console.log("p2pAction: ",e.uId,e.action,e.data)}},updateUsersPrivateMessagesCounter:function(e){rtc.usersPrivateMessages+=e,rtc.usersPrivateMessages>0?skin.usersMessagesCount.style.display="inline-block":skin.usersMessagesCount.style.display="",skin.usersMessagesCount.innerHTML=rtc.usersPrivateMessages},updateUserPosition:function(e){var t,s,i=skin.findUserDiv(e);if(i&&(i=i.parentNode,t=rtc.users.splice(rtc.userIndex("id",e),1)))if((t=t[0]).hadPrivateMsg=!0,s=rtc.positionUser(t),skin.list.removeChild(i),rtc.users[s+1]){var a=skin.findUserDiv(rtc.users[s+1].id);skin.list.insertBefore(i,a.parentNode)}else skin.list.appendChild(i)},updateMessageCounter:function(e,t){var s=rtc.user(e);if(s){var i=skin.findUserDiv(e);if(i){var a=_i.lastCss("private-message-count",i);t?(s.privateMsg||skin.updateUsersPrivateMessagesCounter(1),s.privateMsg++,a.innerHTML=s.privateMsg,a.style.display="block"):(s.privateMsg>0&&skin.updateUsersPrivateMessagesCounter(-1),s.privateMsg=0,a.style.display="")}}},privateEnter:function(e){return privateChat.inputKeyUp(e)},sendOfflineMessage:function(){var e=_i.tag("input",dlg.dialog),t={omEmail:e[0],omName:e[1],omMessage:_i.tag("textarea",dlg.dialog)[0]};if(!/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(t.omEmail.value))return t.omEmail.style.border="2px solid #ff0000",void t.omEmail.focus();_i.load(cfg.websiteUrl+"client/offline_message.php?hash="+encodeURIComponent(rtc.hash)+"&email="+encodeURIComponent(t.omEmail.value)+"&name="+encodeURIComponent(t.omName.value)+"&message="+encodeURIComponent(t.omMessage.value)),dlg.close(!0),skin.showDialog("no-button-dialog",{text:cfg.strings.offline_message_thank_you},null,"offline-message-dialog",!0),rtc.track("Offline","Offline Lead Sent",rtc.hash)},takePhotoDialog:function(){if(!auth.loggedIn||uploader.busy||!uploader.validities.upload||cfg.accountType==_i.accountTypes.FREE)return!1;webrtc.takePhotoInit()},takePhoto:function(){webrtc.takePhoto()},uploadPhoto:function(){uploader.uploadPhoto()},previewPhoto:function(e){e?(dlg.dialog.querySelector(".take-photo-buttons").style.display="block",dlg.dialog.querySelector(".send-photo-buttons").style.display="none",webrtc.players.photoCanvas.style.display="none",webrtc.players.photoPlayer.style.display="block"):(dlg.dialog.querySelector(".take-photo-buttons").style.display="none",dlg.dialog.querySelector(".send-photo-buttons").style.display="block",webrtc.players.photoCanvas.style.display="block",webrtc.players.photoPlayer.style.display="none",webrtc.takePhoto())},recordAudioDialog:function(){if(!auth.loggedIn||uploader.busy||!uploader.validities.upload||cfg.accountType==_i.accountTypes.FREE)return!1;webrtc.recordAudioInit()},recordAudioStart:function(e){webrtc.recordAudioStart(e)},recordAudioStop:function(e){webrtc.recordAudioStop(e)},uploadAudio:function(){uploader.uploadAudio()},recordVideoDialog:function(){if(uploader.busy||!uploader.validities.upload||cfg.accountType==_i.accountTypes.FREE)return!1;webrtc.recordVideoInit()},recordVideoStart:function(e){webrtc.recordVideoStart(e)},recordVideoStop:function(e){webrtc.recordVideoStop(e)},uploadVideo:function(){uploader.uploadVideo()},uploadFileDialog:function(){return uploader.busy||!uploader.validities.upload||cfg.accountType==_i.accountTypes.FREE||(uploader.file.accept=uploader.configurations.accept||"",uploader.file.click()),!1},privateUploadDialog:function(){uploader.busy||(uploader.configurations={closeDlg:!0,callback:privateChat.sendMessage,imageWidthLimit:1920,imageHeightLimit:1080},skin.uploadDialog(!1))},uploadDialog:function(e){uploader.global=e,_i.mobile?skin.uploadFileDialog():skin.showDialog("upload-dialog",{classNames:cfg.accountType==_i.accountTypes.FREE||uploader.busy?"upload-disable":"",upgradeLink:cfg.websiteUrl+"upgrade/?hash="+rtc.hash,displayPlan:cfg.accountType==_i.accountTypes.FREE,webRTCSupport:_i.webrtc,webRTCSupportAudio:_i.webrtc,webRTCSupportVideo:_i.webrtc&&(_i.ua==_i.userAgents.EDGE&&_i.uaVersion>20||_i.ua!=_i.userAgents.EDGE&&_i.ua!=_i.userAgents.SAFARI),paid_plans_only:cfg.strings.paid_plans_only,add_file:cfg.strings.add_file,take_photo:cfg.strings.take_photo,record_audio:cfg.strings.record_audio,record_video:cfg.strings.record_video})},initP2P:function(){p2p.init(),skin.callVideo.onplaying=skin.drawCalling,skin.callVideoMini.onplaying=skin.drawCalling,skin.callVideoMini.onclick=skin.switchVideo},switchVideo:function(){var e;skin.localVideoHandle===skin.callVideo?(skin.localVideoHandle=skin.callVideoMini,e=skin.callVideo):(skin.localVideoHandle=skin.callVideo,e=skin.callVideoMini),skin.localVideoHandle.muted=!0,setSrcObject(p2p.selfStream,skin.localVideoHandle),"environment"==p2p.facingMode?_i.addClass(skin.localVideoHandle,"back-facing-camera"):_i.removeClass(skin.localVideoHandle,"back-facing-camera"),_i.removeClass(e,"back-facing-camera"),"video"==p2p.mode?skin.localVideoHandle.play():skin.localVideoHandle.pause(),setSrcObject(p2p.remoteStream,e),e.muted=!1,e.play()},audioCallRequest:function(e){privateChat.togglePrivateMenu(!0),p2p.callRequest(e,"audio")},videoCallRequest:function(e){privateChat.togglePrivateMenu(!0),p2p.callRequest(e,"video")},fontChange:function(e){var t,s,i=[skin.chat,skin.list,skin.textCover,privateChat.domHandle,dlg.dialog],a=Number(e+"2");for(s=0;s<i.length;s++)t=parseInt(_i.style(i[s]).getPropertyValue("font-size")),i[s].style.fontSize=_i.addUnit(t+a);skin.TEXT_FIELD_HEIGHT_INCREMENTS=1.2*parseInt(_i.style(skin.textCover).getPropertyValue("font-size"))},answerCall:function(e,t){e.stopPropagation(),skin.callTextSet("connecting"),sfx.stopRing(),p2p.answer(t)},callingDialog:function(e,t){var s=rtc.user(e);if(!s)return!1;clearTimeout(skin.noAnswerTimeout),skin.callTextSet("calling"),sfx.ring("side"==t?skin.closeCalling:skin.noAnswer);var i=_i.firstCss("calling-box-avatar",skin.callingBox);i.src=s.loginType.pic(s),i.alt=s.name,_i.firstCss("calling-box-name",skin.callingBox).innerHTML=s.name,skin.drawCalling(t)},callingMouseMoveListener:function(e){if(clearTimeout(this.mouseMoveHandle),e)for(var t=e.target;"calling-box-items"!=t.id&&"calling-box-details"!=t.id&&(t=t.parentNode););e&&t||(this.mouseMoveHandle=setTimeout((function(){skin.displayCallingButtons(!1)}),3e3)),skin.displayCallingButtons(!0)},callingMouseMoveEvent:function(e){var t=_i.mobile?"touchstart":"mousemove";document.removeEventListener(t,skin.callingMouseMoveListener,!1),e?(skin.callingMouseMoveListener(),document.addEventListener(t,skin.callingMouseMoveListener,!1)):(clearTimeout(skin.callingMouseMoveListener.mouseMoveHandle),skin.displayCallingButtons(!0))},drawCalling:function(e){var t;if("string"==typeof e?skin.lastCallDialogSize=e:e=skin.lastCallDialogSize,skin.callingMouseMoveEvent(!!p2p.remoteStream&&"mini"!=e),skin.displayCallingVideo(!1),skin.displayCallingAvatar(!1),skin.displayCallingVideoMini(!1),skin.displayCallingOptions(!1),skin.displayCallingAnswerButtons(!1),p2p.connected||!p2p.calling&&p2p.busy)switch(e){case"mini":t=skin.displayCallingVideo(!0),skin.displayCallingAvatar(!t);break;case"full":skin.displayCallingAvatar(!0),skin.displayCallingVideo(!0),skin.displayCallingVideoMini(!0),skin.displayCallingOptions(!0)}else if(p2p.calling)switch(e){case"mini":t=skin.displayCallingVideo(!0),skin.displayCallingAvatar(!t);break;case"full":skin.displayCallingAvatar(!0),skin.displayCallingVideo(!0),skin.displayCallingOptions(!0)}else skin.displayCallingAvatar(!0),skin.displayCallingAnswerButtons(!0);switch(skin.callingBox.removeAttribute("style"),_i.mobile&&(skin.callingBox.style.overflow="hidden"),e){case"full":skin.callingBox.className="calling-box-full",e!=skin.lastCallDialogSize&&privateChat.close(),skin.callingBox.onclick=null;break;case"side":if(skin.callingBox.onclick=null,_i.mobile)skin.callingBox.className="calling-box-full";else{skin.callingBox.className="calling-box-side";var s=_i.style(skin.listFrame),i=_i.style(_i.b);skin.callingBox.style.width=s.width,skin.callingBox.style.height=s.height,skin.callingBox.style.top=i.paddingTop,cfg.dir?skin.callingBox.style.right=i.paddingRight:skin.callingBox.style.left=i.paddingLeft}break;case"mini":skin.callingBox.className="calling-box-mini",skin.callingBox.onclick=function(){skin.drawCalling("full")},_i.mobile&&(skin.callingBox.style.top=_i.addUnit(_i.id("top-bar-right").clientHeight))}},displayCallingButtons:function(e){e?(_i.removeClass(_i.id("calling-box-items"),"height-hidden"),_i.removeClass(_i.id("calling-box-details"),"top-hidden")):(_i.addClass(_i.id("calling-box-items"),"height-hidden"),_i.addClass(_i.id("calling-box-details"),"top-hidden"))},displayCallingVideo:function(e){return skin.callVideo.style.display=!skin.callVideo.paused&&e?"":"none",!skin.callVideo.paused},displayCallingVideoMini:function(e){return skin.callVideoMini.style.display=!skin.callVideoMini.paused&&e?"":"none",!skin.callVideoMini.paused},displayCallingAnswerButtons:function(e){e?_i.removeClass(skin.callingAnswerButtons,"decline-only"):_i.addClass(skin.callingAnswerButtons,"decline-only")},displayCallingOptions:function(e){skin.callingOptions.style.display=e?"":"none",skin.callingAnswerButtons.style.display=e?"none":""},displayCallingAvatar:function(e){_i.firstCss("calling-box-avatar",skin.callingBox).style.display=e?"":"none"},callTextSet:function(e,t){skin.callText.style.display=e?"":"none",t||(e=cfg.strings[e]||""),skin.callText.innerHTML=e},swapCamera:function(e){e.stopPropagation(),p2p.swapCamera()},callingMinimize:function(e){e.stopPropagation(),skin.drawCalling("mini")},callingDecline:function(e){if(e.stopPropagation(),!skin.noAnswerTimeout){rtc.track("P2P",rtc.hash,"decline"),p2p.decline(p2p.remoteId,p2p.connected?p2p.responseMessages.HANGUP:p2p.calling?p2p.responseMessages.MISSED:p2p.responseMessages.BUSY);var t=p2p.parseDeclineText(p2p.remoteId,p2p.connected?p2p.responseMessages.HANGUP:p2p.calling?p2p.responseMessages.BUSY:p2p.responseMessages.MISSED);skin.privateMessage({senderId:p2p.remoteId,text:t,type:privateChat.messageTypes.SYSTEM})}skin.closeCalling()},callingToggleMic:function(e,t){if(p2p.selfStream){var s=p2p.selfStream.getAudioTracks().shift();s?(s.enabled=void 0!==t?t:!s.enabled,s.enabled?_i.removeClass(e,"disabled"):_i.addClass(e,"disabled")):_i.addClass(e,"disabled")}},callingToggleCamera:function(e,t){if(p2p.selfStream)if(p2p.audioOnly)p2p.audioToVideoCall(e);else{var s=p2p.selfStream.getVideoTracks().shift();if(!s)return void _i.addClass(e,"disabled");s.enabled=void 0!==t?t:!s.enabled,s.enabled?(_i.removeClass(e,"disabled"),skin.localVideoHandle.play(),p2p.mode="video"):(_i.addClass(e,"disabled"),skin.localVideoHandle.pause(),p2p.mode="audio"),skin.drawCalling()}},closeCalling:function(){clearTimeout(skin.noAnswerTimeout),skin.noAnswerTimeout=0,skin.callingMouseMoveEvent(),sfx.stopRing(),p2p.stop(),skin.callVideoMini.pause(),skin.callVideo.pause(),_i.removeClass(skin.callVideo,"back-facing-camera"),_i.removeClass(skin.callVideoMini,"back-facing-camera"),skin.callingBox.className=""},noAnswer:function(e,t){skin.callTextSet(p2p.messageIdToString(e||p2p.remoteId,t||p2p.responseMessages.BUSY),!0),sfx.stopRing(),p2p.stop(),skin.callingMouseMoveEvent(),0!=skin.noAnswerTimeout&&clearTimeout(skin.noAnswerTimeout),skin.noAnswerTimeout=setTimeout(skin.closeCalling,5e3),skin.callVideo.pause(),_i.removeClass(skin.callVideo,"back-facing-camera")},addToText:function(e){auth.loggedIn&&(skin.textInput.innerText+=" "+e+" ",skin.focus())},toggleSmilies:function(e){privateChat.userId||skin.smiliesBox&&_i.toggleClass(skin.smiliesBox,"active",e)},toggleSmiliesPrivate:function(e){e.stopPropagation(),privateChat.toggleSmilies()},exportArchive:function(e){var t,s,i,a,n,o,r='<meta charset="utf-8">\n<style type="text/css">'+gui.template("export-style")+"</style>\n",l=document.title,c=e?privateChat.logs[e].log:rtc.messagesLog;if(0!=c.length){for(e&&(a=rtc.user(auth.id),n=rtc.user(e)||rtc.usersOffline[e],o={name:"System",id:"system"},l=n.name),rtc.track("Export",rtc.hash),r+='<div class="rumbletalk-archive">\n',s=0;s<c.length;s++)t=e?u(c[s]):d(c[s]),r+=gui.template("export-message",t).trim()+"\n";cfg.accountType==_i.accountTypes.FREE&&(r+=gui.template("export-footer").trim()),r+="</div>\n",r+='\n<script type="text/javascript">'+gui.template("export-script"),r+="<\/script>",i=new Blob([r],{type:"text/plain;charset=utf-8"}),saveAs(i,l+"-"+gui.date(_i.now(),"D-M-Y")+".html")}function d(e){var t=_i.extend({},e);return t.time=gui.date(e.time,cfg.strings.date),t.className="user-message user-"+e.userId,t}function u(e){var t,s=_i.extend({},e);switch(e.type){case privateChat.messageTypes.OWN:t=a;break;case privateChat.messageTypes.REMOTE:t=n;break;default:t=o}return s.name=t.name,s.image=t.image||guest.pic(),s.time=gui.date(e.time,cfg.strings.date),s.className="user-message user-"+t.id,s}},setOneOnOne:function(e){e&&_i.addClass(_i.b,"one-on-one")},checkWaitingForModerator:function(){if(cfg.chatType==_i.chatTypes.ONE_ON_ONE&&auth.loggedIn&&!privateChat.userId)if(auth.moderator){-1!=rtc.userIndex("moderator",!1)?skin.setContentMessage():skin.setContentMessage(cfg.strings.waiting_for_user)}else{var e=rtc.userIndex("moderator",!0);-1!=e?(skin.showUserInfo(rtc.users[e].id),skin.setContentMessage()):skin.setContentMessage(cfg.strings.waiting_for_moderator)}},checkWaitingForOtherUsers:function(){cfg.chatType===_i.chatTypes.PRIVATE?auth.loggedIn&&(rtc.users.length>1?skin.setContentMessage(null,!0):skin.setContentMessage(cfg.strings.waiting_for_other_users,!0)):skin.setContentMessage(null,!0)},setContentMessage:function(e,t){if(t)if(e)skin.chatFrame.innerHTML+=gui.template("content-message",{text:e});else{var s=_i.lastCss("content-message",skin.chatFrame);s&&s.parentNode.removeChild(s)}else skin.content.innerHTML=e?gui.template("content-message",{text:e}):""},confirmDonateDialog:function(e){var t=_i.firstCss("donate-message",e.parentNode),s=_i.firstCss("donation-amount",e.parentNode),i=Number(s.value);monetize.isValidMonetizeAmount(i,cfg.monetize.currency)?(skin.toggleDonate(!0),skin.wait(cfg.strings.loading,"loading-dialog"),rtc.getPaymentLink((function(e){skin.showDialog("donate-confirm-template",{fn:"skin.continueToPayPal('"+e+"');",header:cfg.strings.donate_confirm_header,paragraph:cfg.strings.donate_confirm_text,readMore:cfg.strings.read_more,btnText:cfg.strings.send_donation})}),t.value,i),t.value="",s.value=void 0):skin.signalWarning(s.parentNode)},setDonateAmount:function(e,t){_i.firstCss("user-preview",skin.donateBox).className="user-preview "+skin.getDonateClass(e),_i.firstCss("donation-amount",t.parentNode.parentNode).value=e},getDonateClass:function(e,t){var s=monetize.currencyMultiplier(t||cfg.monetize.currency);if(e=Number(e),!isNaN(e))return e<5*s?"donation-basic":5*s<=e&&e<20*s?"donation-novice":20*s<=e&&e<50*s?"donation-expert":50*s<=e&&e<100*s?"donation-master":100*s<=e?"donation-grand-master":void 0},displayUserImage:function(e){var t=rtc.user(e)||rtc.usersOffline[e];t&&t.image&&skin.showDialog("image-preview",{image:t.image,callback:"dlg.center();"})},toggleDonate:function(e){privateChat.userId||skin.donateBox&&_i.toggleClass(skin.donateBox,"active",e)},donationMessage:function(e){var t,s=rtc.user(e.userId)||rtc.usersOffline[e.userId],i=auth.getLoginType(e.ssoType);t=s?s.image:e.image||i.pic(e);var a=gui.template("donation-message-template",{image:t,userDetails:"skin.showUserInfo("+e.userId+");",name:e.name,donateText:cfg.strings.donated,donateAmount:monetize.formatCurrency(e.currency)+e.amount.toFixed(2),date:gui.date(e.time,cfg.strings.date),text:e.text,className:skin.getDonateClass(e.amount,e.currency)},!0);skin.content.appendChild(a),skin.scroll()},sendPaymentRequest:function(){return privateChat.sendPaymentRequest(_i.id("request-amount")),!1},closeRequestPayment:function(){_i.id("request-amount").value="",skin.switchPrivateView("user-messaging")},togglePrivateMenu:function(e){privateChat.togglePrivateMenu(e)},dismissPaymentRequest:function(){privateChat.removePaymentRequest()},fullscreen:function(e){privateChat.fullscreen(e)},signalWarning:function(e){_i.addClass(e,"warning"),setTimeout((function(){_i.removeClass(e,"warning")}),1800)},openMenu:function(e){var t=_i.firstCss("menu-items",e.parentNode);function s(e){0==e.button&&(_i.removeClass(t,"active"),document.removeEventListener("mouseup",s,!1))}_i.hasClass(t,"active")?document.removeEventListener("mouseup",s,!1):document.addEventListener("mouseup",s,!1),_i.toggleClass(t,"active")},confirmRegisterDialog:function(){skin.showDialog("register-access-dialog",{text:cfg.strings.register_no_access,confirmFn:"skin.confirmRegister();",confirmText:cfg.strings.register,cancelFn:"skin.close();",cancelText:cfg.strings.cancel,defaultTermsUrl:cfg.defaultTermsLink,defaultTermsTitle:cfg.strings.register_default_title,displayUserTerms:cfg.registerLink&&cfg.registerTitle,termsUrl:cfg.registerLink,termsTitle:cfg.registerTitle,separatorText:cfg.strings.and})},confirmRegister:function(){skin.wait(cfg.strings.registering),auth.confirmRegister()},approveMessage:function(e,t,s){_i.parentCss("message-bubble",s).appendChild(gui.template("loader-template",{},!0)),rtc.approveMessage(e,t)},adjustTextField:function(e){var t=-1!==[4,6,2e3,15e3,4e4].indexOf(cfg.skinFamilyId),s=skin.usersListOpened||!t?0:skin.info.offsetHeight||skin.options.offsetHeight;"number"==typeof e&&(skin.newLineCount=e);var i=_i.height(skin.chatFrame),a=skin.TEXT_FIELD_BASE_HEIGHT+skin.TEXT_FIELD_HEIGHT_INCREMENTS*skin.newLineCount;if(i<2*a&&(a=Math.floor(i/2)),skin.textCover.style.height=_i.addUnit(a),skin.chat.style.height=_i.addUnit(i-_i.outerDims(skin.textCover).outerHeight-s),t){var n=_i.addUnit(parseInt(_i.outerDims(skin.textCover).outerHeight)+parseInt(_i.style(skin.chatFrame).paddingBottom));skin.info.style.bottom=n,skin.options.style.bottom=n}},preventSingleBr:function(e){"\n"===e.target.innerText&&(e.target.innerText="")},privateKeyDown:function(e){privateChat.inputKeyDown(e)},toggleAdminMode:function(e,t){rtc.adminMode=e,rtc.adminMode?(_i.addClass(_i.b,"admin-mode"),skin.adminAlert(!0),rtc.track("Admin mode enabled",rtc.hash)):(_i.removeClass(_i.b,"admin-mode"),skin.adminAlert(!1)),t&&rtc.setAdminMode()},mobileClearScreen:function(e,t){if(!_i.parentCss("mobile-dialog",e.target)){var s,i=_i.css("mobile-dialog");for(s=0;s<i.length;s++)t!=i[s]&&_i.removeClass(i[s],"active");t!=skin.listFrame&&skin.toggleListDisplay(!1)}},addMention:function(e){var t=rtc.user(e)||rtc.usersOffline[e];if(t){var s=document.createRange();s.setStart(mentions.lastSelection.node,mentions.lastSelection.offsetStart),s.setEnd(mentions.lastSelection.node,mentions.lastSelection.offsetEnd),s.deleteContents();var i=document.createTextNode("@"+t.name+"");s.insertNode(i),mentions.lastSelection={},mentions.close(),s.collapse(!1);var a=window.getSelection();a.removeAllRanges(),a.addRange(s),skin.textInput.normalize()}},upgradeDialog:function(){skin.showDialog("premium-upgrade-template",{upgradeLink:"https://rumbletalk.com/upgrade?hash="+rtc.hash})},cleanPaste:function(e){try{e.preventDefault();var t=e.clipboardData.getData("text");window.document.execCommand("insertText",!1,t)}catch(e){}},adminAlert:function(e){var t=document.getElementById("alert");e&&t||(e?auth.moderator&&(t=gui.template("admin-mode-alert",{adminModeText:cfg.strings.admin_mode,buttonText:cfg.strings.cancel,tooltipText:cfg.strings.admin_mode_tooltip},!0),skin.chatFrame.appendChild(t)):t&&_i.remove(t))},updatePaymentRequestFee:function(e){privateChat.updatePaymentRequestFee(e)},welcomeMessage:function(){if(cfg.groupChatWelcomeMessage&&!_i.storage.getItem("seen-welcome-message",!0)&&!_i.is("welcome-message")){var e=gui.safe(cfg.groupChatWelcomeMessage).replace(/\n/g,"<br>");setTimeout((function(){var t=gui.template("welcome-message-template",{text:e},!0);skin.chatFrame.appendChild(t)}),1e3)}},closeWelcomeMessage:function(){_i.remove(_i.id("welcome-message")),_i.storage.setItem("seen-welcome-message",!0,!0)},imageUploadDialog:function(e){skin.showDialog("upload-image-dialog",{title:0!=privateChat.userId?cfg.strings.private_image_upload:cfg.strings.global_image_upload,classNames:cfg.accountType==_i.accountTypes.FREE||uploader.busy?"disabled-upload":"",isFreeAccount:cfg.accountType==_i.accountTypes.FREE,upgradeLink:cfg.websiteUrl+"upgrade/?hash="+rtc.hash,free_text:cfg.strings.upload_for_premium_only,previewSrc:e,uploadFn:"skin.uploadImage();",uploadText:cfg.strings.upload,cancelFn:"skin.close();",cancelText:cfg.strings.cancel})},uploadImage:function(){uploader.uploadPastedOrDroppedImage()},textOrImagePaste:function(e){var t=(e.originalEvent||e).clipboardData||window.clipboardData;try{if(!(s=t.getData("text")||t.getData("text/plain")))throw new Exception;if(_i.ua==_i.userAgents.IE)return;e.preventDefault(),window.document.execCommand("insertText",!1,s)}catch(i){if(e.preventDefault(),!uploader.validities.upload)return;var s=t.files||t.items;skin.pasteOrDropImage(s)}},imageDragEnter:function(e){e.stopPropagation(),e.preventDefault(),0==privateChat.userId&&_i.addClass(skin.chatFrame,"droparea")},imageDragLeave:function(e){e.stopPropagation(),e.preventDefault(),0==privateChat.userId&&_i.removeClass(skin.chatFrame,"droparea")},imageDrop:function(e){e.preventDefault(),0!=privateChat.userId?_i.removeClass(_i.id("private-chat-log"),"droparea"):_i.removeClass(skin.chatFrame,"droparea");var t=e.dataTransfer.files;skin.pasteOrDropImage(t)},pasteOrDropImage:function(e){for(var t=null,s=0;s<e.length;s++)if(0===e[s].type.indexOf("image"))try{t=e[s].getAsFile()}catch(i){t=e[s]}if(null!==t){var i=new FileReader;i.onload=function(e){var t=new Uint8Array(e.target.result),s=new Blob([t],{type:uploader.defaultConfigurations.imageType});if(!(!auth.loggedIn||uploader.busy||skin.curUserInfo>0)){uploader.configurations={callback:0!=privateChat.userId?privateChat.sendMessage:skin.messageFullPost,imageWidthLimit:1800,imageHeightLimit:1800};var i=URL.createObjectURL(s),a=new Image;a.onload=function(){var e=uploader.resizeImage(a);e.toBlob((function(e){skin.imageBlob=e}),s.type,uploader.defaultConfigurations.imageQuality),uploader.global=0==privateChat.userId;var t=e.toDataURL(s.type,uploader.defaultConfigurations.imageQuality);skin.imageUploadDialog(t)},a.src=i}},i.readAsArrayBuffer(t)}},clearUserStatusDom:function(e){var t=_i.id("user"+e);_i.removeClass(t,"status"),_i.removeClass(t,"online"),_i.removeClass(t,"away"),_i.removeClass(t,"busy"),t.removeAttribute("title"),t.style.removeProperty?(t.style.removeProperty("cursor"),_i.firstCss("user-container",t).style.removeProperty("cursor")):(t.style.removeAttribute("cursor"),_i.firstCss("user-container",t).style.removeAttribute("cursor"))},updateUserStatusDom:function(e,t){var s=_i.id("user"+e);if(s)switch(skin.clearUserStatusDom(e),_i.addClass(s,"status"),t){case rtc.userStatuses.AWAY.value:_i.addClass(s,"away"),s.setAttribute("title",cfg.strings.away),auth.id!==e||skin.sound||(skin.sound=!0);break;case rtc.userStatuses.BUSY.value:_i.addClass(s,"busy"),s.setAttribute("title",cfg.strings.busy),auth.id===e&&skin.sound&&(skin.sound=!1);break;default:_i.removeClass(s,"status"),s.removeAttribute("title"),auth.id!==e||skin.sound||(skin.sound=!0)}},isPrivateChat:function(){return cfg.chatType==_i.chatTypes.PRIVATE},setupPrivateChat:function(){skin.isPrivateChat()?(skin.textCover.style.display="none",skin.chatExtra.style.display="none",skin.chat.style.display="none"):(skin.textCover.style.display="block",skin.chatExtra.style.display="block",skin.chat.style.display="block")},toggleSearchBar:function(){if(skin.searchBar.classList.toggle("show"),skin.searchBar.classList.contains("show"))skin.searchInput.focus();else{skin.searchInput.value="";var e=new Event("keyup");skin.searchInput.dispatchEvent(e)}},filterUsers:function(e){for(var t=e.target.value.toLowerCase(),s=0;s<rtc.users.length;s++){var i=_i.id("user"+rtc.users[s].id);rtc.users[s].name.toLowerCase().includes(t)?i.style.display="block":i.style.display="none"}},pollsDialog:function(){auth.moderator&&(skin.wait(cfg.strings.loading),rtc.sendPollsGet())},pollsPaginate:function(e){var t=_i.id("polls-dialog-content");_i.removeClass(t,"block"),_i.addClass(t,"hidden");var s=_i.id("polls-dialog-loader");_i.removeClass(s,"hidden"),_i.addClass(s,"flex"),isNaN(e)?"+"==e?polls.currentPage+=1:"-"==e&&(polls.currentPage-=1):polls.currentPage=e;var i=(polls.currentPage-1)*polls.RECORDS_LIMIT;rtc.sendPollsGet(i)},createPollDialog:function(){if(polls.hasActive){var e={text:cfg.strings.polls_create_confirm,cancelText:cfg.strings.cancel,cancelFnc:"skin.pollsCancel();",confirmText:cfg.strings.ok,confirmFnc:"skin.confirmCreate();"};return skin.close(!0),void skin.confirmDialog(e,void 0,!0)}skin.confirmCreate()},confirmCreate:function(){skin.close(!0),polls.init(),skin.showDialog("polls-update-dialog-template",{header:cfg.strings.polls_create,questionLabel:cfg.strings.polls_question_label,answer1Label:cfg.strings.polls_answer1_label,answer2Label:cfg.strings.polls_answer2_label,answer3Label:cfg.strings.polls_answer3_label,answer4Label:cfg.strings.polls_answer4_label,cancelText:cfg.strings.polls_cancel,cancelFn:"skin.pollsCancel()",saveText:cfg.strings.polls_save,saveFn:"skin.pollSave(false)",sendText:cfg.strings.polls_send,sendFn:"skin.pollSave(true)",isNotCreateAndDeleted:!1},null,null,!0)},editPollDialog:function(e){var t=JSON.parse(e);if(polls.hasActive&&t.status===polls.STATUS.EDIT){var s={text:cfg.strings.polls_create_confirm,cancelText:cfg.strings.cancel,cancelFnc:"skin.pollsCancel();",confirmText:cfg.strings.ok,confirmFnc:"skin.confirmUpdate('"+e+"');"};return skin.close(!0),void skin.confirmDialog(s,void 0,!0)}skin.confirmUpdate(e)},confirmUpdate:function(e){(e=JSON.parse(e)).status===polls.STATUS.EDIT&&(polls.model=_i.extend(e),skin.close(!0),skin.showDialog("polls-update-dialog-template",{header:cfg.strings.polls_edit,questionLabel:cfg.strings.polls_question_label,question:e.question,answer1Label:cfg.strings.polls_answer1_label,answer1:e.answer1,answer2Label:cfg.strings.polls_answer2_label,answer2:e.answer2,answer3Label:cfg.strings.polls_answer3_label,answer3:e.answer3,answer4Label:cfg.strings.polls_answer4_label,answer4:e.answer4,cancelText:cfg.strings.polls_cancel,cancelFn:"skin.pollsCancel()",saveText:cfg.strings.polls_save,saveFn:"skin.pollSave(false)",sendText:cfg.strings.polls_send,sendFn:"skin.pollSave(true)",isNotCreateAndDeleted:!0,deleteText:cfg.strings.delete,deleteFn:"skin.pollsDelete("+e.id+")"},null,null,!0))},pollInputChange:function(e,t){polls.model[t]=e.target.value},pollsCancel:function(){polls.init(),skin.close(!0),skin.pollsDialog()},pollsDelete:function(e){var t={text:cfg.strings.polls_delete_confirm,cancelText:cfg.strings.cancel,cancelFnc:"skin.pollsCancel();",confirmText:cfg.strings.delete,confirmFnc:"rtc.sendPollsAction("+e+", '"+polls.ACTIONS.DELETE+"');"};skin.close(!0),skin.confirmDialog(t,void 0,!0)},pollSave:function(e){var t=polls.validate(),s=_i.lastCss("alert-danger");if(t.length>0){s?s.innerHTML='<ul id="polls-errors"></ul>':s=_i.create("div",{className:"alert alert-danger",innerHTML:'<ul id="polls-errors"></ul>'},_i.id("polls-update-dialog"),_i.id("polls-update-form"));var i=_i.id("polls-errors"),a=null;t.forEach((function(e){a=_i.create("li",{innerHTML:e},i,a)}))}else{s&&s.parentNode.removeChild(s),polls.model.id&&(_i.id("btn-polls-delete").disabled=!0),_i.id("btn-polls-cancel").disabled=!0,_i.id("btn-polls-send").disabled=!0,_i.id("btn-polls-save").disabled=!0,(e?_i.id("btn-polls-send"):_i.id("btn-polls-save")).innerHTML='<span class="loading"></span>',rtc.sendPollSave(e)}},viewPollDialog:function(e,t,s){if((e=JSON.parse(e)).status!==polls.STATUS.EDIT){if(e.answercount){var i=e.answercount.split(",");e.answer1count=Number(i[0]),e.answer2count=Number(i[1]),e.answer4count=Number(i[3]),e.answer3count=Number(i[2]),e.status=polls.STATUS.PUBLISHED}polls.model=_i.extend(e);for(var a="",n=e.answer1count+e.answer2count+e.answer3count+e.answer4count,o=1;o<5;o++){var r="answer"+o,l=r+"count";if(o>2&&!e[r])break;var c={answer:e[r],isVoting:t,isNotVoting:!t};t?(c.votingClass="is-voting",c.voteFn="skin.pollsVote("+e.id+", "+o+")"):(c.count="("+e[l]+") ",c.percentage=_i.calculatePercentage(e[l],n),c.className=r,c.style="width:"+_i.calculatePercentage(e[l],n)),a+=gui.template("polls-view-answer-template",c)}var d=e.status===polls.STATUS.ACTIVE,u=e.status===polls.STATUS.PUBLISHED,g=!(s&&u),p={dlgClass:s&&u?"":"dialog-content",header:u?"Polls results":e.status+" poll",votes:n+" voted",question:e.question,answers:a,isActive:d,isPublished:u&&!s,cancelText:s||e.status===polls.STATUS.DELETED?cfg.strings.polls_close:cfg.strings.polls_cancel,cancelFn:s?"skin.close(true)":"skin.pollsCancel()",deleteText:cfg.strings.delete,deleteFn:"skin.pollsDelete("+e.id+")",isVoting:t,isNotVoting:!t,isNotPublished:g,isNotDeleted:e.status!==polls.STATUS.DELETED&&!s};t?(p.closeText=cfg.strings.polls_close,p.closeFn="skin.close(true)"):d?(p.resetText=cfg.strings.polls_reset,p.resetFn="skin.pollsAction("+e.id+", '"+polls.ACTIONS.RESET+"');",p.resendText=cfg.strings.polls_resend,p.resendFn="skin.pollsAction("+e.id+", '"+polls.ACTIONS.SEND+"');",p.publishText=cfg.strings.polls_publish,p.publishFn="skin.pollsAction("+e.id+", '"+polls.ACTIONS.PUBLISH+"');"):u&&!s&&(p.publishAgainText=cfg.strings.polls_publish_again,p.publishAgainFn="skin.pollsAction("+e.id+", '"+polls.ACTIONS.PUBLISH+"');"),skin.close(!0),s&&u?skin.systemMessage(gui.template("polls-view-dialog-template",p,!1),"notice",!0,!0):skin.showDialog("polls-view-dialog-template",p,null,null,!0)}},pollsAction:function(e,t){if((t!==polls.ACTIONS.SEND||polls.model.status===polls.STATUS.EDIT||polls.model.status===polls.STATUS.ACTIVE)&&!(t===polls.ACTIONS.RESET&&polls.model.status!==polls.STATUS.ACTIVE||t===polls.ACTIONS.PUBLISH&&polls.model.status!==polls.STATUS.ACTIVE&&polls.model.status!==polls.STATUS.PUBLISHED)){var s=null;switch(_i.id("btn-polls-cancel").disabled=!0,_i.id("btn-polls-delete").disabled=!0,t){case polls.ACTIONS.SEND:_i.id("btn-polls-reset").disabled=!0,_i.id("btn-polls-publish").disabled=!0,s=_i.id("btn-polls-resend");break;case polls.ACTIONS.RESET:_i.id("btn-polls-resend").disabled=!0,_i.id("btn-polls-publish").disabled=!0,s=_i.id("btn-polls-reset");break;case polls.ACTIONS.PUBLISH:var i=_i.is("btn-polls-publish");s=i?_i.id("btn-polls-publish"):_i.id("btn-polls-publish-again"),i&&(_i.id("btn-polls-resend").disabled=!0,_i.id("btn-polls-reset").disabled=!0)}s.disabled=!0,s.innerHTML='<span class="loading"></span>',rtc.sendPollsAction(e,t)}},pollsVote:function(e,t){var s;try{s=polls.hasDuplicateVote(e,t)}catch(e){return console.log(e),void skin.showMessage(cfg.strings.polls_cookie_is_disabled)}if(s)return skin.close(!0),void skin.showMessage(cfg.strings.polls_vote_has_duplicate);skin.close(!0),skin.wait(cfg.strings.polls_voting),rtc.sendPollsVote(e,t)},handleSendMessageLimit:function(e,t){var s=e?privateChat:skin,i=e?_i.firstCss("private-chat-text-cover",privateChat.domHandle):skin.textCover,a=e?_i.firstCss("private-chat-text",i):skin.textInput;_i.addClass(i,"disabled"),a.setAttribute("contenteditable",!1),e||_i.addClass(skin.chatExtra,"disabled"),t||_i.storage.setItem(e?"sendLimitTimestampPrivate":"sendLimitTimestamp",+new Date,!0),a.innerHTML=cfg.strings.send_message_limit.replace("{{sendLimit}}",t||cfg.sendLimit),e&&t&&a.dispatchEvent(new Event("keyup")),s.messageInterval=setInterval((function(){var e=_i.first("strong",a),t=parseInt(e.textContent);e.textContent=t-1}),1e3),s.messageTimeout=setTimeout((function(){s.messageTimeout=null,clearInterval(s.messageInterval),s.messageInterval=null,_i.removeClass(i,"disabled"),e||_i.removeClass(skin.chatExtra,"disabled"),a.setAttribute("contenteditable",!0),a.innerHTML="",_i.storage.removeItem("sendLimitTimestamp",!0)}),1e3*(t||cfg.sendLimit))},initializeSendLimit:function(e){var t=e?cfg.sendLimit&&cfg.sendLimitPrivate:cfg.sendLimit;if(auth.loggedIn&&t&&!auth.moderator){var s=_i.storage.getItem(e?"sendLimitTimestampPrivate":"sendLimitTimestamp",!0);if(s){var i=Math.floor((+new Date-s)/1e3);if(i>=cfg.sendLimit)return void _i.storage.removeItem(e?"sendLimitTimestampPrivate":"sendLimitTimestamp",!0);var a=cfg.sendLimit-i;skin.handleSendMessageLimit(e,a<0?cfg.sendLimit:a)}}}},twitter={id:"twitter",isSSO:!0,ssoType:1,name:"Twitter",pictureBaseUrl:"",defaultImage:"https://abs.twimg.com/sticky/default_profile_images/default_profile_2_normal.png",process:!1,callbackData:{callback:null,fields:{},winCb:null},screenName:"",storageInfo:{name:"",value:""},storageName:"twitter_cookie",cache:{},win:null,init:function(){twitter.name=cfg.strings.twitter,twitter.pictureBaseUrl=cfg.twitterAvatarUrl},setup:function(e,t){if(twitter.storageInfo.name)return(e=e||{}).username=twitter.screenName,void t(twitter,!0,e,twitter.storageInfo);twitter.callbackData={callback:t,fields:e,winCb:function(){_i.load(cfg.websiteUrl+"client/twitter/get_cookie.php")}},twitter.win=window.open(cfg.websiteUrl+"client/twitter/login.php","twitter_login","width=700,height=600"),twitter.waitWindow()},waitWindow:function(){twitter.win.closed?twitter.callbackData.winCb():setTimeout(twitter.waitWindow,50)},gotStorage:function(e){if(e&&e.cookie&&e.screenName){twitter.storageInfo={name:twitter.storageName,value:e.cookie};var t=twitter.callbackData.fields;t||(t={}),_i.storage.setItem(twitter.storageInfo.name,twitter.storageInfo.value,!0),twitter.screenName=t.username=e.screenName,twitter.callbackData.callback(twitter,!0,t,twitter.storageInfo)}else twitter.callbackData.callback(twitter,!1)},logout:function(e){twitter.process||twitter.clearStorage(),"function"==typeof e&&e()},clearStorage:function(){twitter.process=!1,twitter.storageInfo={},twitter.screenName="",auth.local[twitter.storageName]&&_i.storage.removeItem(twitter.storageName,!0)},pic:function(e){return cfg.twitterAvatar&&twitter.pictureBaseUrl?twitter.pictureBaseUrl+e.name:twitter.defaultImage},getUserInfo:function(e,t){e.ssoUid&&0!==e.ssoUid.length?(twitter.callbackData={callback:t,param:e},twitter.cache[e.ssoUid]?twitter.gotUserInfo(twitter.cache[e.ssoUid],!0):_i.load(cfg.websiteUrl+"client/twitter/user_info.php?id="+e.ssoUid,"twitter-user-"+e.ssoUid,null,null,(function(){twitter.gotUserInfo({id:e.ssoUid},!1)}))):t(e)},gotUserInfo:function(e,t){t||(twitter.cache[e.id]=e);var s="https://twitter.com/intent/user?user_id="+e.id,i={buttons:[],texts:[]};i.texts.push({label:cfg.strings.followers,text:_i.num(e.followers_count,0)}),e.description&&i.texts.push({label:cfg.strings.description,text:gui.safe(e.description)}),i.buttons.push({fn:"window.open('"+s+"');",text:cfg.strings.twitter_go_profile,className:"twitter-button open-in-new"}),twitter.callbackData.callback(twitter.callbackData.param,i)},invite:function(){skin.wait(cfg.strings.inviting_twitter);var e=skin.getLink(),t=cfg.strings.facebook_invite_title.substr(0,137-e.length);twitter.callbackData={winCb:skin.close},rtc.track("Invites","Twitter"),twitter.win=window.open("https://twitter.com/share?url="+encodeURIComponent(e)+"&text="+encodeURIComponent(t)+"&via="+encodeURIComponent("RumbleTalk"),"___rtcTwitter","width=800,height=360,toolbars=0,menus=0,location=0,resizable=1"),twitter.waitWindow()}},uploader={busy:!1,policy:{e:0,p:"",s:"",updated:0},leeway:60,validities:{video:!0,audio:!0,upload:!0},uploadProgressDialog:null,form:null,file:null,iframe:null,global:null,defaultConfigurations:{callback:null,closeDlg:!1,imageWidthLimit:1920,imageHeightLimit:1080,imageQuality:.8,minSize:4e5,forceResize:!1,imageType:"image/jpeg"},configurations:{},init:function(){if(uploader.form=_i.id("s3upload-form"),uploader.iframe=_i.id("s3upload-iframe"),uploader.file=_i.id("s3upload-file-input"),skin.upload.onclick=function(){!auth.loggedIn||uploader.busy||skin.curUserInfo>0||(uploader.configurations={closeDlg:!0,callback:skin.messageFullPost,imageWidthLimit:1920,imageHeightLimit:1080},skin.uploadDialog(!0))},cfg.accountType>_i.accountTypes.FREE){uploader.file.onchange=uploader.s3Upload,uploader.uploadProgressDialog=document.createElement("DIV"),uploader.uploadProgressDialog.id="upload-progress-dialog";var e=new Image;e.src="images/skins/general/loading_file.gif",e.alt=cfg.strings.uploading,e.title=cfg.strings.uploading,uploader.uploadProgressDialog.appendChild(e),skin.chatExtra.appendChild(uploader.uploadProgressDialog)}},shouldResize:function(){if(_i.ua==_i.userAgents.IE||_i.ua==_i.userAgents.EDGE)return!1;if("function"!=typeof FileReader)return!1;if(!uploader.file.files)return!1;if(!uploader.configurations.imageWidthLimit)return!1;if(uploader.file.files[0].size<uploader.defaultConfigurations.minSize&&!uploader.configurations.forceResize)return!1;var e=uploader.file.files[0].type.split("/");return"gif"!=e[1]&&"image"==e[0]},s3Upload:function(){if(uploader.file.value)if(uploader.file.files&&uploader.file.files[0].size>1e6*cfg.uploadSize)skin.showMessage(cfg.strings.file_too_large.replace("{{size}}",cfg.uploadSize+"MB"));else if(rtc.track("Uploads",rtc.hash,"file"),uploader.shouldResize()){var e=new Image,t=new FileReader;t.onload=function(t){e.onload=function(){uploader.resizeImage(e).toBlob((function(e){e.size<uploader.file.files[0].size?(uploader.getPolicy({blob:e}),rtc.track("Uploads",rtc.hash,"image resize")):uploader.getPolicy()}),uploader.file.files[0].type,uploader.defaultConfigurations.imageQuality)},e.src=t.target.result},t.readAsDataURL(uploader.file.files[0])}else uploader.getPolicy()},uploadPhoto:function(){if(webrtc.players.photoCanvas.toBlob)webrtc.players.photoCanvas.toBlob((function(e){uploader.getPolicy({blob:e})}));else{var e=webrtc.players.photoCanvas.msToBlob();uploader.getPolicy({blob:e})}return rtc.track("Uploads",rtc.hash,"photo"),!1},uploadAudio:function(){return uploader.getPolicy({blob:webrtc.players.audioRecorder.getBlob()}),rtc.track("Uploads",rtc.hash,"audio"),!1},uploadVideo:function(){var e=new FileReader;return e.onload=function(e){var t=new Blob([e.target.result],{type:"video/webm"});uploader.getPolicy({blob:t}),rtc.track("Uploads",rtc.hash,"video")},e.readAsArrayBuffer(webrtc.players.videoRecorder.getBlob()),!1},getPolicy:function(e){if(!e||1e3*uploader.policy.e<_i.now()+1e3*uploader.leeway&&uploader.policy.updated<_i.now()+uploader.leeway/2*1e3){var t=new XMLHttpRequest;t.open("GET",cfg.websiteUrl+"client/s3policy.php?h="+rtc.hash,!0),t.onreadystatechange=function(){if(4==t.readyState){var s=JSON.parse(t.responseText);uploader.updatePolicy(s),uploader.sendForm(e)}},t.send()}else uploader.sendForm(e)},sendForm:function(e){var t,s="/"+uploader.policy.e+"-",i=_i.now(),a="https://"+cfg.s3.bucket+".s3.amazonaws.com/"+cfg.md5hash+(uploader.global?"":"/private")+s;if(uploader.form.elements.key.value=cfg.md5hash+(uploader.global?"":"/private")+s+"${filename}",uploader.form.elements.Policy.value=uploader.policy.p,uploader.form.elements.Signature.value=uploader.policy.s,e&&void 0!==e.blob){var n=new XMLHttpRequest,o=new FormData;t=_i.getFileExtension(e.blob.type),i+="."+t,o.append("key",uploader.form.elements.key.value),o.append("acl",uploader.form.elements.acl.value),o.append("Content-Type",e.blob.type),o.append("AWSAccessKeyId",uploader.form.elements.AWSAccessKeyId.value),o.append("success_action_status",uploader.form.elements.success_action_status.value),o.append("Policy",uploader.form.elements.Policy.value),o.append("Signature",uploader.form.elements.Signature.value),o.append("file",e.blob,i),n.open("POST",uploader.form.action,!0),n.send(o),n.onreadystatechange=function(){4==n.readyState&&(n.onreadystatechange=null,uploader.uploadingProgress(200==n.status?a+encodeURIComponent(i):null))}}else{if(i=uploader.file.value.replace(/^.*[\\\/]/,""),uploader.form.elements["Content-Type"].value=uploader.file.files?uploader.file.files[0].type:_i.getFileType(i),!1===uploader.form.elements["Content-Type"].value)return void skin.oneButton({text:cfg.strings.file_type_not_supported,onclick:"skin.close();",buttonText:cfg.strings.ok});uploader.form.submit(),uploader.iframe.onload=function(){uploader.uploadingProgress(a+encodeURIComponent(i)),uploader.iframe.onload=null}}uploader.busy=!0,uploader.uploadProgressDialog.style.display="block",uploader.file.value="",uploader.configurations.closeDlg&&dlg.close()},uploadingProgress:function(e){null!==e&&uploader.configurations.callback(e),uploader.busy=!1,_i.addClass(uploader.uploadProgressDialog,"complete"),setTimeout((function(){uploader.uploadProgressDialog.style.display="",_i.toggleClass(uploader.uploadProgressDialog,"complete",!0)}),500)},updateValidities:function(){uploader.validities={video:cfg.p2p.video&&(auth.moderator||!cfg.p2p.videoAdmin),audio:cfg.p2p.audio&&(auth.moderator||!cfg.p2p.audioAdmin),upload:cfg.upload&&(auth.moderator||!cfg.uploadAdmin)}},updatePolicy:function(e){uploader.policy=e,uploader.policy.updated=_i.now()},resizeImage:function(e){var t=document.createElement("canvas"),s=e.width,i=e.height;return s>i?s>uploader.configurations.imageWidthLimit&&(i=Math.round(i*uploader.configurations.imageWidthLimit/s),s=uploader.configurations.imageWidthLimit):i>uploader.configurations.imageHeightLimit&&(s=Math.round(s*uploader.configurations.imageHeightLimit/i),i=uploader.configurations.imageHeightLimit),t.width=s,t.height=i,t.getContext("2d").drawImage(e,0,0,s,i),t},uploadPastedOrDroppedImage:function(){if(cfg.accountType!=_i.accountTypes.FREE)if(skin.imageBlob.size>2e7)skin.showMessage(cfg.strings.file_too_large.replace("{{size}}",cfg.uploadSize+"MB"));else{var e=new Image;e.onload=function(){e.width>uploader.configurations.imageWidthLimit||e.height>uploader.configurations.imageHeightLimit?skin.showMessage("Image dimension limit is "+uploader.configurations.imageWidthLimit+"x"+uploader.configurations.imageHeightLimit):(uploader.getPolicy({blob:skin.imageBlob}),rtc.track("Uploads",rtc.hash,"photo"))},e.src=URL.createObjectURL(skin.imageBlob),dlg.close()}}},webrtc={audioStream:null,videoStream:null,photoStream:null,players:{videoPlayer:null,videoRecorder:null,photoCanvas:null,photoPlayer:null,photoCanvasContext:null,audioPlayer:null,audioRecorder:null},settings:{photo:{container:".canvas-holder",canvasWidth:320},video:{maxLength:30,startButton:".startVideoRecording",stopButton:".stopVideoRecording",uploadButton:".uploadVideoRecording",container:".video-holder"},audio:{maxLength:30,startButton:".startAudioRecording",stopButton:".stopAudioRecording",uploadButton:".uploadAudioRecording",container:".audio-holder"},secondsLeft:"{{value}} seconds left"},countdownTimeoutHandle:0,audioOptions:{type:"audio",checkForInactiveTracks:!0,bufferSize:16384,disableLogs:!0},countdownInit:function(e,t){var s=e.querySelector(".time-left-"+t);s.style.display="block",s.innerHTML=webrtc.settings.secondsLeft.replace("{{value}}",webrtc.settings[t].maxLength),webrtc.countdown(s,"video"==t?webrtc.recordVideoStop:webrtc.recordAudioStop)},countdown:function(e,t){var s=parseInt(e.innerHTML)-1;s<=0?(e.innerHTML="",t(e.parentNode)):(e.innerHTML=webrtc.settings.secondsLeft.replace("{{value}}",s),webrtc.countdownTimeoutHandle=setTimeout((function(){webrtc.countdown(e,t)}),1e3))},switchButtons:function(e,t,s){e.querySelector(webrtc.settings[t].startButton).style.display=s?"none":"inline-block",e.querySelector(webrtc.settings[t].stopButton).style.display=s?"inline-block":"none",s&&(e.querySelector(webrtc.settings[t].uploadButton).disabled=!0)},recordVideoInit:function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then((function(e){skin.showDialog("record-video-template",{recordVideo:cfg.strings.record_video,stop:cfg.strings.stop,add:cfg.strings.add},(function(){return webrtc.players.videoRecorder.destroy(),webrtc.stopTracks(e),!0}));var t=dlg.dialog.querySelector(webrtc.settings.video.container);webrtc.players.videoPlayer=t.querySelector("video"),webrtc.players.videoPlayer.muted=!0,webrtc.players.videoPlayer.controls=!1,dlg.dialog.querySelector(webrtc.settings.video.uploadButton).disabled=!0,setSrcObject(e,webrtc.players.videoPlayer),webrtc.players.videoPlayer.play(),webrtc.players.videoRecorder=RecordRTC(e,{type:"video",disableLogs:!0,mimeType:_i.ua==_i.userAgents.FIREFOX?"video/webm":"video/webm;codecs=vp8"}),webrtc.videoStream=e})).catch((function(e){skin.close(),e&&"TrackStartError"===e.name?alert("Camera is opened in another tab or browser"):e.name?alert("Camera is blocked by the browser, unblock it to continue\nCODE: "+e.name):(alert("An unexpected error has occured.\nPlease try again"),console.log(e))}))},recordVideoStart:function(e){webrtc.switchButtons(e,"video",!0),webrtc.players.videoRecorder.reset(),setSrcObject(webrtc.videoStream,webrtc.players.videoPlayer),webrtc.players.videoPlayer.muted=!0,webrtc.players.videoPlayer.controls=!1,webrtc.players.videoPlayer.play(),webrtc.players.videoRecorder.startRecording(),webrtc.countdownInit(e,"video")},recordVideoStop:function(e){clearTimeout(webrtc.countdownTimeoutHandle),webrtc.players.videoRecorder.stopRecording((function(){webrtc.players.videoPlayer.src=webrtc.players.videoPlayer.srcObject=null,webrtc.players.videoPlayer.src=URL.createObjectURL(webrtc.players.videoRecorder.getBlob()),webrtc.players.videoPlayer.muted=!1,webrtc.players.videoPlayer.controls=!0,webrtc.players.videoPlayer.play(),e.querySelector(".time-left-video").style.display="",e.querySelector(webrtc.settings.video.uploadButton).disabled=!1})),webrtc.switchButtons(e,"video")},captureMicrophone:function(e){webrtc.audioStream?e(webrtc.audioStream):navigator.mediaDevices.getUserMedia({audio:_i.ua===_i.userAgents.EDGE||{echoCancellation:!1}}).then((function(t){e(t)})).catch((function(e){skin.close(),e&&"TrackStartError"===e.name?alert("Microphone is opened in another tab or browser"):e.name?alert("Microphone is blocked, please open it.\nCODE: "+e.name):(alert("Unpredicted error\nMore information in the console (click F12 to view console)"),console.log(e))}))},replaceAudio:function(e){var t=document.createElement("audio");t.controls=!0,t.autoplay=!0,e&&(t.src=e);var s=dlg.dialog.querySelector(webrtc.settings.audio.container);s.innerHTML="",s.appendChild(t),webrtc.players.audioPlayer=t},recordAudioInit:function(){skin.showDialog("record-audio-template",{recordAudio:cfg.strings.record_audio,stop:cfg.strings.stop,add:cfg.strings.add},(function(){return webrtc.players.audioRecorder&&(webrtc.players.audioRecorder.destroy(),webrtc.stopTracks(webrtc.audioStream)),!0})),webrtc.audioOptions.recorderType=StereoAudioRecorder,_i.ua===_i.userAgents.SAFARI&&(webrtc.audioOptions.sampleRate=44100,webrtc.audioOptions.bufferSize=4096,webrtc.audioOptions.numberOfAudioChannels=2)},recordAudioStart:function(e){webrtc.audioStream?(webrtc.switchButtons(e,"audio",!0),webrtc.replaceAudio(),webrtc.players.audioPlayer.muted=!0,setSrcObject(webrtc.audioStream,webrtc.players.audioPlayer),webrtc.players.audioRecorder&&(webrtc.players.audioRecorder.destroy(),webrtc.players.audioRecorder=null),webrtc.players.audioRecorder=RecordRTC(webrtc.audioStream,webrtc.audioOptions),webrtc.players.audioRecorder.startRecording(),setTimeout((function(){webrtc.countdownInit(e,"audio")}),500)):webrtc.captureMicrophone((function(t){webrtc.audioStream=t,_i.ua===_i.userAgents.SAFARI&&(webrtc.replaceAudio(),webrtc.players.audioPlayer.muted=!0,setSrcObject(webrtc.audioStream,webrtc.players.audioPlayer)),webrtc.recordAudioStart(e)}))},recordAudioStop:function(e){clearTimeout(webrtc.countdownTimeoutHandle),webrtc.players.audioRecorder.stopRecording((function(){webrtc.replaceAudio(URL.createObjectURL(webrtc.players.audioRecorder.getBlob())),e.querySelector(".time-left-audio").style.display="",e.querySelector(webrtc.settings.audio.uploadButton).disabled=!1,_i.ua===_i.userAgents.SAFARI&&webrtc.audioStream&&(webrtc.audioStream.stop(),webrtc.audioStream=null)})),webrtc.switchButtons(e,"audio")},takePhotoInit:function(){navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(e){skin.showDialog("take-photo-template",{takePhoto:cfg.strings.take_photo,cancel:cfg.strings.cancel,add:cfg.strings.add},(function(){return webrtc.stopTracks(e),!0}));var t=dlg.dialog.querySelector(webrtc.settings.photo.container);webrtc.players.photoCanvas=t.querySelector("canvas"),webrtc.players.photoCanvasContext=webrtc.players.photoCanvas.getContext("2d"),webrtc.players.photoPlayer=t.querySelector("video"),setSrcObject(e,webrtc.players.photoPlayer),webrtc.players.photoPlayer.play(),dlg.dialog.querySelector(".take-photo-buttons").style.display="block",dlg.dialog.querySelector(".send-photo-buttons").style.display="none",webrtc.players.photoPlayer.addEventListener("canplay",(function(){webrtc.players.photoCanvas.style.display="none",webrtc.players.photoPlayer.style.display="block",webrtc.players.photoCanvasContext.translate(webrtc.players.photoPlayer.videoWidth,0),webrtc.players.photoCanvasContext.scale(-1,1),webrtc.players.photoCanvas.width=webrtc.settings.photo.canvasWidth,webrtc.players.photoCanvas.height=webrtc.players.photoPlayer.videoHeight/(webrtc.players.photoPlayer.videoWidth/webrtc.settings.photo.canvasWidth),webrtc.takePhoto(),dlg.center()}),!1)})).catch((function(e){e&&"TrackStartError"===e.name?alert("Camera is opened in another tab or browser"):alert("Camera is blocked by the browser, unblock it to continue\nCODE: "+e.name)}))},takePhoto:function(){setTimeout((function(){webrtc.drawImage()}),1)},drawImage:function(){try{webrtc.players.photoCanvasContext.clearRect(0,0,webrtc.players.photoCanvas.width,webrtc.players.photoCanvas.height),webrtc.players.photoCanvasContext.drawImage(webrtc.players.photoPlayer,0,0,webrtc.players.photoCanvas.width,webrtc.players.photoCanvas.height)}catch(e){"NS_ERROR_NOT_AVAILABLE"==e.name?setTimeout(webrtc.drawImage,100):console.log(e)}},stopTracks:function(e){e&&("function"==typeof e.getTracks?e.getTracks().forEach((function(e){e.stop()})):e.stop())}};